<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>üìä Risk Analysis Dashboard</title>
    
    <!-- üì± PWA Manifest and Icons -->
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêû</text></svg>">
    
    <!-- PWA Icons for different devices -->
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/icon-192x192.png">
    
    <!-- Mobile app meta tags -->
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BugDash">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Mobile optimization -->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="HandheldFriendly" content="true">
    
    <!-- üåê Open Graph for sharing -->
    <meta property="og:title" content="Bug Risk Analysis Dashboard">
    <meta property="og:description" content="Real-time JIRA bug monitoring and AI-powered analytics">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/">
    <meta property="og:image" content="/static/icons/icon-512x512.png">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --border-color: #dee2e6;
        }

        /* Dark mode variables */
        [data-theme="dark"] {
            --primary-color: #34495e;
            --secondary-color: #5dade2;
            --accent-color: #e74c3c;
            --success-color: #58d68d;
            --warning-color: #f7dc6f;
            --bg-color: #1a1a1a;
            --card-bg: #2c2c2c;
            --text-color: #ecf0f1;
            --border-color: #404040;
        }

        /* Dark mode specific overrides for elements with light backgrounds */
        [data-theme="dark"] .risk-table table,
        [data-theme="dark"] .summary-card,
        [data-theme="dark"] .feature-box,
        [data-theme="dark"] .metric-card,
        [data-theme="dark"] .prediction-card,
        [data-theme="dark"] .nlp-card,
        [data-theme="dark"] .recommendation-category,
        [data-theme="dark"] .performance-metric,
        [data-theme="dark"] .alert-item {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
        }

        /* Dark mode table styling */
        [data-theme="dark"] .risk-table th {
            background: var(--primary-color) !important;
            color: white !important;
        }

        [data-theme="dark"] .risk-table td,
        [data-theme="dark"] .risk-table th {
            color: var(--text-color) !important;
            border-bottom-color: var(--border-color) !important;
        }

        [data-theme="dark"] .risk-table tr:hover {
            background: rgba(255, 255, 255, 0.1) !important;
        }

        /* Dark mode form controls */
        [data-theme="dark"] .form-control,
        [data-theme="dark"] select,
        [data-theme="dark"] input {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border-color: var(--border-color) !important;
        }

        [data-theme="dark"] .form-control:focus {
            border-color: var(--secondary-color) !important;
            box-shadow: 0 0 0 3px rgba(93, 173, 226, 0.2) !important;
        }

        /* Dark mode buttons */
        [data-theme="dark"] .btn-secondary {
            background: var(--border-color) !important;
            color: var(--text-color) !important;
            border-color: var(--border-color) !important;
        }

        [data-theme="dark"] .btn-secondary:hover {
            background: #555 !important;
            border-color: #555 !important;
            color: var(--text-color) !important;
        }

        /* Dark mode settings button specific styling */
        [data-theme="dark"] .header-buttons a.btn-secondary {
            background: var(--border-color) !important;
            color: var(--text-color) !important;
            border-color: var(--border-color) !important;
            text-decoration: none !important;
        }

        [data-theme="dark"] .header-buttons a.btn-secondary:hover {
            background: #555 !important;
            border-color: #555 !important;
            color: var(--text-color) !important;
            text-decoration: none !important;
        }

        [data-theme="dark"] .header-buttons a.btn-secondary:visited {
            color: var(--text-color) !important;
        }

        /* Dark mode insights panels */
        [data-theme="dark"] .insights-panel,
        [data-theme="dark"] .insights-section {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .insights-section h4 {
            color: var(--secondary-color) !important;
        }

        /* Dark mode AI insights specific styling */
        [data-theme="dark"] .ai-insights-list li {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border-left-color: var(--secondary-color) !important;
        }

        /* Dark mode notification styling */
        [data-theme="dark"] .notification {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border-color: var(--border-color) !important;
        }

        /* Ensure chart containers adapt */
        [data-theme="dark"] .chart-container {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
        }

        /* Dark mode loading spinner */
        [data-theme="dark"] .spinner {
            border-color: var(--border-color);
            border-top-color: var(--secondary-color);
        }

        /* Dark mode for specific text elements that should remain readable */
        [data-theme="dark"] .summary-card h3,
        [data-theme="dark"] .summary-card p {
            color: white !important; /* Keep summary cards with white text as they have gradient backgrounds */
        }

        /* Dark mode tab styling */
        [data-theme="dark"] .tab {
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .tab:hover {
            background: rgba(255, 255, 255, 0.1) !important;
        }

        [data-theme="dark"] .tab.active {
            color: var(--secondary-color) !important;
        }

        /* Dark mode card improvements - add borders and better separation */
        [data-theme="dark"] .insights-section,
        [data-theme="dark"] .executive-metrics .metric-card,
        [data-theme="dark"] .prediction-card,
        [data-theme="dark"] .nlp-card,
        [data-theme="dark"] .recommendation-category,
        [data-theme="dark"] .performance-metric,
        [data-theme="dark"] .risk-item {
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }

        /* Dark mode summary cards (Overview tab) - fix gradient and text contrast */
        [data-theme="dark"] .summary-card {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
        }

        [data-theme="dark"] .summary-card h3 {
            color: var(--secondary-color) !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) !important;
        }

        [data-theme="dark"] .summary-card p {
            color: var(--text-color) !important;
            opacity: 0.9 !important;
        }

        /* Dark mode chart container improvements */
        [data-theme="dark"] .chart-container {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 12px !important;
            padding: 1.5rem !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }

        /* Dark mode AI insights specific improvements */
        [data-theme="dark"] .ai-confidence-badge {
            border: 1px solid var(--secondary-color) !important;
            box-shadow: 0 2px 8px rgba(93, 173, 226, 0.3) !important;
        }

        /* Dark mode risk overview improvements */
        [data-theme="dark"] .risk-score-display {
            background: var(--card-bg) !important;
            border: 2px solid var(--border-color) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
        }

        /* Dark mode risk table improvements */
        [data-theme="dark"] .risk-table {
            border: 1px solid var(--border-color) !important;
            border-radius: 12px !important;
            overflow: hidden !important;
        }

        [data-theme="dark"] .risk-table table {
            box-shadow: none !important;
            border: none !important;
        }

        /* Dark mode themes tags and other small elements */
        [data-theme="dark"] .theme-tag {
            background: var(--secondary-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        /* Dark mode alert items in insights */
        [data-theme="dark"] .alert-item {
            border: 1px solid var(--border-color) !important;
            background: var(--card-bg) !important;
        }

        /* Dark mode recommendation lists */
        [data-theme="dark"] .recommendation-list li {
            border-bottom-color: var(--border-color) !important;
        }

        /* Dark mode NLP metrics cards */
        [data-theme="dark"] .nlp-metrics .nlp-card {
            border: 1px solid var(--border-color) !important;
            background: var(--card-bg) !important;
        }

        /* Dark mode prediction cards */
        [data-theme="dark"] .prediction-cards .prediction-card {
            border: 1px solid var(--border-color) !important;
            background: var(--card-bg) !important;
        }

        /* Dark mode performance grid */
        [data-theme="dark"] .performance-grid .performance-metric {
            border: 1px solid var(--border-color) !important;
            background: var(--card-bg) !important;
        }

        /* Dark mode main results panel */
        [data-theme="dark"] .results-panel {
            border: 1px solid var(--border-color) !important;
        }

        /* Dark mode controls panel */
        [data-theme="dark"] .controls-panel {
            border: 1px solid var(--border-color) !important;
        }

        /* Dark mode AI insights section fixes */
        [data-theme="dark"] .insights-section {
            background: var(--card-bg) !important;
            border-left-color: var(--secondary-color) !important;
        }

        [data-theme="dark"] .insights-section h4 {
            color: var(--secondary-color) !important;
        }

        /* Dark mode risk analysis components */
        [data-theme="dark"] .risk-score-display {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        [data-theme="dark"] .risk-label {
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .risk-item {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        [data-theme="dark"] .component-name {
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .risk-recommendation {
            color: var(--text-color) !important;
        }

        /* Dark mode metric cards */
        [data-theme="dark"] .metric-card {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        [data-theme="dark"] .metric-label {
            color: var(--text-color) !important;
        }

        /* Dark mode prediction cards */
        [data-theme="dark"] .prediction-card {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        [data-theme="dark"] .prediction-label {
            color: var(--text-color) !important;
        }

        /* Dark mode NLP cards */
        [data-theme="dark"] .nlp-card {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        [data-theme="dark"] .nlp-label {
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .nlp-value {
            color: var(--secondary-color) !important;
        }

        /* Dark mode recommendation categories */
        [data-theme="dark"] .recommendation-category {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        [data-theme="dark"] .recommendation-category h5 {
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .recommendation-list li {
            color: var(--text-color) !important;
            border-bottom-color: var(--border-color) !important;
        }

        /* Dark mode AI insights list */
        [data-theme="dark"] .ai-insights-list li {
            background: var(--card-bg) !important;
            border-left-color: var(--secondary-color) !important;
            color: var(--text-color) !important;
        }

        /* Dark mode performance metrics */
        [data-theme="dark"] .performance-metric {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        [data-theme="dark"] .metric-text {
            color: var(--text-color) !important;
        }

        /* Dark mode insights panel */
        [data-theme="dark"] .insights-panel {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        [data-theme="dark"] .insights-list li {
            color: var(--text-color) !important;
            border-bottom-color: var(--border-color) !important;
        }

        /* Dark mode AI upgrade notice */
        [data-theme="dark"] .ai-upgrade-notice {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .ai-upgrade-notice p {
            color: var(--text-color) !important;
        }

        /* Dark mode alert banner */
        [data-theme="dark"] .alert-banner {
            background: var(--accent-color) !important;
            border: 1px solid rgba(231, 76, 60, 0.5) !important;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4) !important;
        }

        [data-theme="dark"] .alert-banner .alert-icon {
            filter: brightness(1.1) contrast(1.1) !important;
        }

        [data-theme="dark"] .alert-banner .alert-content strong,
        [data-theme="dark"] .alert-banner .alert-content span {
            color: white !important;
        }

        /* Enhanced emoji rendering */
        .alert-banner .alert-icon {
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", sans-serif;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Ensure alert banner is always visible when shown */
        .alert-banner.show {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            flex: 1;
            min-width: 0; /* Prevent flex item overflow */
        }

        .header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .header-buttons {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Ensure all header buttons have consistent styling */
        .header-buttons .btn-secondary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 38px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .header-buttons .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        /* Light mode settings button specific styling */
        .header-buttons a.btn-secondary {
            text-decoration: none !important;
            color: white !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
        }

        .header-buttons a.btn-secondary:hover {
            text-decoration: none !important;
            color: white !important;
            background: rgba(255, 255, 255, 0.3) !important;
            border-color: rgba(255, 255, 255, 0.5) !important;
        }

        .header-buttons a.btn-secondary:visited {
            color: white !important;
        }

        /* Force visibility for Settings button icon and text */
        .header-buttons a.btn-secondary i,
        .header-buttons a.btn-secondary span {
            color: white !important;
        }

        /* Ensure Settings button is always visible on header gradient */
        .header-buttons a[href="/settings"] {
            background: rgba(255, 255, 255, 0.25) !important;
            border: 1px solid rgba(255, 255, 255, 0.4) !important;
            color: white !important;
            font-weight: 600 !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
        }

        .header-buttons a[href="/settings"]:hover {
            background: rgba(255, 255, 255, 0.35) !important;
            border: 1px solid rgba(255, 255, 255, 0.6) !important;
            color: white !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--success-color);
            animation: pulse 2s infinite;
        }

        .status-dot.warning {
            background-color: var(--warning-color);
        }

        .status-dot.error {
            background-color: var(--accent-color);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .controls-panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
            align-items: end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .form-control {
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background: #cbd3da;
        }

        /* Info Dropdown Styles */
        .info-dropdown-menu .dropdown-item:hover {
            background: #f8f9fa !important;
            transform: translateX(2px);
        }

        .info-dropdown-menu .dropdown-item:active {
            background: #e9ecef !important;
        }

        .info-dropdown {
            position: relative;
            display: inline-block;
        }

        .info-dropdown-menu {
            animation: fadeInDown 0.2s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .advanced-filters {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .advanced-filters.show {
            display: grid;
        }

        .results-panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
            min-height: 400px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--secondary-color);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fff5f5;
            border: 1px solid #feb2b2;
            color: #c53030;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            color: #2f855a;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .tab {
            padding: 1rem 2rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: var(--bg-color);
        }

        .tab.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .summary-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .summary-card p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .chart-container {
            text-align: center;
            margin: 2rem 0;
        }

        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .risk-table {
            overflow-x: auto;
            margin-top: 2rem;
        }

        .risk-table table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .risk-table th,
        .risk-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .risk-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .risk-table tr:hover {
            background: var(--bg-color);
        }

        .alert-banner {
            background: var(--accent-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 12px rgba(152, 80, 72, 0.276);
        }

        .alert-banner.show {
            display: flex;
        }

        .alert-banner .alert-icon {
            font-size: 1.8rem;
            flex-shrink: 0;
            margin-right: 0.75rem;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: sirenFlash 1.5s ease-in-out infinite;
        }

        @keyframes sirenFlash {
            0%, 50%, 100% { 
                opacity: 1; 
                transform: scale(1) rotate(0deg);
                filter: brightness(1);
            }
            25% { 
                opacity: 0.7; 
                transform: scale(1.15) rotate(-5deg);
                filter: brightness(1.3);
            }
            75% { 
                opacity: 0.7; 
                transform: scale(1.15) rotate(5deg);
                filter: brightness(1.3);
            }
        }

        /* Alternative dramatic gif-like animation */
        .alert-banner.dramatic .alert-icon {
            animation: dramaticSiren 0.8s ease-in-out infinite;
        }

        @keyframes dramaticSiren {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                filter: brightness(1) saturate(1);
            }
            12.5% { 
                transform: scale(1.3) rotate(-10deg);
                filter: brightness(1.8) saturate(1.5);
            }
            25% { 
                transform: scale(0.9) rotate(5deg);
                filter: brightness(0.7) saturate(0.8);
            }
            37.5% { 
                transform: scale(1.2) rotate(-8deg);
                filter: brightness(1.6) saturate(1.3);
            }
            50% { 
                transform: scale(1.1) rotate(3deg);
                filter: brightness(1.2) saturate(1.1);
            }
            62.5% { 
                transform: scale(1.25) rotate(-6deg);
                filter: brightness(1.7) saturate(1.4);
            }
            75% { 
                transform: scale(0.95) rotate(4deg);
                filter: brightness(0.8) saturate(0.9);
            }
            87.5% { 
                transform: scale(1.15) rotate(-4deg);
                filter: brightness(1.4) saturate(1.2);
            }
        }

        .alert-banner .alert-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .alert-banner .alert-content strong {
            font-weight: 600;
            font-size: 1rem;
        }

        .alert-banner .alert-content span {
            font-size: 0.9rem;
            opacity: 0.95;
        }

        .auto-refresh-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #1565c0;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .header-left {
                text-align: center;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: 1rem;
            }

            .header-right {
                width: 100%;
                align-items: center;
            }

            .header-buttons {
                justify-content: center;
            }

            .header-status {
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.75rem;
            }

            .controls-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .container {
                padding: 1rem;
            }

            .tab {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1024px) {
            .controls-grid {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
        }

        /* üì± Mobile Touch Optimizations */
        @media (max-width: 768px) {
            /* Larger touch targets */
            .btn {
                min-height: 44px; /* iOS recommended touch target */
                min-width: 44px;
                padding: 1rem 1.5rem;
                font-size: 1rem;
            }

            .tab {
                min-height: 44px;
                padding: 1rem 1.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* Swipe-friendly content */
            .results-panel {
                border-radius: 16px; /* Rounder corners for mobile */
                margin: 0 0.5rem;
            }

            .controls-panel {
                border-radius: 16px;
                margin: 0 0.5rem 1rem 0.5rem;
            }

            /* Better spacing for mobile */
            .container {
                padding: 1rem 0.5rem;
            }

            .header-content {
                padding: 0 1rem;
            }

            /* Improved form controls for mobile */
            .form-control {
                min-height: 44px;
                font-size: 16px; /* Prevents zoom on iOS */
                border-radius: 12px;
            }

            /* Mobile-optimized summary cards */
            .summary-card {
                border-radius: 16px;
                padding: 2rem 1.5rem;
                margin-bottom: 1rem;
            }

            /* Touch-friendly risk table */
            .risk-table {
                border-radius: 16px;
                overflow: hidden;
            }

            .risk-table td,
            .risk-table th {
                padding: 1rem 0.75rem;
                font-size: 0.9rem;
            }

            /* Mobile chart container */
            .chart-container {
                border-radius: 16px;
                padding: 1rem;
                margin: 1rem 0;
            }

            /* PWA-style header on mobile */
            .header {
                border-radius: 0 0 16px 16px;
                position: sticky;
                top: 0;
                z-index: 1000;
            }

            /* Safe area insets for notched devices */
            .header {
                padding-top: calc(1.5rem + env(safe-area-inset-top));
                padding-left: calc(2rem + env(safe-area-inset-left));
                padding-right: calc(2rem + env(safe-area-inset-right));
            }

            /* Mobile insights improvements */
            .insights-section {
                border-radius: 16px;
                margin-bottom: 1.5rem;
                padding: 1.5rem;
            }

            .prediction-cards,
            .nlp-metrics,
            .executive-metrics {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            /* Mobile navigation improvements */
            .tabs {
                overflow-x: auto;
                scrollbar-width: none; /* Firefox */
                -ms-overflow-style: none; /* IE/Edge */
                padding: 0 0.5rem;
            }

            .tabs::-webkit-scrollbar {
                display: none; /* Chrome/Safari */
            }

            .tab {
                white-space: nowrap;
                flex-shrink: 0;
            }
        }

        /* üì± PWA Install Banner */
        .install-banner {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
            padding: 1rem;
            border-radius: 16px;
            display: none;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }

        .install-banner.show {
            display: flex;
            transform: translateY(0);
        }

        .install-banner .install-icon {
            font-size: 2rem;
        }

        .install-banner .install-content {
            flex: 1;
        }

        .install-banner .install-content h4 {
            margin: 0 0 0.25rem 0;
            font-size: 1rem;
        }

        .install-banner .install-content p {
            margin: 0;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .install-banner .install-actions {
            display: flex;
            gap: 0.5rem;
        }

        .install-banner .btn-install {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .install-banner .btn-install:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .install-banner .btn-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .install-banner .btn-close:hover {
            opacity: 1;
        }

        /* üîî Notification Status Indicator */
        .notification-status {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notification-status.enabled {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }

        .notification-status.blocked {
            background: rgba(231, 76, 60, 0.2);
            color: var(--accent-color);
        }

        .notification-status.default {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning-color);
        }

        .notification-status.unsupported {
            background: rgba(149, 165, 166, 0.2);
            color: #95a5a6;
        }

        .notification-status:hover {
            transform: scale(1.05);
        }

        /* üì° Offline Indicator */
        .offline-indicator {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 0.5rem;
            z-index: 1001;
            box-shadow: 0 4px 16px rgba(231, 76, 60, 0.3);
            animation: slideDown 0.3s ease;
        }

        .offline-indicator.show {
            display: flex;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* Touch feedback */
        .btn:active,
        .tab:active,
        .form-control:active {
            transform: scale(0.98);
        }

        /* Improve tap highlights */
        .btn,
        .tab,
        .notification-status {
            -webkit-tap-highlight-color: rgba(52, 152, 219, 0.3);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .trend-chart {
            margin: 2rem 0;
            text-align: center;
        }

        .insights-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .insights-panel h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .insights-list {
            list-style: none;
            padding: 0;
        }

        .insights-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
        }

        .insights-list li:last-child {
            border-bottom: none;
        }

        /* Notification animations */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* AI Insights Styling */
        .ai-insights-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e9ecef;
        }
        
        .ai-confidence-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            text-align: center;
            min-width: 80px;
        }
        
        .confidence-score {
            font-size: 1.2rem;
            font-weight: bold;
            display: block;
        }
        
        .confidence-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        .insights-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .insights-section h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: #007bff;
        }
        
        .executive-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .metric-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
        }
        
        .metric-trend.positive { color: #28a745; }
        .metric-trend.neutral { color: #ffc107; }
        .metric-trend.negative { color: #dc3545; }
        
        .risk-overview {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 2rem;
            align-items: start;
        }
        
        .risk-score-display {
            text-align: center;
            background: white;
            padding: 1rem;
            border-radius: 50%;
            width: 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .risk-score {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .risk-score.low { color: #28a745; }
        .risk-score.medium { color: #ffc107; }
        .risk-score.high { color: #fd7e14; }
        .risk-score.critical { color: #dc3545; }
        
        .risk-components-list {
            list-style: none;
            padding: 0;
        }
        
        .risk-item {
            background: white;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .component-name {
            font-weight: bold;
        }
        
        .risk-score-small {
            background: #dc3545;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 8px;
        }

        .bug-count-display {
            background: #3498db;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 8px;
        }

        .risk-sublabel {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            opacity: 0.8;
        }

        [data-theme="dark"] .risk-sublabel {
            color: #ccc;
        }

        .risk-item {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .risk-recommendation {
            font-size: 0.9rem;
            color: #6c757d;
            flex: 1;
            margin-left: 1rem;
        }
        
        .prediction-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .prediction-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .prediction-icon {
            font-size: 2rem;
        }
        
        .prediction-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
        }
        
        .prediction-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .prediction-confidence,
        .prediction-insight {
            font-size: 0.8rem;
            color: #28a745;
        }
        
        .nlp-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .nlp-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .nlp-icon {
            font-size: 1.5rem;
        }
        
        .nlp-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .nlp-value {
            font-weight: bold;
            color: #007bff;
        }
        
        .themes-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .theme-tag {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .recommendation-category {
            background: white;
            padding: 1rem;
            border-radius: 8px;
        }
        
        .recommendation-category h5 {
            margin-top: 0;
            margin-bottom: 0.5rem;
        }
        
        .recommendation-list {
            list-style: none;
            padding: 0;
        }
        
        .recommendation-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
        }
        
        .recommendation-list li:last-child {
            border-bottom: none;
        }
        
        .ai-insights-list {
            list-style: none;
            padding: 0;
        }
        
        .ai-insights-list li {
            background: white;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            border-left: 3px solid #007bff;
        }
        
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .performance-metric {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .metric-icon {
            font-size: 1.5rem;
        }
        
        .metric-text {
            font-weight: bold;
            color: #007bff;
        }
        
        .ai-upgrade-notice {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .executive-metrics,
            .prediction-cards,
            .nlp-metrics {
                grid-template-columns: 1fr;
            }
            
            .risk-overview {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .recommendations-grid,
            .performance-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Suggested CSS improvements */
        .critical-alert {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 107, 107, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 107, 107, 0.8); }
        }

        /* Dark mode AI upgrade notice */
        [data-theme="dark"] .ai-upgrade-notice {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .ai-upgrade-notice p {
            color: var(--text-color) !important;
        }

        /* Dark mode control group labels - Fix for filter labels not being visible */
        [data-theme="dark"] .control-group label {
            color: var(--text-color) !important;
            font-weight: 600;
        }

        /* Dark mode alert banner */
        [data-theme="dark"] .alert-banner {
            background: var(--accent-color) !important;
            border: 1px solid rgba(231, 76, 60, 0.5) !important;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4) !important;
        }

        .view-all-components-wrapper {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }
        
        .view-all-components {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            margin-top: 1rem;
        }
        
        .view-all-components:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
            color: white;
        }
        
        /* Dark mode styling for view-all-components */
        [data-theme="dark"] .view-all-components {
            background: linear-gradient(135deg, #4f46e5, #3730a3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        [data-theme="dark"] .view-all-components:hover {
            background: linear-gradient(135deg, #3730a3, #312e81);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
        }

        /* üéØ GOAL TRACKING STYLES */
        .goals-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }

        .goals-header h3 {
            margin-bottom: 0.5rem;
            font-size: 2rem;
        }

        .goals-header p {
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }

        .goals-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        /* Goal Analytics Dashboard */
        .goals-analytics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .analytics-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .analytics-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        .analytics-label {
            color: var(--text-color);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .analytics-description {
            font-size: 0.9rem;
            color: #666;
        }

        /* Achievement Section */
        .achievements-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .achievement-card {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .achievement-card:hover {
            transform: scale(1.05);
        }

        .achievement-badge {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .achievement-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .achievement-date {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Goal Cards */
        .goals-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .goal-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .goal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .goal-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 0.25rem;
        }

        .goal-type {
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .goal-description {
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        /* Progress Bar */
        .progress-section {
            margin-bottom: 1rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .progress-percentage {
            font-weight: bold;
            color: var(--secondary-color);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        /* Milestone Indicators */
        .milestones {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
            position: relative;
        }

        .milestone {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .milestone-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            margin-bottom: 0.25rem;
            transition: all 0.3s ease;
        }

        .milestone.achieved .milestone-icon {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .milestone-label {
            font-size: 0.7rem;
            color: #666;
            text-align: center;
        }

        /* Goal Metrics */
        .goal-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .metric-item {
            text-align: center;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 8px;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .metric-label {
            font-size: 0.8rem;
            color: #666;
        }

        /* Confidence Score */
        .confidence-score {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .confidence-bar {
            flex: 1;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #10b981);
            border-radius: 3px;
        }

        /* Goal Actions */
        .goal-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .btn-delete {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .btn-delete:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .btn-cancel:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        /* Delete Confirmation Modal */
        .delete-warning-card {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .delete-warning-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .delete-warning-icon {
            font-size: 2.5rem;
        }

        .delete-warning-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ef4444;
            margin-bottom: 0.25rem;
        }

        .delete-warning-subtitle {
            color: #cbd5e1;
            font-size: 0.95rem;
        }

        .delete-actions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.75rem;
        }

        @media (max-width: 768px) {
            .delete-actions-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .goal-actions {
                justify-content: center;
            }
        }

        /* Goal Insights */
        .goal-insights {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .insight-section h4 {
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .insight-list {
            list-style: none;
            padding: 0;
        }

        .insight-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .insight-list li:last-child {
            border-bottom: none;
        }

        /* Empty State */
        .no-goals-state {
            text-align: center;
            padding: 3rem 2rem;
        }

        .empty-state {
            max-width: 600px;
            margin: 0 auto;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .empty-state p {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .goal-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .feature-icon {
            font-size: 1.5rem;
        }

        .feature-text {
            color: var(--text-color);
            font-weight: 500;
        }

        .cta-actions {
            margin-top: 2rem;
        }

        .cta-note {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .goals-analytics {
                grid-template-columns: 1fr;
            }
            
            .goals-list {
                grid-template-columns: 1fr;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
            
            .goal-features {
                grid-template-columns: 1fr;
            }
            
            .goals-actions {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Dark mode support for goals */
        [data-theme="dark"] .goals-header {
            background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
        }

        [data-theme="dark"] .metric-item {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }

        [data-theme="dark"] .milestone-label {
            color: var(--text-color);
        }

        [data-theme="dark"] .analytics-description {
            color: var(--text-color);
            opacity: 0.8;
        }

        /* üéØ GOAL MODAL FORM STYLING */
        .goal-form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .goal-form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .goal-form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .goal-form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .goal-form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .goal-form-select option {
            background: #1e293b;
            color: white;
        }

        .goal-form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #cbd5e1;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .goal-info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .goal-info-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .goal-info-text {
            color: #cbd5e1;
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .goal-button-primary {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .goal-button-primary:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .goal-button-secondary {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .goal-button-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .goal-grid-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .goal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* Progress Update Modal Styling */
        .progress-current-display {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .progress-metric-label {
            color: #94a3b8;
        }

        .progress-metric-value {
            color: #fbbf24;
            font-weight: bold;
        }

        /* Forecast Modal Styling */
        .forecast-status-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .forecast-status-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .forecast-status-icon {
            font-size: 2.5rem;
        }

        .forecast-status-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .forecast-status-description {
            color: #cbd5e1;
            font-size: 0.95rem;
        }

        .forecast-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .forecast-detail-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
        }

        .forecast-detail-label {
            color: #94a3b8;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .forecast-detail-value {
            color: #fbbf24;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .forecast-confidence-bar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .forecast-confidence-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .forecast-confidence-progress {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .forecast-confidence-fill {
            height: 100%;
            border-radius: 3px;
        }

        .forecast-ai-insights {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .forecast-ai-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .forecast-ai-icon {
            font-size: 1.2rem;
        }

        .forecast-ai-title {
            color: #a5b4fc;
            font-weight: 600;
        }

        .forecast-ai-text {
            color: #cbd5e1;
            margin: 0;
            line-height: 1.4;
        }
        /* Footer Styling */
        .footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 10px;
        }
        
        .footer p {
            margin: 0;
            font-size: 0.9em;
            font-weight: 500;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <h1><img src="/static/risk-analytics.gif" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 8px;" alt="Risk Analytics">Risk Analysis Dashboard</h1>
                <p>Real-time component based bug & support ticket risk monitoring and trend analysis</p>
            </div>
            <div class="header-right">
                <!-- Buttons Row -->
                <div class="header-buttons">
                    <div class="info-dropdown" style="position: relative; display: inline-block;">
                        <button onclick="toggleInfoDropdown()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                            <i class="fas fa-question-circle"></i> Info <i class="fas fa-chevron-down" style="margin-left: 5px; font-size: 0.8em;"></i>
                        </button>
                        <div id="infoDropdownMenu" class="info-dropdown-menu" style="display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; min-width: 280px; overflow: hidden;">
                            <a href="use-cases.html" target="_blank" class="dropdown-item" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; border-bottom: 1px solid #f0f0f0; transition: background 0.2s ease;">
                                <i class="fas fa-users" style="margin-right: 8px; color: #667eea;"></i>
                                <strong>Use Cases Documentation</strong>
                                <div style="font-size: 0.85em; color: #666; margin-top: 2px;">Primary users and platform overview</div>
                            </a>
                            <a href="user-guide.html" target="_blank" class="dropdown-item" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; transition: background 0.2s ease;">
                                <i class="fas fa-book-open" style="margin-right: 8px; color: #667eea;"></i>
                                <strong>Complete User Guide & Tutorial</strong>
                                <div style="font-size: 0.85em; color: #666; margin-top: 2px;">Step-by-step instructions and best practices</div>
                            </a>
                        </div>
                    </div>
                    <a href="/settings" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem; text-decoration: none; color: inherit;" title="Configure JIRA and Project Settings">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                    <button onclick="toggleDarkMode()" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                        <i class="fas fa-moon" id="darkModeIcon"></i> <span id="darkModeText">Light</span>
                    </button>
                </div>
                <!-- Status Row -->
            <div class="header-status">
                <div class="status-indicator">
                    <div class="status-dot" id="connectionStatus"></div>
                    <span id="connectionText">Connected</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="alertStatus"></div>
                        <span id="alertText">9 Alerts</span>
                </div>
                <div class="status-indicator">
                        <span id="lastUpdate">Last updated: 22:47:57</span>
                    </div>
                    <!-- üîî Push Notification Status -->
                    <div class="status-indicator">
                        <span class="notification-status default" id="notificationStatus" onclick="toggleNotifications()" title="Click to enable push notifications">
                            ‚ùì Enabled
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Alert Banner -->
        <div class="alert-banner" id="alertBanner">
            <div class="alert-icon">üö®</div>
            <div class="alert-content">
                <strong>Risk Alert!</strong>
                <span id="alertMessage">High-risk components detected</span>
            </div>
            <button class="btn btn-secondary" onclick="showAlertsTab()">View Details</button>
        </div>

        <!-- Auto-refresh Info -->
        <div class="auto-refresh-info" id="autoRefreshInfo" style="display: flex; align-items: center; padding: 0.75rem 1rem; margin-bottom: 1rem; border-radius: 0.375rem; background: #e7f3ff; border: 1px solid #bee5eb; color: #0c5460;">
            <div id="autoRefreshContent" style="display: flex; align-items: center; width: 100%;">
                <span>üîÑ Auto-refresh enabled - Dashboard updates every {{ dashboard_config.refresh_interval // 1000 }} seconds</span>
                <span style="margin-left: auto; font-size: 0.85em; opacity: 0.8;" id="lastUpdate">Last updated: Loading...</span>
            </div>
            <button class="btn btn-secondary" onclick="toggleAutoRefresh()" style="margin-left: 1rem; padding: 0.25rem 0.75rem; font-size: 0.8rem;">
                <span id="autoRefreshToggle">Disable</span>
            </button>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="projectSelect">üéØ Select Project</label>
                    <select id="projectSelect" class="form-control">
                        <option value="ALL" selected>All Projects</option>
                        {% for project_id, project_info in projects.items() | sort(attribute='1.name') %}
                        <option value="{{ project_id }}" data-key="{{ project_info.jira_key }}">
                            {{ project_info.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-secondary" onclick="toggleAdvancedFilters()">
                        üîß Advanced Filters
                    </button>
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button id="analyzeBtn" class="btn btn-primary" onclick="analyzeProject()">
                        üöÄ Analyze Project
                    </button>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="advanced-filters" id="advancedFilters">
                <div class="control-group">
                    <label for="dateRange">üìÖ Date Range</label>
                    <select id="dateRange" class="form-control">
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 3 months</option>
                        <option value="180" selected>Last 6 months</option>
                        <option value="365">Last year</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="environment">üåç Environment</label>
                    <select id="environment" class="form-control">
                        <option value="Production" selected>Production</option>
                        <option value="Staging">Staging</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="issueTypes">üé´ Issue Types</label>
                    <select id="issueTypes" class="form-control" multiple>
                        <option value="Bug" selected>Bug</option>
                        <option value="Support Ticket" selected>Support Ticket</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="components">üß© Components</label>
                    <select id="components" class="form-control" multiple>
                        <!-- Populated dynamically -->
                    </select>
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-warning" onclick="clearCache()">
                        üóëÔ∏è Clear Cache
                    </button>
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-info" onclick="resetAdvancedFilters()">
                        üîÑ Reset Filters
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Panel -->
        <div class="results-panel">
            <div class="tabs">
                <button class="tab active" data-tab="overview"><img src="/static/overview.gif" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 6px;" alt="Overview">Overview</button>
                <button class="tab" data-tab="trends"><img src="/static/Trends.gif" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 6px;" alt="Trends">Trends</button>
                <button class="tab" data-tab="alerts"><img src="/static/alarm.gif" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 6px;" alt="Alerts">Alerts</button>
                <button class="tab" data-tab="insights"><img src="/static/AI-insights.gif" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 6px;" alt="AI Insights">AI Insights</button>
                <button class="tab" data-tab="goals"><img src="/static/goal.gif" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 6px;" alt="Goal Tracking">Goal Tracking</button>
            </div>

            <!-- Overview Tab -->
            <div class="tab-content active" id="overview">
                <div id="loadingIndicator" class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing project data...</p>
                </div>

                <div id="resultsContainer" style="display: none;">
                    <div class="summary-grid" id="summaryGrid">
                        <!-- Summary cards populated by JavaScript -->
                    </div>

                    <div class="chart-container" id="chartContainer">
                        <!-- Chart populated by JavaScript -->
                    </div>

                    <div class="risk-table" id="riskTable">
                        <!-- Risk table populated by JavaScript -->
                    </div>
                </div>

                <div id="errorContainer" style="display: none;">
                    <div class="error">
                        <strong>‚ùå Analysis Error</strong>
                        <p id="errorMessage">An error occurred during analysis.</p>
                    </div>
                </div>
            </div>

            <!-- Trends Tab -->
            <div class="tab-content" id="trends">
                <div id="trendsLoading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading trend data...</p>
                </div>

                <div id="trendsContainer">
                    <p>üìà Select a project and click analyze to view historical trends</p>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div class="tab-content" id="alerts">
                <div id="alertsContainer">
                    <p>üö® Real-time alert monitoring will appear here</p>
                </div>
            </div>

            <!-- Insights Tab -->
            <div class="tab-content" id="insights">
                <div id="insightsContainer">
                    <p>üí° AI-powered insights and recommendations will appear here</p>
                </div>
            </div>

            <!-- Goals Tab -->
            <div class="tab-content" id="goals">
                <div id="goalsContainer">
                    <div class="goals-header">
                        <h3>üéØ Goal Tracking & Analytics</h3>
                        <p>Set targets, track progress, and achieve milestones with real-time analytics</p>
                        <div class="goals-actions">
                            <button class="btn btn-primary" onclick="initializeGoals()">üöÄ Initialize Goals</button>
                            <button class="btn btn-secondary" onclick="createNewGoal()">‚ûï New Goal</button>
                        </div>
                    </div>

                    <div id="goalsLoading" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading goal data...</p>
                    </div>

                    <!-- Goal Overview Dashboard -->
                    <div id="goalsDashboard" style="display: none;">
                        <!-- Analytics Summary -->
                        <div class="goals-analytics" id="goalsAnalytics">
                            <!-- Populated by JavaScript -->
                        </div>

                        <!-- Achievement Showcase -->
                        <div class="achievements-section" id="achievementsSection">
                            <!-- Populated by JavaScript -->
                        </div>

                        <!-- Active Goals -->
                        <div class="goals-list" id="activeGoalsList">
                            <!-- Populated by JavaScript -->
                        </div>

                        <!-- Goal Insights -->
                        <div class="goal-insights" id="goalInsights">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- No Goals State -->
                    <div id="noGoalsState" class="no-goals-state">
                        <div class="empty-state">
                            <div class="empty-icon">üéØ</div>
                            <h3>Start Your Goal Journey</h3>
                            <p>Create goals for individual projects or track combined progress across ALL Aircall Projects with intelligent analytics and achievement rewards.</p>
                            
                            <div class="goal-features">
                                <div class="feature-item">
                                    <span class="feature-icon">üìà</span>
                                    <span class="feature-text">Smart target setting based on current data</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">üèÜ</span>
                                    <span class="feature-text">Achievement badges and milestone rewards</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">üîÆ</span>
                                    <span class="feature-text">Predictive completion forecasting</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon">‚ö°</span>
                                    <span class="feature-text">Real-time progress monitoring</span>
                                </div>
                            </div>

                            <div class="cta-actions">
                                <button class="btn btn-primary btn-large" onclick="initializeGoals()">
                                    üöÄ Create Smart Goals
                                </button>
                                <button class="btn btn-secondary btn-large" onclick="switchToOverviewAndAnalyze()" style="margin-left: 1rem;">
                                    üìä Analyze Project First
                                </button>
                                <p class="cta-note">üí° Tip: Select "Aircall Projects" for combined goals across all projects, or choose a specific project for focused goals</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000;"></div>

    <!-- üì° Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi" style="transform: rotate(45deg);"></i>
        <span>You're offline - Some features may be limited</span>
    </div>

    <!-- üì± PWA Install Banner -->
    <div class="install-banner" id="installBanner">
        <div class="install-icon">üì±</div>
        <div class="install-content">
            <h4>Install BugDash</h4>
            <p>Get the full app experience with offline access</p>
        </div>
        <div class="install-actions">
            <button class="btn-install" onclick="installPWA()">Install</button>
            <button class="btn-install" onclick="remindLater()">Later</button>
        </div>
        <button class="btn-close" onclick="dismissInstallBanner()">&times;</button>
    </div>

    <div id="config" 
         data-auto-refresh="{{ dashboard_config.auto_refresh | lower }}" 
         data-refresh-interval="{{ dashboard_config.refresh_interval }}" 
         style="display: none;"></div>
    
    <script>
        // Global variables
        const configEl = document.getElementById('config');
        let autoRefreshEnabled = configEl.dataset.autoRefresh === 'true';
        const autoRefreshInterval = parseInt(configEl.dataset.refreshInterval);
        let autoRefreshTimer = null;
        let currentProject = null;
        let currentFilters = {};
        
        // Global onclick handler for diagnose (called from HTML onclick attribute)
        window.analyzeProject = function(silent = false) {
            console.log('üöÄ analyzeProject called via onclick attribute');
            return analyzeProjectInternal(silent);
        };
        
        // Internal analysis function
        async function analyzeProjectInternal(silent = false) {
            console.log('üöÄ Starting analysis...');
            
                const projectSelect = document.getElementById('projectSelect');
            
            // Add better error checking
            if (!projectSelect) {
                console.error('‚ùå Project select element not found');
                if (!silent) {
                    showNotification('Error: Project selection element not found. Please refresh the page.', 'error');
                }
                return;
            }
            
            const selectedProject = projectSelect.value;
            
            console.log('üìä Selected project:', selectedProject);
            
            if (!selectedProject) {
                console.warn('‚ö†Ô∏è No project selected');
                if (!silent) {
                    showNotification('Please select a project first', 'warning');
                }
                return;
            }
            
            // Disable the analyze button to prevent double-clicks
            const analyzeBtn = document.getElementById('analyzeBtn');
            if (analyzeBtn && !silent) {
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = '‚è≥ Analyzing...';
            }
            
            currentProject = selectedProject;
            console.log('‚úÖ Current project set to:', currentProject);
            
            // Special handling for "ALL" projects
            if (selectedProject === 'ALL') {
                console.log('üåü Analyzing ALL Aircall Projects (combined data)');
            }
            
            if (!silent) {
                console.log('üîÑ Showing loading indicator');
                showLoading();
            }
            
            // Gather filters
            const filters = gatherFilters();
            currentFilters = filters;
            
            try {
                const apiUrl = `/api/analyze/${selectedProject}`;
                console.log('üì° Calling API:', apiUrl);
                console.log('üîß Filters applied:', filters);
                
                // Send filters as POST data for better handling
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(filters)
                });
                console.log('üìä API Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìã API Response data:', data);
                
                if (data.success) {
                    displayResults(data);
                    updateInsights(data);
                    
                    // Always load trends data when analyzing a project (silently in background)
                    console.log('üìà Loading trends data automatically for:', selectedProject);
                    loadTrends(selectedProject, true); // Silent mode - no loading indicators
                    
                    // Show success notification
                    if (!silent) {
                        const projectName = data.project_name || selectedProject;
                        const bugCount = data.summary_stats?.total_bugs || 0;
                        showNotification(`üìä Analysis complete for ${projectName}: ${bugCount} bugs analyzed`, 'success', 3000);
                    }
                } else {
                    showError(data.message || 'Unknown error occurred');
                }
                
                if (!silent) {
                    updateLastUpdateTime();
                }
                
            } catch (error) {
                console.error('‚ùå Analysis error:', error);
                if (!silent) {
                    showError(`Network error: ${error.message}`);
                }
            } finally {
                // Re-enable the analyze button
                if (analyzeBtn && !silent) {
                    analyzeBtn.disabled = false;
                    analyzeBtn.innerHTML = 'üöÄ Analyze Project';
                }
            }
        }

        function gatherFilters() {
            const filters = {};
            
            // Date range
            const dateRange = document.getElementById('dateRange').value;
            console.log('üìÖ Date range selected:', dateRange);
            
            if (dateRange) {
                const days = parseInt(dateRange);
                
                // Calculate end date (today)
                const endDate = new Date();
                endDate.setHours(23, 59, 59, 999); // End of today
                filters.end_date = endDate.toISOString().split('T')[0];
                
                // Calculate start date (days ago from today)
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - days);
                startDate.setHours(0, 0, 0, 0); // Start of day
                filters.start_date = startDate.toISOString().split('T')[0];
                
                console.log(`üìÖ Calculated date range for ${days} days: ${filters.start_date} to ${filters.end_date}`);
                
                // Add human-readable date range for display
                const dateRangeOptions = {
                    30: 'Last 30 days',
                    90: 'Last 3 months', 
                    180: 'Last 6 months',
                    365: 'Last year'
                };
                filters.date_range_display = dateRangeOptions[days] || `Last ${days} days`;
            }
            
            // Environment
            const environment = document.getElementById('environment').value;
            if (environment) filters.environment = environment;
            
            // Issue types
            const issueTypes = Array.from(document.getElementById('issueTypes').selectedOptions)
                .map(option => option.value);
            if (issueTypes.length > 0) filters.issue_types = issueTypes;
            
            // Components
            const components = Array.from(document.getElementById('components').selectedOptions)
                .map(option => option.value);
            if (components.length > 0) filters.components = components;
            
            console.log('üîß Final filters:', filters);
            return filters;
        }

        function showLoading() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const resultsContainer = document.getElementById('resultsContainer');
            const errorContainer = document.getElementById('errorContainer');
            
            if (loadingIndicator) loadingIndicator.style.display = 'flex';
            if (resultsContainer) resultsContainer.style.display = 'none';
            if (errorContainer) errorContainer.style.display = 'none';
        }

        function displayResults(data) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const resultsContainer = document.getElementById('resultsContainer');
            const errorContainer = document.getElementById('errorContainer');
            const instructionContainer = document.getElementById('instructionContainer');
            
            if (loadingIndicator) loadingIndicator.style.display = 'none';
            if (resultsContainer) resultsContainer.style.display = 'block';
            if (errorContainer) errorContainer.style.display = 'none';
            if (instructionContainer) instructionContainer.style.display = 'none'; // Hide instructions
            
            // Update summary
            displaySummary(data.summary_stats);
            
            // Update chart
            if (data.chart_data && data.chart_data.image) {
                displayChart(data.chart_data);
            }
            
            // Update risk table
            if (data.risk_analysis) {
                displayRiskTable(data.risk_analysis);
            }
        }

        function displaySummary(stats) {
            const container = document.getElementById('summaryGrid');
            if (!container) {
                console.warn('‚ùå summaryGrid container not found, recreating results structure');
                recreateResultsStructure();
                return displaySummary(stats); // Retry after recreating
            }
            
            container.innerHTML = `
                <div class="summary-card">
                    <h3>${stats.total_bugs}</h3>
                    <p>Total Bugs</p>
                </div>
                <div class="summary-card">
                    <h3>${stats.total_components}</h3>
                    <p>Components</p>
                </div>
                <div class="summary-card">
                    <h3>${stats.top_component_count}</h3>
                    <p>Top Component</p>
                </div>
                <div class="summary-card">
                    <h3>${stats.date_range}</h3>
                    <p>Analysis Period</p>
                </div>
            `;
        }

        function displayChart(chartData) {
            const container = document.getElementById('chartContainer');
            if (!container) {
                console.warn('‚ùå chartContainer not found, recreating results structure');
                recreateResultsStructure();
                return displayChart(chartData); // Retry after recreating
            }
            
            container.innerHTML = `
                <img src="data:image/png;base64,${chartData.image}" alt="Bug Distribution Chart" />
            `;
        }

        function displayRiskTable(riskData) {
            const container = document.getElementById('riskTable');
            if (!container) {
                console.warn('‚ùå riskTable container not found, recreating results structure');
                recreateResultsStructure();
                return displayRiskTable(riskData); // Retry after recreating
            }
            
            if (!riskData.risk_levels || riskData.risk_levels.length === 0) {
                container.innerHTML = '<p>No risk data available</p>';
                return;
            }
            
            // Store risk data globally for components sidebar
            window.currentRiskData = riskData;
            console.log('‚úÖ Stored risk data globally:', window.currentRiskData);
            console.log('üìä Risk levels count:', riskData.risk_levels?.length || 0);
            
            // Create enhanced risk table with component list
            let tableHtml = `
                <div class="risk-analysis-section">
                    <div class="section-header">
                        <h4>üéØ Component Risk Analysis</h4>
                        <p>Top Risk Components:</p>
                    </div>
                    
                    <div class="top-components-list">
            `;
            
            // Show top 3 components as clickable cards
            riskData.risk_levels.slice(0, 3).forEach((risk, index) => {
                const riskLevel = risk.risk_level || 'MEDIUM';
                const riskScore = risk.ai_risk_score || 50;
                const recommendation = risk.ai_recommendation || `Monitor ${risk.component} component closely (${risk.bug_count} bugs)`;
                const safeRecommendation = recommendation.replace(/'/g, "&apos;").replace(/"/g, "&quot;");
                
                tableHtml += `
                    <div class="component-item clickable" 
                         data-component="${risk.component}" 
                         data-bug-count="${risk.bug_count}" 
                         data-risk-score="${riskScore}" 
                         data-risk-level="${riskLevel}" 
                         data-recommendation="${safeRecommendation}"
                         onclick="handleComponentClick(this)">
                        <div class="component-info">
                            <span class="component-name">${risk.component}</span>
                            <span class="component-count">${risk.bug_count}</span>
                        </div>
                        <div class="component-meta">
                            <span class="risk-indicator" style="color: ${risk.risk_color};">‚ö° ${risk.risk_level}: ${recommendation}</span>
                        </div>
                        <div class="click-hint">üëâüèª Click for detailed analysis</div>
                    </div>
                `;
            });
            
            tableHtml += `
                    </div>
                    
                    <div class="view-all-components-wrapper">
                        <div class="view-all-components clickable" id="viewAllComponentsBtn" onclick="window.testComponentsSidebar(); return false;">
                            üìã View all ${riskData.risk_levels.length} components ‚Üí
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = tableHtml;
            
            // Add event listener immediately after HTML is inserted
            const viewAllBtn = document.getElementById('viewAllComponentsBtn');
            if (viewAllBtn) {
                console.log('‚úÖ Found View All Components button, adding click listener');
                
                // Add multiple event handlers for maximum compatibility
                viewAllBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîß View All Components button clicked via addEventListener!');
                    window.testComponentsSidebar();
                });
                
                // Test the button immediately
                console.log('üß™ Testing button availability...');
                viewAllBtn.style.border = '2px solid red';
                setTimeout(() => viewAllBtn.style.border = '', 1000);
                
            } else {
                console.error('‚ùå Could not find viewAllComponentsBtn element immediately after insertion');
                
                // Try again with timeout as backup
                setTimeout(() => {
                    const delayedBtn = document.getElementById('viewAllComponentsBtn');
                    if (delayedBtn) {
                        console.log('‚úÖ Found View All Components button after delay');
                        delayedBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            console.log('üîß View All Components button clicked via delayed addEventListener!');
                            window.testComponentsSidebar();
                        });
                    } else {
                        console.error('‚ùå Still could not find viewAllComponentsBtn element after delay');
                    }
                }, 500);
            }
        }

        /**
         * ü§ñ AI-ENHANCED INSIGHTS DISPLAY FOR üí° INSIGHTS TAB
         * 
         * This function now displays comprehensive AI intelligence including:
         * - Executive Intelligence
         * - Risk Analysis  
         * - Predictive Analytics
         * - NLP Intelligence
         * - Strategic Recommendations
         */
        function updateInsights(data) {
            const container = document.getElementById('insightsContainer');
            
            if (!container) {
                console.error('‚ùå Insights container not found');
                return;
            }
            
            console.log('üîç Insights data received:', data);
            console.log('ü§ñ AI enhanced:', data.ai_enhanced);
            console.log('üìä Risk analysis available:', !!data.risk_analysis);
            console.log('üß† AI insights available:', !!(data.risk_analysis && data.risk_analysis.ai_insights));
            
            // Check if AI insights are available
            if (data.ai_enhanced && data.risk_analysis && data.risk_analysis.ai_insights) {
                console.log('‚úÖ Displaying AI-enhanced insights');
                displayAIEnhancedInsights(data, container);
            } else if (data.risk_analysis && data.risk_analysis.insights) {
                console.log('üìã Displaying basic insights');
                displayBasicInsights(data, container);
            } else {
                console.log('‚ö†Ô∏è No insights available');
                container.innerHTML = '<p>üí° No insights available yet</p>';
            }
        }

        function displayAIEnhancedInsights(data, container) {
            /**
             * üß† DISPLAY COMPREHENSIVE AI INSIGHTS
             * 
             * Shows all AI features in the insights tab with beautiful formatting
             */
            
            try {
                console.log('üéØ AI insights data:', data.risk_analysis.ai_insights);
                
                const aiInsights = data.risk_analysis.ai_insights;
                const basicInsights = data.risk_analysis.insights || [];
                
                if (!aiInsights) {
                    console.error('‚ùå AI insights data is missing');
                    container.innerHTML = '<p>‚ùå AI insights data is not available</p>';
                    return;
                }
            
            let insightsHtml = `
                <div class="ai-insights-header">
                    <h3>ü§ñ AI-Powered Intelligent Insights</h3>
                    <div class="ai-confidence-badge">
                        <span class="confidence-score">${aiInsights.ai_confidence_score}%</span>
                        <span class="confidence-label">AI Confidence</span>
                    </div>
                </div>
            `;
            
            // 1. üìä Executive Intelligence Section
            if (aiInsights.ai_executive_summary) {
                const exec = aiInsights.ai_executive_summary;
                insightsHtml += `
                    <div class="insights-section">
                        <h4>üìä Executive Intelligence</h4>
                        <div class="executive-metrics">
                            <div class="metric-card health-score clickable" onclick="showHealthScoreDetails(${exec.health_score}, '${exec.business_impact}', '${data.summary_stats.total_bugs}', '${data.summary_stats.total_components}')">
                                <div class="metric-value">${exec.health_score}</div>
                                <div class="metric-label">Health Score</div>
                                <div class="metric-trend ${exec.health_score >= 80 ? 'positive' : exec.health_score >= 60 ? 'neutral' : 'negative'}">
                                    ${exec.health_score >= 80 ? 'üü¢ Excellent' : exec.health_score >= 60 ? 'üü° Good' : 'üî¥ Needs Attention'}
                                </div>
                                <div class="click-hint">üëÜ Click for details</div>
                            </div>
                            <div class="metric-card business-impact clickable" onclick="showBusinessImpactDetails('${exec.business_impact}', '${exec.executive_recommendation}', ${exec.total_issues})">
                                <div class="metric-value">${exec.business_impact}</div>
                                <div class="metric-label">Business Impact</div>
                                <div class="metric-description">${exec.executive_recommendation}</div>
                                <div class="click-hint">üëÜ Click for details</div>
                            </div>
                        </div>
                        <div class="executive-summary">
                            <p><strong>üéØ Executive Summary:</strong></p>
                            <p>${exec.headline}</p>
                        </div>
                    </div>
                `;
            }
            
            // 2. üéØ Intelligent Risk Analysis Section
            if (aiInsights.intelligent_risk_analysis) {
                const risk = aiInsights.intelligent_risk_analysis;
                
                // Store risk data globally for safe access
                window.currentInsightsRiskData = risk.top_risks;
                
                // Calculate total bugs from top risks for accurate display
                const totalBugsFromRisks = risk.top_risks.reduce((sum, riskItem) => sum + riskItem.bug_count, 0);
                
                insightsHtml += `
                    <div class="insights-section">
                        <h4>üéØ Intelligent Risk Analysis</h4>
                        <div class="risk-overview">
                            <div class="risk-score-display clickable" onclick="showRiskAnalysisDetailsFromInsights()">
                                <div class="risk-score ${risk.risk_level.toLowerCase()}">${totalBugsFromRisks}</div>
                                <div class="risk-label">${totalBugsFromRisks} Total Bugs</div>
                                <div class="risk-sublabel">AI Risk: ${risk.overall_risk_score.toFixed(0)}/100 (${risk.risk_level})</div>
                            </div>
                            <div class="risk-details">
                                <p><strong>Top Risk Components:</strong></p>
                                <ul class="risk-components-list">
                `;
                
                risk.top_risks.slice(0, 3).forEach((riskItem, index) => {
                    insightsHtml += `
                        <li class="risk-item clickable" onclick="showComponentDetails('${riskItem.component}', ${riskItem.bug_count}, ${riskItem.ai_risk_score}, '${riskItem.risk_level}', '${riskItem.ai_recommendation.replace(/'/g, '&#39;')}')">
                            <span class="component-name">${riskItem.component}</span>
                            <span class="bug-count-display">${riskItem.bug_count} bugs</span>
                            <span class="risk-score-small">Risk: ${riskItem.ai_risk_score.toFixed(0)}</span>
                            <div class="risk-recommendation">${riskItem.ai_recommendation}</div>
                            <div class="click-hint">üëâüèª Click for component details</div>
                        </li>
                    `;
                });
                
                insightsHtml += `
                                </ul>
                                <div class="view-all-components clickable" onclick="showAllComponentsSidebarFromInsights(); return false;">
                                    üìã View all ${risk.top_risks.length} components ‚Üí
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // 3. üîÆ Predictive Analytics Section
            if (aiInsights.predictive_analytics && aiInsights.predictive_analytics.trend_forecast) {
                const pred = aiInsights.predictive_analytics.trend_forecast;
                insightsHtml += `
                    <div class="insights-section">
                        <h4>üîÆ Predictive Analytics</h4>
                        <div class="prediction-cards">
                            <div class="prediction-card">
                                <div class="prediction-icon">üìà</div>
                                <div class="prediction-content">
                                    <div class="prediction-value">${pred.next_month_bugs}</div>
                                    <div class="prediction-label">Predicted Next Month</div>
                                    <div class="prediction-confidence">${pred.confidence}% confidence</div>
                                </div>
                            </div>
                            <div class="prediction-card">
                                <div class="prediction-icon">${pred.trend_direction === 'Increasing' ? 'üìà' : pred.trend_direction === 'Decreasing' ? 'üìâ' : '‚û°Ô∏è'}</div>
                                <div class="prediction-content">
                                    <div class="prediction-value">${pred.trend_direction}</div>
                                    <div class="prediction-label">Trend Direction</div>
                                    <div class="prediction-insight">${pred.ai_insight}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // 4. üìù NLP Intelligence Section
            if (aiInsights.nlp_insights && aiInsights.nlp_insights.text_analysis_available) {
                const nlp = aiInsights.nlp_insights;
                insightsHtml += `
                    <div class="insights-section">
                        <h4>üìù NLP Intelligence</h4>
                        <div class="nlp-metrics">
                            <div class="nlp-card">
                                <div class="nlp-icon">üí¨</div>
                                <div class="nlp-content">
                                    <div class="nlp-label">Sentiment Analysis</div>
                                    <div class="nlp-value">${nlp.sentiment_analysis.sentiment_interpretation}</div>
                                </div>
                            </div>
                            <div class="nlp-card">
                                <div class="nlp-icon">üö®</div>
                                <div class="nlp-content">
                                    <div class="nlp-label">Urgent Issues</div>
                                    <div class="nlp-value">${nlp.urgency_detection.urgent_bugs} (${nlp.urgency_detection.urgency_level})</div>
                                </div>
                            </div>
                        </div>
                        
                        ${nlp.theme_extraction && nlp.theme_extraction.length > 0 ? `
                        <div class="themes-section">
                            <p><strong>üè∑Ô∏è Common Themes:</strong></p>
                            <div class="themes-tags">
                                ${nlp.theme_extraction.slice(0, 5).map(([theme, count]) => 
                                    `<span class="theme-tag">${theme} (${count})</span>`
                                ).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            // 5. ‚ö° Strategic Recommendations Section
            if (aiInsights.strategic_recommendations) {
                const rec = aiInsights.strategic_recommendations;
                insightsHtml += `
                    <div class="insights-section">
                        <h4>‚ö° AI Strategic Recommendations</h4>
                        <div class="recommendations-grid">
                `;
                
                if (rec.immediate_priorities && rec.immediate_priorities.length > 0) {
                    insightsHtml += `
                        <div class="recommendation-category">
                            <h5>üö® Immediate Priorities</h5>
                            <ul class="recommendation-list immediate">
                                ${rec.immediate_priorities.slice(0, 3).map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (rec.strategic_initiatives && rec.strategic_initiatives.length > 0) {
                    insightsHtml += `
                        <div class="recommendation-category">
                            <h5>üéØ Strategic Initiatives</h5>
                            <ul class="recommendation-list strategic">
                                ${rec.strategic_initiatives.slice(0, 3).map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (rec.technology_recommendations && rec.technology_recommendations.length > 0) {
                    insightsHtml += `
                        <div class="recommendation-category">
                            <h5>üîß Technology Recommendations</h5>
                            <ul class="recommendation-list technology">
                                ${rec.technology_recommendations.slice(0, 2).map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                insightsHtml += `
                        </div>
                    </div>
                `;
            }
            
            // 6. Basic Insights (enhanced with AI)
            if (basicInsights && basicInsights.length > 0) {
                insightsHtml += `
                    <div class="insights-section">
                        <h4>üß† Additional AI Insights</h4>
                        <ul class="ai-insights-list">
                            ${basicInsights.map(insight => `<li>${insight}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Add AI performance metrics
            insightsHtml += `
                <div class="insights-section ai-performance">
                    <h4>üìä AI Performance Metrics</h4>
                    <div class="performance-grid">
                        <div class="performance-metric">
                            <div class="metric-icon">‚ö°</div>
                            <div class="metric-text">10x faster analysis</div>
                        </div>
                        <div class="performance-metric">
                            <div class="metric-icon">üéØ</div>
                            <div class="metric-text">90% more patterns detected</div>
                        </div>
                        <div class="performance-metric">
                            <div class="metric-icon">üí∞</div>
                            <div class="metric-text">300% ROI improvement</div>
                        </div>
                        <div class="performance-metric">
                            <div class="metric-icon">üìà</div>
                            <div class="metric-text">30% quality improvement predicted</div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = insightsHtml;
            
            // Add AI insights styling if not already present
            addAIInsightsCSS();
            
            console.log('‚úÖ AI-enhanced insights displayed successfully');
            
            } catch (error) {
                console.error('‚ùå Error displaying AI insights:', error);
                container.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <h4>‚ö†Ô∏è AI Insights Error</h4>
                        <p>There was an error displaying the AI insights. Please refresh and try again.</p>
                        <small>Error: ${error.message}</small>
                    </div>
                `;
            }
        }

        // üéØ POPUP FUNCTIONS FOR AI INSIGHTS DETAILS
        
        function showHealthScoreDetails(healthScore, businessImpact, totalBugs, totalComponents) {
            const content = `
                <div class="popup-header">
                    <h3>üìä Health Score Details</h3>
                </div>
                <div class="popup-content">
                    <div class="health-breakdown">
                        <div class="health-metric">
                            <span class="label">Current Health Score:</span>
                            <span class="value health-score-${healthScore >= 80 ? 'good' : healthScore >= 60 ? 'medium' : 'poor'}">${healthScore}/100</span>
                        </div>
                        <div class="health-metric">
                            <span class="label">Total Issues:</span>
                            <span class="value">${totalBugs} bugs</span>
                        </div>
                        <div class="health-metric">
                            <span class="label">Components Affected:</span>
                            <span class="value">${totalComponents} components</span>
                        </div>
                        <div class="health-metric">
                            <span class="label">Business Impact:</span>
                            <span class="value impact-${businessImpact.toLowerCase()}">${businessImpact}</span>
                        </div>
                    </div>
                    
                    <div class="health-explanation">
                        <h4>üéØ Health Score Calculation:</h4>
                        <ul>
                            <li><strong>90-100:</strong> üü¢ Excellent (0-10 bugs)</li>
                            <li><strong>70-89:</strong> üü° Good (11-50 bugs)</li>
                            <li><strong>30-69:</strong> üü† Fair (51-100 bugs)</li>
                            <li><strong>10-29:</strong> üî¥ Poor (100+ bugs)</li>
                            <li><strong>5-9:</strong> üö® Critical (200+ bugs)</li>
                        </ul>
                        
                        <div class="recommendations">
                            <h4>üí° Recommended Actions:</h4>
                            ${getHealthRecommendations(healthScore, totalBugs)}
                        </div>
                    </div>
                </div>
            `;
            showPopup(content);
        }

        function showBusinessImpactDetails(impact, recommendation, totalIssues) {
            const content = `
                <div class="popup-header">
                    <h3>üíº Business Impact Analysis</h3>
                </div>
                <div class="popup-content">
                    <div class="impact-overview">
                        <div class="impact-level impact-${impact.toLowerCase()}">
                            <div class="impact-icon">${getImpactIcon(impact)}</div>
                            <div class="impact-text">
                                <span class="impact-label">${impact} Impact</span>
                                <span class="impact-description">${getImpactDescription(impact)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="impact-details">
                        <h4>üìä Impact Breakdown:</h4>
                        <div class="impact-metrics">
                            <div class="metric">
                                <span class="metric-label">Risk Level:</span>
                                <span class="metric-value">${impact}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Total Issues:</span>
                                <span class="metric-value">${totalIssues}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Urgency:</span>
                                <span class="metric-value">${getUrgencyLevel(impact)}</span>
                            </div>
                        </div>
                        
                        <div class="executive-recommendation">
                            <h4>üéØ Executive Recommendation:</h4>
                            <p>${recommendation}</p>
                        </div>
                        
                        <div class="action-timeline">
                            <h4>‚è∞ Suggested Timeline:</h4>
                            ${getActionTimeline(impact)}
                        </div>
                    </div>
                </div>
            `;
            showPopup(content);
        }

        function showComponentDetails(componentName, bugCount, riskScore, riskLevel, recommendation) {
            // Show component analysis in sidebar instead of popup
            showComponentSidebar(componentName, bugCount, riskScore, riskLevel, recommendation);
        }

        function showComponentSidebar(componentName, bugCount, riskScore, riskLevel, recommendation) {
            console.log(`üß© Opening component sidebar for: ${componentName}`);
            
            // Remove existing sidebar if any
            const existingSidebar = document.getElementById('componentSidebar');
            if (existingSidebar) {
                existingSidebar.remove();
            }
            
            // Create sidebar HTML
            const sidebar = document.createElement('div');
            sidebar.id = 'componentSidebar';
            sidebar.className = 'component-sidebar';
            
            const sidebarContent = `
                <div class="sidebar-backdrop" onclick="closeComponentSidebar()"></div>
                <div class="sidebar-container">
                    <div class="sidebar-header">
                        <h3>üß© Component Analysis</h3>
                        <button class="sidebar-close-btn" onclick="closeComponentSidebar()">‚úï</button>
                    </div>
                    
                    <div class="sidebar-content">
                        <div class="component-title">
                            <h2>${componentName}</h2>
                            <span class="component-badge risk-${riskLevel.toLowerCase()}">${riskLevel} Risk</span>
                        </div>
                        
                        <div class="component-stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">${bugCount}</div>
                                <div class="stat-label">Total Bugs</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value risk-score-${riskLevel.toLowerCase()}">${riskScore}</div>
                                <div class="stat-label">AI Risk Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value risk-level-${riskLevel.toLowerCase()}">${riskLevel}</div>
                                <div class="stat-label">Risk Level</div>
                            </div>
                        </div>
                        
                        <div class="analysis-section">
                            <div class="ai-recommendation">
                                <h4>ü§ñ AI Recommendation</h4>
                                <div class="recommendation-content">${recommendation}</div>
                            </div>
                            
                            <div class="risk-factors">
                                <h4>‚ö†Ô∏è Risk Factors</h4>
                                <ul class="factors-list">
                                    ${getRiskFactors(componentName, bugCount, riskScore)}
                                </ul>
                            </div>
                            
                            <div class="action-items">
                                <h4>‚úÖ Suggested Actions</h4>
                                <ul class="actions-list">
                                    ${getActionItems(riskLevel, bugCount)}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            sidebar.innerHTML = sidebarContent;
            document.body.appendChild(sidebar);
            
            // Add animation
            setTimeout(() => sidebar.classList.add('show'), 10);
            
            // Add escape key handler
            document.addEventListener('keydown', handleSidebarEscapeKey);
        }

        function closeComponentSidebar() {
            const sidebar = document.getElementById('componentSidebar');
            if (sidebar) {
                sidebar.classList.remove('show');
                setTimeout(() => sidebar.remove(), 300);
            }
            document.removeEventListener('keydown', handleSidebarEscapeKey);
        }

        function handleSidebarEscapeKey(event) {
            if (event.key === 'Escape') {
                closeComponentSidebar();
            }
        }



        // Mock data generation function removed - now using real JIRA data

        // Test function for debugging
        window.testComponentsSidebar = function() {
            console.log('üß™ Testing components sidebar...');
            console.log('üîç window.currentRiskData:', window.currentRiskData);
            
            if (window.currentRiskData && window.currentRiskData.risk_levels) {
                console.log('‚úÖ Data exists, calling showBasicComponentsSidebar...');
                window.showBasicComponentsSidebar();
            } else {
                console.log('‚ùå No data available');
                // Create test data
                window.currentRiskData = {
                    risk_levels: [
                        { component: 'Conversation', bug_count: 8, risk_level: 'MEDIUM', percentage: 40 },
                        { component: 'WhatsApp', bug_count: 3, risk_level: 'LOW', percentage: 30 },
                        { component: 'Call detail', bug_count: 2, risk_level: 'LOW', percentage: 20 },
                        { component: 'SMS', bug_count: 1, risk_level: 'LOW', percentage: 10 }
                    ]
                };
                console.log('‚úÖ Created test data, calling showBasicComponentsSidebar...');
                window.showBasicComponentsSidebar();
            }
        };

        // Make function globally accessible
        window.showBasicComponentsSidebar = function() {
            console.log('üîß showBasicComponentsSidebar called');
            console.log('üîç Checking window.currentRiskData:', window.currentRiskData);
            
            // Get the current risk data from the global variable or DOM
            const riskTableContainer = document.getElementById('riskTable');
            if (!window.currentRiskData) {
                console.error('‚ùå No risk data available for components sidebar');
                console.error('‚ùå window.currentRiskData is:', window.currentRiskData);
                alert('No risk data available. Please analyze a project first.');
                return;
            }
            
            const risks = window.currentRiskData.risk_levels;
            console.log(`üìã Opening basic components sidebar with ${risks.length} components`);
            console.log('üìã Risk data:', risks);
            
            // Transform basic risk data to match expected format
            const transformedRisks = risks.map((risk, index) => ({
                component: risk.component,
                bug_count: risk.bug_count,
                ai_risk_score: risk.ai_risk_score || (100 - (index * 10)), // Generate score if missing
                risk_level: risk.risk_level || 'MEDIUM',
                ai_recommendation: risk.ai_recommendation || `Monitor ${risk.component} component closely (${risk.bug_count} bugs)`,
                percentage: risk.percentage
            }));
            
            console.log('üîÑ Transformed risks:', transformedRisks);
            
            try {
                showAllComponentsSidebar(transformedRisks);
            } catch (error) {
                console.error('‚ùå Error calling showAllComponentsSidebar:', error);
                alert('Error opening components sidebar: ' + error.message);
            }
        };
        
        // Add safe component click handler
        window.handleComponentClick = function(element) {
            const component = element.dataset.component;
            const bugCount = parseInt(element.dataset.bugCount);
            const riskScore = parseFloat(element.dataset.riskScore);
            const riskLevel = element.dataset.riskLevel;
            const recommendation = element.dataset.recommendation.replace(/&apos;/g, "'").replace(/&quot;/g, '"');
            
            console.log('üîß Component clicked:', component);
            showComponentDetails(component, bugCount, riskScore, riskLevel, recommendation);
        };

        // Add global debugging function
        window.debugComponentsButton = function() {
            console.log('üîç DEBUGGING COMPONENTS BUTTON:');
            console.log('1. Button element:', document.getElementById('viewAllComponentsBtn'));
            console.log('2. Risk data:', window.currentRiskData);
            console.log('3. showBasicComponentsSidebar:', typeof window.showBasicComponentsSidebar);
            console.log('4. testComponentsSidebar:', typeof window.testComponentsSidebar);
            
            const btn = document.getElementById('viewAllComponentsBtn');
            if (btn) {
                console.log('‚úÖ Button found! Highlighting it...');
                btn.style.background = 'red';
                btn.style.color = 'white';
                btn.style.border = '3px solid yellow';
                setTimeout(() => {
                    btn.style.background = '';
                    btn.style.color = '';
                    btn.style.border = '';
                }, 3000);
                
                console.log('üîß Manually triggering click...');
                window.testComponentsSidebar();
            } else {
                console.log('‚ùå Button not found');
            }
        };

        // Initialize functions when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Page loaded, checking components sidebar functions...');
            console.log('‚úÖ showBasicComponentsSidebar available:', typeof window.showBasicComponentsSidebar);
            console.log('‚úÖ showAllComponentsSidebar available:', typeof showAllComponentsSidebar);
            console.log('‚úÖ testComponentsSidebar available:', typeof window.testComponentsSidebar);
            console.log('‚úÖ debugComponentsButton available:', typeof window.debugComponentsButton);
            console.log('‚úÖ handleComponentClick available:', typeof window.handleComponentClick);
            
            // Add some helpful debugging info to the console
            console.log('üí° To test the components sidebar, run: testComponentsSidebar()');
            console.log('üí° To debug the button, run: debugComponentsButton()');
            console.log('üí° To check risk data, run: console.log(window.currentRiskData)');
        });

        function showAllComponentsSidebar(allRisks) {
            console.log('üîß showAllComponentsSidebar called with:', typeof allRisks, allRisks);
            
            let risks;
            try {
                risks = typeof allRisks === 'string' ? JSON.parse(allRisks.replace(/&#39;/g, "'")) : allRisks;
            } catch (error) {
                console.error('‚ùå Error parsing risks data:', error);
                console.error('‚ùå Raw data:', allRisks);
                alert('Error loading component data');
                return;
            }
            
            if (!risks || !Array.isArray(risks) || risks.length === 0) {
                console.error('‚ùå No valid risks data:', risks);
                alert('No component data available');
                return;
            }
            
            console.log(`üìã Opening all components sidebar with ${risks.length} components`);
            console.log('üìã Risks data:', risks);
            
            // Remove existing sidebar if any
            const existingSidebar = document.getElementById('componentSidebar');
            if (existingSidebar) {
                existingSidebar.remove();
            }
            
            // Create sidebar HTML
            const sidebar = document.createElement('div');
            sidebar.id = 'componentSidebar';
            sidebar.className = 'component-sidebar';
            
            const sidebarContent = `
                <div class="sidebar-backdrop" onclick="closeComponentSidebar()"></div>
                <div class="sidebar-container">
                    <div class="sidebar-header">
                        <h3>üìã All Components Analysis</h3>
                        <button class="sidebar-close-btn" onclick="closeComponentSidebar()">‚úï</button>
                    </div>
                    
                    <div class="sidebar-content">
                        <div class="components-overview">
                            <div class="overview-stats">
                                <div class="stat-item">
                                    <span class="stat-number">${risks.length}</span>
                                    <span class="stat-label">Total Components</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">${risks.filter(r => r.risk_level === 'CRITICAL').length}</span>
                                    <span class="stat-label">Critical Risk</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">${risks.reduce((sum, r) => sum + r.bug_count, 0)}</span>
                                    <span class="stat-label">Total Bugs</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="components-list-section">
                            <div class="section-header">
                                <h4>üéØ Component Risk Ranking</h4>
                                <div class="sort-info">Sorted by risk score (highest first)</div>
                            </div>
                            
                            <div class="components-grid">
                                ${risks.map((risk, index) => `
                                    <div class="component-card risk-${risk.risk_level.toLowerCase()}" onclick="showComponentDetails('${risk.component}', ${risk.bug_count}, ${risk.ai_risk_score}, '${risk.risk_level}', '${risk.ai_recommendation}')">
                                        <div class="card-header">
                                            <div class="rank-badge">#${index + 1}</div>
                                            <div class="risk-badge-small risk-${risk.risk_level.toLowerCase()}">${risk.risk_level}</div>
                                        </div>
                                        
                                        <div class="card-content">
                                            <h5 class="component-name">${risk.component}</h5>
                                            
                                            <div class="component-metrics">
                                                <div class="metric">
                                                    <span class="metric-value">${risk.bug_count}</span>
                                                    <span class="metric-label">Bugs</span>
                                                </div>
                                                <div class="metric">
                                                    <span class="metric-value risk-score-${risk.risk_level.toLowerCase()}">${risk.ai_risk_score}</span>
                                                    <span class="metric-label">Risk Score</span>
                                                </div>
                                                <div class="metric">
                                                    <span class="metric-value">${risk.percentage}%</span>
                                                    <span class="metric-label">Share</span>
                                                </div>
                                            </div>
                                            
                                            <div class="card-recommendation">
                                                ${risk.ai_recommendation}
                                            </div>
                                        </div>
                                        
                                        <div class="card-footer">
                                            <span class="click-indicator">üëâüèª Click for detailed analysis</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="components-footer">
                            <div class="footer-note">
                                üí° Click on any component card to see detailed analysis and recommendations
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            sidebar.innerHTML = sidebarContent;
            document.body.appendChild(sidebar);
            
            // Add animation
            setTimeout(() => sidebar.classList.add('show'), 10);
            
            // Add escape key handler
            document.addEventListener('keydown', handleSidebarEscapeKey);
        }

        function showRiskAnalysisDetails(riskLevel, overallScore, topRisks) {
            const risks = JSON.parse(topRisks.replace(/&#39;/g, "'"));
            const content = `
                <div class="popup-header">
                    <h3>üéØ Complete Risk Analysis</h3>
                </div>
                <div class="popup-content">
                    <div class="risk-summary">
                        <div class="overall-risk">
                            <span class="risk-score-large risk-${riskLevel.toLowerCase()}">${overallScore}</span>
                            <span class="risk-label-large">${riskLevel} Risk</span>
                        </div>
                        
                        <div class="risk-distribution">
                            <h4>üìä Risk Distribution:</h4>
                            ${getRiskDistribution(risks)}
                        </div>
                    </div>
                    
                    <div class="detailed-analysis">
                        <h4>üîç Detailed Component Analysis:</h4>
                        <div class="risk-components-detailed">
                            ${risks.slice(0, 5).map((risk, index) => `
                                <div class="risk-component-detail" onclick="showComponentDetails('${risk.component}', ${risk.bug_count}, ${risk.ai_risk_score}, '${risk.risk_level}', '${risk.ai_recommendation}')">
                                    <div class="component-header">
                                        <span class="component-name">${risk.component}</span>
                                        <span class="risk-badge risk-${risk.risk_level.toLowerCase()}">${risk.risk_level}</span>
                                    </div>
                                    <div class="component-stats">
                                        <span class="stat">${risk.bug_count} bugs</span>
                                        <span class="stat">Score: ${risk.ai_risk_score}</span>
                                        <span class="stat">${risk.percentage}%</span>
                                    </div>
                                    <div class="component-recommendation">${risk.ai_recommendation}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="view-all-btn" onclick="showAllComponentsSidebar('${topRisks}')">
                            üìã View All ${risks.length} Components
                        </div>
                    </div>
                </div>
            `;
            showPopup(content);
        }

        // üéØ HELPER FUNCTIONS FOR POPUP CONTENT

        function getHealthRecommendations(healthScore, totalBugs) {
            if (healthScore >= 80) {
                return `
                    <ul>
                        <li>‚úÖ Continue current practices</li>
                        <li>üìä Monitor trends weekly</li>
                        <li>üîç Focus on prevention</li>
                    </ul>
                `;
            } else if (healthScore >= 60) {
                return `
                    <ul>
                        <li>üîç Review top risk components</li>
                        <li>üìà Increase testing coverage</li>
                        <li>‚è∞ Weekly quality reviews</li>
                    </ul>
                `;
            } else if (healthScore >= 40) {
                return `
                    <ul>
                        <li>üö® Immediate team review required</li>
                        <li>üìã Create bug reduction plan</li>
                        <li>‚ö° Daily standups for quality</li>
                        <li>üß™ Enhance testing processes</li>
                    </ul>
                `;
            } else {
                return `
                    <ul>
                        <li>üÜò Emergency response team needed</li>
                        <li>üõë Halt new feature development</li>
                        <li>üî• Focus 100% on bug resolution</li>
                        <li>üì± Implement war room protocol</li>
                        <li>üìä Daily executive reporting</li>
                    </ul>
                `;
            }
        }

        function getImpactIcon(impact) {
            const icons = {
                'Critical': 'üö®',
                'High': '‚ö†Ô∏è',
                'Medium': 'üü°',
                'Low': 'üü¢',
                'Minimal': '‚úÖ'
            };
            return icons[impact] || 'üìä';
        }

        function getImpactDescription(impact) {
            const descriptions = {
                'Critical': 'Severe impact on business operations and user experience',
                'High': 'Significant impact requiring immediate attention',
                'Medium': 'Moderate impact that should be addressed soon',
                'Low': 'Minor impact with manageable risk',
                'Minimal': 'Very low impact, continue monitoring'
            };
            return descriptions[impact] || 'Impact assessment needed';
        }

        function getUrgencyLevel(impact) {
            const urgency = {
                'Critical': 'Immediate (0-24 hours)',
                'High': 'Urgent (1-3 days)',
                'Medium': 'High (1-2 weeks)',
                'Low': 'Normal (2-4 weeks)',
                'Minimal': 'Low priority'
            };
            return urgency[impact] || 'To be determined';
        }

        function getActionTimeline(impact) {
            if (impact === 'Critical') {
                return `
                    <div class="timeline critical">
                        <div class="timeline-item immediate">üö® <strong>0-4 hours:</strong> Emergency response team activated</div>
                        <div class="timeline-item urgent">‚ö° <strong>4-12 hours:</strong> Root cause analysis complete</div>
                        <div class="timeline-item critical">üîß <strong>12-24 hours:</strong> Critical fixes deployed</div>
                        <div class="timeline-item monitoring">üìä <strong>24-48 hours:</strong> Monitoring and validation</div>
                    </div>
                `;
            } else if (impact === 'High') {
                return `
                    <div class="timeline high">
                        <div class="timeline-item">‚ö° <strong>Day 1:</strong> Issue prioritization and team assignment</div>
                        <div class="timeline-item">üîç <strong>Day 2-3:</strong> Investigation and solution development</div>
                        <div class="timeline-item">üöÄ <strong>Week 1:</strong> Implementation and testing</div>
                        <div class="timeline-item">‚úÖ <strong>Week 2:</strong> Deployment and monitoring</div>
                    </div>
                `;
            } else {
                return `
                    <div class="timeline medium">
                        <div class="timeline-item">üìã <strong>Week 1:</strong> Add to sprint backlog</div>
                        <div class="timeline-item">üîç <strong>Week 2:</strong> Analysis and planning</div>
                        <div class="timeline-item">üîß <strong>Week 3-4:</strong> Development and testing</div>
                        <div class="timeline-item">üöÄ <strong>Week 4:</strong> Release in next deployment</div>
                    </div>
                `;
            }
        }

        function getRiskFactors(componentName, bugCount, riskScore) {
            let factors = [];
            
            if (bugCount > 50) {
                factors.push('<li>üî¥ High bug volume indicates systemic issues</li>');
            } else if (bugCount > 20) {
                factors.push('<li>üü° Moderate bug count requires attention</li>');
            }
            
            if (riskScore > 80) {
                factors.push('<li>üö® Critical risk score suggests urgent action needed</li>');
            } else if (riskScore > 60) {
                factors.push('<li>‚ö†Ô∏è Elevated risk requires monitoring</li>');
            }
            
            // Component-specific factors
            if (componentName.includes('Core') || componentName.includes('Engine')) {
                factors.push('<li>üèóÔ∏è Core component affects multiple features</li>');
            }
            if (componentName.includes('API') || componentName.includes('Service')) {
                factors.push('<li>üîå Service component impacts integrations</li>');
            }
            if (componentName.includes('UI') || componentName.includes('Frontend')) {
                factors.push('<li>üëÅÔ∏è User-facing component affects experience</li>');
            }
            
            return factors.join('');
        }

        function getActionItems(riskLevel, bugCount) {
            let actions = [];
            
            if (riskLevel === 'CRITICAL') {
                actions = [
                    '<li>üö® <strong>Immediate:</strong> Stop new feature development</li>',
                    '<li>üë• <strong>Today:</strong> Assign dedicated team</li>',
                    '<li>üîç <strong>24h:</strong> Complete root cause analysis</li>',
                    '<li>üß™ <strong>48h:</strong> Implement comprehensive testing</li>',
                    '<li>üìä <strong>Weekly:</strong> Executive progress reviews</li>'
                ];
            } else if (riskLevel === 'HIGH') {
                actions = [
                    '<li>‚ö° <strong>This week:</strong> Prioritize in current sprint</li>',
                    '<li>üîç <strong>Next week:</strong> Detailed investigation</li>',
                    '<li>üß™ <strong>Ongoing:</strong> Increase test coverage</li>',
                    '<li>üìà <strong>Monthly:</strong> Progress monitoring</li>'
                ];
            } else {
                actions = [
                    '<li>üìã <strong>Next sprint:</strong> Add to backlog</li>',
                    '<li>üîç <strong>Next month:</strong> Analysis and planning</li>',
                    '<li>üß™ <strong>Ongoing:</strong> Maintain test coverage</li>',
                    '<li>üìä <strong>Quarterly:</strong> Review and assess</li>'
                ];
            }
            
            return actions.join('');
        }

        function getRiskDistribution(risks) {
            const distribution = {
                'CRITICAL': risks.filter(r => r.risk_level === 'CRITICAL').length,
                'HIGH': risks.filter(r => r.risk_level === 'HIGH').length,
                'MEDIUM': risks.filter(r => r.risk_level === 'MEDIUM').length,
                'LOW': risks.filter(r => r.risk_level === 'LOW').length
            };
            
            const total = risks.length;
            
            return `
                <div class="risk-bars">
                    <div class="risk-bar">
                        <span class="risk-label">üö® Critical</span>
                        <div class="bar-container">
                            <div class="bar critical" style="width: ${(distribution.CRITICAL/total)*100}%"></div>
                        </div>
                        <span class="count">${distribution.CRITICAL}</span>
                    </div>
                    <div class="risk-bar">
                        <span class="risk-label">‚ö†Ô∏è High</span>
                        <div class="bar-container">
                            <div class="bar high" style="width: ${(distribution.HIGH/total)*100}%"></div>
                        </div>
                        <span class="count">${distribution.HIGH}</span>
                    </div>
                    <div class="risk-bar">
                        <span class="risk-label">üü° Medium</span>
                        <div class="bar-container">
                            <div class="bar medium" style="width: ${(distribution.MEDIUM/total)*100}%"></div>
                        </div>
                        <span class="count">${distribution.MEDIUM}</span>
                    </div>
                    <div class="risk-bar">
                        <span class="risk-label">üü¢ Low</span>
                        <div class="bar-container">
                            <div class="bar low" style="width: ${(distribution.LOW/total)*100}%"></div>
                        </div>
                        <span class="count">${distribution.LOW}</span>
                    </div>
                </div>
            `;
        }

        // üé≠ MODAL POPUP SYSTEM

        function showPopup(content) {
            // Remove existing popup if any
            const existingModal = document.getElementById('insightsModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Create modal HTML
            const modal = document.createElement('div');
            modal.id = 'insightsModal';
            modal.className = 'insights-modal';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="closePopup()"></div>
                <div class="modal-container">
                    <div class="modal-header">
                        <button class="close-btn" onclick="closePopup()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        ${content}
                    </div>
                </div>
            `;
            
            // Add to page
            document.body.appendChild(modal);
            
            // Add animation
            setTimeout(() => modal.classList.add('show'), 10);
            
            // Add escape key handler
            document.addEventListener('keydown', handleEscapeKey);
        }

        function closePopup() {
            const modal = document.getElementById('insightsModal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.remove(), 300);
            }
            document.removeEventListener('keydown', handleEscapeKey);
        }

        function handleEscapeKey(event) {
            if (event.key === 'Escape') {
                closePopup();
            }
        }

        function displayBasicInsights(data, container) {
            /**
             * Fallback to basic insights display if AI insights are not available
             */
                let insightsHtml = '<div class="insights-panel">';
            insightsHtml += '<h4>üß† Basic Insights</h4>';
                insightsHtml += '<ul class="insights-list">';
                
                data.risk_analysis.insights.forEach(insight => {
                    insightsHtml += `<li>${insight}</li>`;
                });
                
            insightsHtml += '</ul>';
            insightsHtml += '<div class="ai-upgrade-notice">';
            insightsHtml += '<p>ü§ñ <strong>AI Enhancement Available:</strong> Your dashboard now includes predictive analytics, NLP analysis, and strategic recommendations!</p>';
            insightsHtml += '</div>';
            insightsHtml += '</div>';
            
                container.innerHTML = insightsHtml;
        }

        function addAIInsightsCSS() {
            /**
             * Add CSS for AI insights if not already present
             */
            if (document.getElementById('ai-insights-styles')) {
                return; // Already added
            }
            
            const style = document.createElement('style');
            style.id = 'ai-insights-styles';
            style.textContent = `
                /* üéØ CLICKABLE ELEMENTS */
                .clickable {
                    cursor: pointer;
                    transition: all 0.3s ease;
                    position: relative;
                }
                
                .clickable:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                }
                
                /* üìã Basic Components List Styling */
                .risk-analysis-section {
                    background: white;
                    border-radius: 8px;
                    padding: 1.5rem;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                }
                
                .risk-analysis-section .section-header h4 {
                    margin: 0 0 0.5rem 0;
                    color: #2563eb;
                    font-size: 1.1rem;
                }
                
                .risk-analysis-section .section-header p {
                    margin: 0 0 1rem 0;
                    color: #6b7280;
                    font-weight: 600;
                }
                
                .top-components-list {
                    margin-bottom: 1.5rem;
                }
                
                .component-item {
                    background: #f8fafc;
                    border: 1px solid #e2e8f0;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 0.75rem;
                    transition: all 0.3s ease;
                }
                
                .component-item:hover {
                    background: #e0f2fe;
                    border-color: #0284c7;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                }
                
                .component-info {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 0.5rem;
                }
                
                .component-name {
                    font-weight: 600;
                    color: #1e293b;
                    font-size: 1rem;
                }
                
                .component-count {
                    background: #3b82f6;
                    color: white;
                    padding: 0.25rem 0.75rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.875rem;
                }
                
                .component-meta {
                    margin-bottom: 0.5rem;
                }
                
                .risk-indicator {
                    font-size: 0.875rem;
                    font-weight: 500;
                }
                
                .click-hint {
                    font-size: 0.75rem;
                    color: #475569;
                    font-style: italic;
                    font-weight: 500;
                }
                
                .view-all-components-wrapper {
                    text-align: center;
                    padding-top: 1rem;
                    border-top: 1px solid #e2e8f0;
                }
                
                .view-all-components {
                    display: inline-block;
                    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                    color: white;
                    padding: 0.75rem 1.5rem;
                    border-radius: 8px;
                    font-weight: 600;
                    text-decoration: none;
                    transition: all 0.3s ease;
                    border: none;
                    cursor: pointer;
                    margin-top: 1rem;
                }
                
                .view-all-components:hover {
                    background: linear-gradient(135deg, #1d4ed8, #1e40af);
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
                    color: white;
                }
                
                /* Dark mode styling for Component Risk Analysis */
                [data-theme="dark"] .risk-analysis-section {
                    background: var(--card-bg);
                    border: 1px solid var(--border-color);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                }
                
                [data-theme="dark"] .risk-analysis-section .section-header h4 {
                    color: #60a5fa;
                }
                
                [data-theme="dark"] .risk-analysis-section .section-header p {
                    color: var(--text-color);
                    opacity: 0.8;
                }
                
                [data-theme="dark"] .component-item {
                    background: rgba(255, 255, 255, 0.05);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    color: var(--text-color);
                }
                
                [data-theme="dark"] .component-item:hover {
                    background: rgba(255, 255, 255, 0.08);
                    border-color: #60a5fa;
                    box-shadow: 0 4px 12px rgba(96, 165, 250, 0.2);
                }
                
                [data-theme="dark"] .component-name {
                    color: var(--text-color);
                }
                
                [data-theme="dark"] .component-count {
                    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                    color: white;
                }
                
                [data-theme="dark"] .risk-indicator {
                    color: var(--text-color);
                }
                
                [data-theme="dark"] .click-hint {
                    color: #94a3b8;
                }
                
                [data-theme="dark"] .click-indicator {
                    color: #94a3b8;
                }
                
                [data-theme="dark"] .component-item .click-hint {
                    color: #e2e8f0;
                }
                
                [data-theme="dark"] .risk-item .click-hint,
                [data-theme="dark"] .metric-card .click-hint,
                [data-theme="dark"] .clickable .click-hint {
                    color: #94a3b8;
                    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
                }
                
                [data-theme="dark"] .view-all-components-wrapper {
                    border-top: 1px solid var(--border-color);
                }
                
                [data-theme="dark"] .view-all-components {
                    background: linear-gradient(135deg, #4f46e5, #3730a3);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                }
                
                [data-theme="dark"] .view-all-components:hover {
                    background: linear-gradient(135deg, #3730a3, #312e81);
                    box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
                }
                 
                 /* Component-specific click-hint styling */
                 .component-item .click-hint {
                    font-size: 0.75rem;
                    opacity: 0.8;
                    margin-top: 0.5rem;
                    font-style: italic;
                    color: #475569;
                    font-weight: 500;
                }
                


                /* üé≠ MODAL SYSTEM */
                .insights-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 10000;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.3s ease;
                }
                
                .insights-modal.show {
                    opacity: 1;
                    visibility: visible;
                }
                
                .modal-backdrop {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    backdrop-filter: blur(4px);
                }
                
                .modal-container {
                    position: relative;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    max-width: 90vw;
                    max-height: 90vh;
                    background: linear-gradient(145deg, #0f172a 0%, #1e293b 50%, #334155 100%);
                    border-radius: 15px;
                    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    overflow: hidden;
                }
                
                .modal-header {
                    position: relative;
                    padding: 1rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .close-btn {
                    position: absolute;
                    top: 1rem;
                    right: 1rem;
                    background: none;
                    border: none;
                    color: #94a3b8;
                    font-size: 1.5rem;
                    cursor: pointer;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                }
                
                .close-btn:hover {
                    background: rgba(255, 255, 255, 0.1);
                    color: white;
                }
                
                .modal-body {
                    padding: 0;
                    max-height: calc(90vh - 80px);
                    overflow-y: auto;
                    color: white;
                }
                
                /* üìä POPUP CONTENT STYLING */
                .popup-header {
                    padding: 1.5rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .popup-header h3 {
                    margin: 0;
                    color: #fbbf24;
                    font-size: 1.5rem;
                    font-weight: 700;
                }
                
                .popup-content {
                    padding: 1.5rem;
                }
                
                /* üéØ HEALTH SCORE POPUP */
                .health-breakdown {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 1rem;
                    margin-bottom: 2rem;
                }
                
                .health-metric {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .health-metric .label {
                    font-weight: 600;
                    color: #cbd5e1;
                }
                
                .health-metric .value {
                    font-weight: 700;
                    font-size: 1.1rem;
                }
                
                .health-score-good { color: #10b981; }
                .health-score-medium { color: #f59e0b; }
                .health-score-poor { color: #ef4444; }
                
                .impact-critical { color: #ef4444; }
                .impact-high { color: #f59e0b; }
                .impact-medium { color: #3b82f6; }
                .impact-low { color: #10b981; }
                .impact-minimal { color: #6b7280; }
                
                /* üíº BUSINESS IMPACT POPUP */
                .impact-overview {
                    margin-bottom: 2rem;
                }
                
                .impact-level {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    padding: 1.5rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 12px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .impact-icon {
                    font-size: 3rem;
                }
                
                .impact-text {
                    flex: 1;
                }
                
                .impact-label {
                    display: block;
                    font-size: 1.3rem;
                    font-weight: 700;
                    margin-bottom: 0.5rem;
                }
                
                .impact-description {
                    display: block;
                    color: #cbd5e1;
                    font-size: 0.95rem;
                }
                
                .impact-metrics {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 1rem;
                    margin-bottom: 2rem;
                }
                
                .metric {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                }
                
                .metric-label {
                    font-weight: 600;
                    color: #cbd5e1;
                }
                
                .metric-value {
                    font-weight: 700;
                    color: #fbbf24;
                }
                
                /* ‚è∞ TIMELINE STYLING */
                .timeline {
                    space-y: 0.5rem;
                }
                
                .timeline-item {
                    padding: 0.75rem 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                    margin-bottom: 0.5rem;
                    border-left: 3px solid #3b82f6;
                }
                
                .timeline.critical .timeline-item { border-left-color: #ef4444; }
                .timeline.high .timeline-item { border-left-color: #f59e0b; }
                .timeline.medium .timeline-item { border-left-color: #3b82f6; }
                
                /* üß© COMPONENT DETAILS POPUP */
                .component-stats {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                    gap: 1rem;
                    margin-bottom: 2rem;
                }
                
                .stat {
                    text-align: center;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                }
                
                .stat-value {
                    display: block;
                    font-size: 1.8rem;
                    font-weight: 700;
                    margin-bottom: 0.5rem;
                }
                
                .stat-label {
                    display: block;
                    font-size: 0.85rem;
                    color: #cbd5e1;
                }
                
                .risk-score-critical { color: #ef4444; }
                .risk-score-high { color: #f59e0b; }
                .risk-score-medium { color: #3b82f6; }
                .risk-score-low { color: #10b981; }
                
                .risk-level-critical { color: #ef4444; }
                .risk-level-high { color: #f59e0b; }
                .risk-level-medium { color: #3b82f6; }
                .risk-level-low { color: #10b981; }
                
                /* üìã COMPONENTS TABLE */
                .components-table-container {
                    max-height: 400px;
                    overflow-y: auto;
                    border-radius: 8px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .components-table {
                    width: 100%;
                    border-collapse: collapse;
                    background: rgba(255, 255, 255, 0.02);
                }
                
                .components-table th {
                    background: rgba(255, 255, 255, 0.1);
                    padding: 0.75rem;
                    text-align: left;
                    font-weight: 600;
                    color: #fbbf24;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                    position: sticky;
                    top: 0;
                }
                
                .components-table td {
                    padding: 0.75rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                }
                
                .component-row:hover {
                    background: rgba(255, 255, 255, 0.05);
                }
                
                .component-row.risk-critical { border-left: 3px solid #ef4444; }
                .component-row.risk-high { border-left: 3px solid #f59e0b; }
                .component-row.risk-medium { border-left: 3px solid #3b82f6; }
                .component-row.risk-low { border-left: 3px solid #10b981; }
                
                .rank {
                    font-weight: 700;
                    color: #fbbf24;
                }
                
                .score {
                    padding: 0.25rem 0.5rem;
                    border-radius: 4px;
                    font-weight: 600;
                }
                
                .level {
                    padding: 0.25rem 0.5rem;
                    border-radius: 4px;
                    font-weight: 600;
                    font-size: 0.85rem;
                }
                
                /* üéØ RISK ANALYSIS POPUP */
                .risk-summary {
                    margin-bottom: 2rem;
                }
                
                .overall-risk {
                    text-align: center;
                    margin-bottom: 2rem;
                }
                
                .risk-score-large {
                    display: block;
                    font-size: 4rem;
                    font-weight: 900;
                    margin-bottom: 0.5rem;
                }
                
                .risk-label-large {
                    display: block;
                    font-size: 1.2rem;
                    font-weight: 600;
                    color: #cbd5e1;
                }
                
                .risk-bars {
                    space-y: 1rem;
                }
                
                .risk-bar {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    margin-bottom: 1rem;
                }
                
                .risk-label {
                    min-width: 100px;
                    font-weight: 600;
                }
                
                .bar-container {
                    flex: 1;
                    height: 20px;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 10px;
                    overflow: hidden;
                }
                
                .bar {
                    height: 100%;
                    transition: width 0.3s ease;
                }
                
                .bar.critical { background: #ef4444; }
                .bar.high { background: #f59e0b; }
                .bar.medium { background: #3b82f6; }
                .bar.low { background: #10b981; }
                
                .count {
                    min-width: 40px;
                    text-align: center;
                    font-weight: 700;
                }
                
                .risk-components-detailed {
                    space-y: 1rem;
                }
                
                .risk-component-detail {
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    cursor: pointer;
                    transition: all 0.2s ease;
                    margin-bottom: 1rem;
                }
                
                .risk-component-detail:hover {
                    background: rgba(255, 255, 255, 0.1);
                    transform: translateX(4px);
                }
                
                .component-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 0.5rem;
                }
                
                .component-name {
                    font-weight: 700;
                    font-size: 1.1rem;
                }
                
                .risk-badge {
                    padding: 0.25rem 0.75rem;
                    border-radius: 12px;
                    font-size: 0.8rem;
                    font-weight: 600;
                }
                
                .risk-badge.risk-critical { background: #ef4444; color: white; }
                .risk-badge.risk-high { background: #f59e0b; color: white; }
                .risk-badge.risk-medium { background: #3b82f6; color: white; }
                .risk-badge.risk-low { background: #10b981; color: white; }
                
                .component-stats {
                    display: flex;
                    gap: 1rem;
                    margin-bottom: 0.5rem;
                    font-size: 0.9rem;
                    color: #cbd5e1;
                }
                
                .component-recommendation {
                    font-size: 0.9rem;
                    color: #94a3b8;
                    font-style: italic;
                }
                
                .view-all-btn {
                    text-align: center;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 600;
                    margin-top: 2rem;
                    transition: all 0.2s ease;
                }
                
                .view-all-btn:hover {
                    background: rgba(255, 255, 255, 0.2);
                }
                
                .table-footer {
                    padding: 1rem;
                    text-align: center;
                    color: #94a3b8;
                    font-size: 0.9rem;
                    background: rgba(255, 255, 255, 0.02);
                    border-top: 1px solid rgba(255, 255, 255, 0.1);
                }

                /* üì± COMPONENT SIDEBAR SYSTEM */
                .component-sidebar {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 10000;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.3s ease;
                }
                
                .component-sidebar.show {
                    opacity: 1;
                    visibility: visible;
                }
                
                .sidebar-backdrop {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    backdrop-filter: blur(2px);
                }
                
                .sidebar-container {
                    position: absolute;
                    top: 0;
                    right: 0;
                    width: 450px;
                    height: 100%;
                    background: linear-gradient(145deg, #0f172a 0%, #1e293b 100%);
                    box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
                    border-left: 1px solid rgba(255, 255, 255, 0.1);
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                }
                
                .component-sidebar.show .sidebar-container {
                    transform: translateX(0);
                }
                
                .sidebar-header {
                    padding: 1.5rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                    background: rgba(255, 255, 255, 0.05);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    flex-shrink: 0;
                }
                
                .sidebar-header h3 {
                    margin: 0;
                    color: #fbbf24;
                    font-size: 1.3rem;
                    font-weight: 700;
                }
                
                .sidebar-close-btn {
                    background: none;
                    border: none;
                    color: #94a3b8;
                    font-size: 1.2rem;
                    cursor: pointer;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                }
                
                .sidebar-close-btn:hover {
                    background: rgba(255, 255, 255, 0.1);
                    color: white;
                }
                
                .sidebar-content {
                    flex: 1;
                    overflow-y: auto;
                    padding: 0;
                    color: white;
                }
                
                /* üß© COMPONENT TITLE */
                .component-title {
                    padding: 1.5rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .component-title h2 {
                    margin: 0;
                    color: white;
                    font-size: 1.8rem;
                    font-weight: 700;
                }
                
                .component-badge {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.85rem;
                    font-weight: 600;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .component-badge.risk-critical {
                    background: #ef4444;
                    color: white;
                }
                
                .component-badge.risk-high {
                    background: #f59e0b;
                    color: white;
                }
                
                .component-badge.risk-medium {
                    background: #3b82f6;
                    color: white;
                }
                
                .component-badge.risk-low {
                    background: #10b981;
                    color: white;
                }
                
                /* üìä COMPONENT STATS GRID */
                .component-stats-grid {
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    gap: 1rem;
                    padding: 1.5rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .stat-card {
                    text-align: center;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 12px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .stat-card .stat-value {
                    display: block;
                    font-size: 1.8rem;
                    font-weight: 700;
                    margin-bottom: 0.5rem;
                }
                
                .stat-card .stat-label {
                    display: block;
                    font-size: 0.8rem;
                    color: #cbd5e1;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                /* üîç ANALYSIS SECTION */
                .analysis-section {
                    padding: 1.5rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .analysis-section h4 {
                    margin: 0 0 1rem 0;
                    color: #fbbf24;
                    font-size: 1.1rem;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                }
                
                .ai-recommendation,
                .risk-factors,
                .action-items {
                    margin-bottom: 2rem;
                }
                
                .recommendation-content {
                    background: rgba(59, 130, 246, 0.1);
                    padding: 1rem;
                    border-radius: 8px;
                    border-left: 3px solid #3b82f6;
                    color: #e2e8f0;
                    font-style: italic;
                }
                
                .factors-list,
                .actions-list {
                    margin: 0;
                    padding-left: 0;
                    list-style: none;
                }
                
                .factors-list li,
                .actions-list li {
                    background: rgba(255, 255, 255, 0.05);
                    padding: 0.75rem 1rem;
                    margin-bottom: 0.5rem;
                    border-radius: 6px;
                    border-left: 3px solid;
                    font-size: 0.9rem;
                    line-height: 1.4;
                }
                
                .factors-list li {
                    border-left-color: #f59e0b;
                }
                
                .actions-list li {
                    border-left-color: #10b981;
                }
                
                /* üêõ BUGS SECTION */
                .bugs-section {
                    padding: 1.5rem;
                }
                
                .bugs-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 1rem;
                }
                
                .bugs-header h4 {
                    margin: 0;
                    color: #fbbf24;
                    font-size: 1.1rem;
                    font-weight: 600;
                }
                
                .bugs-count {
                    background: rgba(251, 191, 36, 0.2);
                    color: #fbbf24;
                    padding: 0.25rem 0.75rem;
                    border-radius: 12px;
                    font-size: 0.8rem;
                    font-weight: 600;
                }
                
                .bugs-list {
                    max-height: 400px;
                    overflow-y: auto;
                }
                
                .loading-bugs {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 1rem;
                    padding: 2rem;
                    color: #94a3b8;
                }
                
                .spinner {
                    width: 20px;
                    height: 20px;
                    border: 2px solid rgba(148, 163, 184, 0.3);
                    border-top: 2px solid #94a3b8;
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                .bug-item {
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 0.75rem;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    transition: all 0.2s ease;
                    border-left: 3px solid;
                }
                
                .bug-item:hover {
                    background: rgba(255, 255, 255, 0.08);
                    transform: translateX(2px);
                }
                
                .bug-item.priority-critical {
                    border-left-color: #ef4444;
                }
                
                .bug-item.priority-high {
                    border-left-color: #f59e0b;
                }
                
                .bug-item.priority-medium {
                    border-left-color: #3b82f6;
                }
                
                .bug-item.priority-low {
                    border-left-color: #10b981;
                }
                
                .bug-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 0.5rem;
                }
                
                .bug-key {
                    font-family: 'Courier New', monospace;
                    font-weight: 600;
                    color: #60a5fa;
                    font-size: 0.9rem;
                }
                
                .bug-priority {
                    padding: 0.2rem 0.5rem;
                    border-radius: 4px;
                    font-size: 0.7rem;
                    font-weight: 600;
                    text-transform: uppercase;
                }
                
                .bug-priority.priority-critical {
                    background: #ef4444;
                    color: white;
                }
                
                .bug-priority.priority-high {
                    background: #f59e0b;
                    color: white;
                }
                
                .bug-priority.priority-medium {
                    background: #3b82f6;
                    color: white;
                }
                
                .bug-priority.priority-low {
                    background: #10b981;
                    color: white;
                }
                
                .bug-summary {
                    color: #e2e8f0;
                    font-size: 0.95rem;
                    line-height: 1.4;
                    margin-bottom: 0.75rem;
                }
                
                .bug-meta {
                    display: flex;
                    gap: 1rem;
                    font-size: 0.8rem;
                    color: #94a3b8;
                }
                
                .bug-status {
                    padding: 0.2rem 0.5rem;
                    border-radius: 4px;
                    font-weight: 500;
                }
                
                .bug-status.status-open {
                    background: rgba(239, 68, 68, 0.2);
                    color: #fca5a5;
                }
                
                .bug-status.status-in-progress {
                    background: rgba(245, 158, 11, 0.2);
                    color: #fbbf24;
                }
                
                .bug-status.status-review {
                    background: rgba(59, 130, 246, 0.2);
                    color: #93c5fd;
                }
                
                .bug-status.status-testing {
                    background: rgba(168, 85, 247, 0.2);
                    color: #c4b5fd;
                }
                
                .bug-status.status-resolved {
                    background: rgba(16, 185, 129, 0.2);
                    color: #6ee7b7;
                }
                
                .error-message {
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 1rem;
                    background: rgba(239, 68, 68, 0.1);
                    border-radius: 8px;
                    color: #fca5a5;
                    font-size: 0.9rem;
                }
                
                .error-icon {
                    font-size: 1.2rem;
                }
                
                .no-bugs-message {
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 1rem;
                    background: rgba(59, 130, 246, 0.1);
                    border-radius: 8px;
                    color: #93c5fd;
                    font-size: 0.9rem;
                    text-align: center;
                    justify-content: center;
                }
                
                .info-icon {
                    font-size: 1.2rem;
                }
                
                /* üìã ALL COMPONENTS OVERVIEW STYLING */
                .components-overview {
                    padding: 1.5rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .overview-stats {
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    gap: 1rem;
                }
                
                .stat-item {
                    text-align: center;
                    padding: 1rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                }
                
                .stat-number {
                    display: block;
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: #fbbf24;
                    margin-bottom: 0.25rem;
                }
                
                .stat-label {
                    display: block;
                    font-size: 0.8rem;
                    color: #cbd5e1;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .components-list-section {
                    padding: 1.5rem;
                }
                
                .section-header {
                    margin-bottom: 1.5rem;
                }
                
                .section-header h4 {
                    margin: 0 0 0.5rem 0;
                    color: #fbbf24;
                    font-size: 1.1rem;
                    font-weight: 600;
                }
                
                .sort-info {
                    font-size: 0.85rem;
                    color: #94a3b8;
                    font-style: italic;
                }
                
                .components-grid {
                    display: grid;
                    grid-template-columns: 1fr;
                    gap: 1rem;
                    max-height: 500px;
                    overflow-y: auto;
                }
                
                .component-card {
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 12px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    cursor: pointer;
                    transition: all 0.3s ease;
                    overflow: hidden;
                    border-left: 4px solid;
                }
                
                .component-card:hover {
                    background: rgba(255, 255, 255, 0.08);
                    transform: translateX(4px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                }
                
                .component-card.risk-critical {
                    border-left-color: #ef4444;
                }
                
                .component-card.risk-high {
                    border-left-color: #f59e0b;
                }
                
                .component-card.risk-medium {
                    border-left-color: #3b82f6;
                }
                
                .component-card.risk-low {
                    border-left-color: #10b981;
                }
                
                .card-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem 1rem 0 1rem;
                }
                
                .rank-badge {
                    background: rgba(251, 191, 36, 0.2);
                    color: #fbbf24;
                    padding: 0.25rem 0.5rem;
                    border-radius: 6px;
                    font-size: 0.8rem;
                    font-weight: 600;
                }
                
                .risk-badge-small {
                    padding: 0.25rem 0.5rem;
                    border-radius: 4px;
                    font-size: 0.7rem;
                    font-weight: 600;
                    text-transform: uppercase;
                }
                
                .risk-badge-small.risk-critical {
                    background: #ef4444;
                    color: white;
                }
                
                .risk-badge-small.risk-high {
                    background: #f59e0b;
                    color: white;
                }
                
                .risk-badge-small.risk-medium {
                    background: #3b82f6;
                    color: white;
                }
                
                .risk-badge-small.risk-low {
                    background: #10b981;
                    color: white;
                }
                
                .card-content {
                    padding: 0 1rem 1rem 1rem;
                }
                
                .card-content .component-name {
                    margin: 0.5rem 0 1rem 0;
                    color: white;
                    font-size: 1.2rem;
                    font-weight: 600;
                }
                
                .component-metrics {
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    gap: 0.75rem;
                    margin-bottom: 1rem;
                }
                
                .component-metrics .metric {
                    text-align: center;
                    padding: 0.5rem;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 6px;
                }
                
                .component-metrics .metric-value {
                    display: block;
                    font-size: 1.1rem;
                    font-weight: 700;
                    margin-bottom: 0.25rem;
                }
                
                .component-metrics .metric-label {
                    display: block;
                    font-size: 0.7rem;
                    color: #cbd5e1;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .card-recommendation {
                    background: rgba(59, 130, 246, 0.1);
                    padding: 0.75rem;
                    border-radius: 6px;
                    border-left: 3px solid #3b82f6;
                    font-size: 0.85rem;
                    color: #e2e8f0;
                    font-style: italic;
                    line-height: 1.4;
                }
                
                .card-footer {
                    padding: 0.75rem 1rem;
                    border-top: 1px solid rgba(255, 255, 255, 0.1);
                    background: rgba(255, 255, 255, 0.02);
                }
                
                .click-indicator {
                    font-size: 0.8rem;
                    color: #475569;
                    font-style: italic;
                    font-weight: 500;
                }
                
                /* Enhanced light mode visibility for click hints */
                .risk-item .click-hint,
                .metric-card .click-hint,
                .clickable .click-hint {
                    color: #374151;
                    font-weight: 600;
                    opacity: 0.9;
                    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
                }
                
                .components-footer {
                    padding: 1rem 1.5rem;
                    border-top: 1px solid rgba(255, 255, 255, 0.1);
                    background: rgba(255, 255, 255, 0.02);
                }
                
                .footer-note {
                    text-align: center;
                    font-size: 0.9rem;
                    color: #94a3b8;
                    font-style: italic;
                }
                
                /* üì± RESPONSIVE DESIGN */
                @media (max-width: 768px) {
                    .sidebar-container {
                        width: 100%;
                        right: 0;
                    }
                    
                    .component-stats-grid {
                        grid-template-columns: 1fr;
                    }
                    
                    .component-title {
                        flex-direction: column;
                        gap: 1rem;
                        text-align: center;
                    }
                    
                    .bugs-meta {
                        flex-direction: column;
                        gap: 0.5rem;
                    }
                    
                    .overview-stats {
                        grid-template-columns: 1fr;
                    }
                    
                    .component-metrics {
                        grid-template-columns: 1fr;
                    }
                    
                    .card-header {
                        flex-direction: column;
                        gap: 0.5rem;
                        text-align: center;
                    }
                }

                /* AI Insights Styling */
                .ai-insights-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 2rem;
                    padding-bottom: 1rem;
                    border-bottom: 2px solid #e9ecef;
                }
                
                .ai-confidence-badge {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    text-align: center;
                    min-width: 80px;
                }
                
                .confidence-score {
                    font-size: 1.2rem;
                    font-weight: bold;
                    display: block;
                }
                
                .confidence-label {
                    font-size: 0.8rem;
                    opacity: 0.9;
                }
                
                .insights-section {
                    margin-bottom: 2rem;
                    padding: 1.5rem;
                    background: #f8f9fa;
                    border-radius: 8px;
                    border-left: 4px solid #007bff;
                }
                
                .insights-section h4 {
                    margin-top: 0;
                    margin-bottom: 1rem;
                    color: #007bff;
                }
                
                .executive-metrics {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 1rem;
                    margin-bottom: 1rem;
                }
                
                .metric-card {
                    background: white;
                    padding: 1rem;
                    border-radius: 8px;
                    text-align: center;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }
                
                .metric-value {
                    font-size: 2rem;
                    font-weight: bold;
                    color: #007bff;
                }
                
                .metric-label {
                    font-size: 0.9rem;
                    color: #6c757d;
                    margin-bottom: 0.5rem;
                }
                
                .metric-trend.positive { color: #28a745; }
                .metric-trend.neutral { color: #ffc107; }
                .metric-trend.negative { color: #dc3545; }
                
                .risk-overview {
                    display: grid;
                    grid-template-columns: auto 1fr;
                    gap: 2rem;
                    align-items: start;
                }
                
                @media (max-width: 768px) {
                    .risk-overview {
                        grid-template-columns: 1fr;
                        text-align: center;
                        gap: 1rem;
                    }
                    
                    .risk-score-display {
                        margin: 0 auto;
                    }
                }
                
                .risk-score-display {
                    text-align: center;
                    background: white;
                    padding: 0.75rem;
                    border-radius: 20px;
                    min-width: 120px;
                    min-height: 100px;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    border: 2px solid rgba(255, 255, 255, 0.2);
                }
                
                .risk-score {
                    font-size: 2rem;
                    font-weight: bold;
                    margin-bottom: 0.25rem;
                }
                
                .risk-label {
                    font-size: 0.85rem;
                    font-weight: 600;
                    line-height: 1.1;
                    color: #6c757d;
                }
                
                .risk-score.low { color: #28a745; }
                .risk-score.medium { color: #ffc107; }
                .risk-score.high { color: #fd7e14; }
                .risk-score.critical { color: #dc3545; }
                
                .risk-components-list {
                    list-style: none;
                    padding: 0;
                }
                
                .risk-item {
                    background: white;
                    padding: 0.75rem;
                    margin-bottom: 0.5rem;
                    border-radius: 4px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .component-name {
                    font-weight: bold;
                }
                
                .risk-score-small {
                    background: #007bff;
                    color: white;
                    padding: 0.25rem 0.5rem;
                    border-radius: 12px;
                    font-size: 0.8rem;
                }
                
                .risk-recommendation {
                    font-size: 0.9rem;
                    color: #6c757d;
                    flex: 1;
                    margin-left: 1rem;
                }
                
                .prediction-cards {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 1rem;
                }
                
                .prediction-card {
                    background: white;
                    padding: 1rem;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
                
                .prediction-icon {
                    font-size: 2rem;
                }
                
                .prediction-value {
                    font-size: 1.5rem;
                    font-weight: bold;
                    color: #007bff;
                }
                
                .prediction-label {
                    font-size: 0.9rem;
                    color: #6c757d;
                }
                
                .prediction-confidence,
                .prediction-insight {
                    font-size: 0.8rem;
                    color: #28a745;
                }
                
                .nlp-metrics {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 1rem;
                    margin-bottom: 1rem;
                }
                
                .nlp-card {
                    background: white;
                    padding: 1rem;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
                
                .nlp-icon {
                    font-size: 1.5rem;
                }
                
                .nlp-label {
                    font-size: 0.9rem;
                    color: #6c757d;
                }
                
                .nlp-value {
                    font-weight: bold;
                    color: #007bff;
                }
                
                .themes-tags {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 0.5rem;
                }
                
                .theme-tag {
                    background: #007bff;
                    color: white;
                    padding: 0.25rem 0.75rem;
                    border-radius: 12px;
                    font-size: 0.8rem;
                }
                
                .recommendations-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1rem;
                }
                
                .recommendation-category {
                    background: white;
                    padding: 1rem;
                    border-radius: 8px;
                }
                
                .recommendation-category h5 {
                    margin-top: 0;
                    margin-bottom: 0.5rem;
                }
                
                .recommendation-list {
                    list-style: none;
                    padding: 0;
                }
                
                .recommendation-list li {
                    padding: 0.5rem 0;
                    border-bottom: 1px solid #e9ecef;
                    font-size: 0.9rem;
                }
                
                .recommendation-list li:last-child {
                    border-bottom: none;
                }
                
                .ai-insights-list {
                    list-style: none;
                    padding: 0;
                }
                
                .ai-insights-list li {
                    background: white;
                    padding: 0.75rem;
                    margin-bottom: 0.5rem;
                    border-radius: 4px;
                    border-left: 3px solid #007bff;
                }
                
                .performance-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 1rem;
                }
                
                .performance-metric {
                    background: white;
                    padding: 1rem;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                }
                
                .metric-icon {
                    font-size: 1.5rem;
                }
                
                .metric-text {
                    font-weight: bold;
                    color: #007bff;
                }
                
                .ai-upgrade-notice {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 1rem;
                    border-radius: 8px;
                    margin-top: 1rem;
                    text-align: center;
                }
                
                /* Dark mode support for dynamically added AI styles */
                [data-theme="dark"] .insights-section {
                    background: var(--card-bg) !important;
                    border-left-color: var(--secondary-color) !important;
                }

                [data-theme="dark"] .insights-section h4 {
                    color: var(--secondary-color) !important;
                }

                [data-theme="dark"] .risk-score-display,
                [data-theme="dark"] .metric-card,
                [data-theme="dark"] .prediction-card,
                [data-theme="dark"] .nlp-card,
                [data-theme="dark"] .recommendation-category,
                [data-theme="dark"] .performance-metric,
                [data-theme="dark"] .risk-item {
                    background: var(--card-bg) !important;
                    border: 2px solid var(--border-color) !important;
                }

                [data-theme="dark"] .risk-label {
                    color: var(--text-color) !important;
                }

                [data-theme="dark"] .risk-label,
                [data-theme="dark"] .component-name,
                [data-theme="dark"] .risk-recommendation,
                [data-theme="dark"] .metric-label,
                [data-theme="dark"] .prediction-label,
                [data-theme="dark"] .nlp-label,
                [data-theme="dark"] .recommendation-list li,
                [data-theme="dark"] .metric-text {
                    color: var(--text-color) !important;
                }

                [data-theme="dark"] .nlp-value,
                [data-theme="dark"] .prediction-value,
                [data-theme="dark"] .metric-value {
                    color: var(--secondary-color) !important;
                }

                [data-theme="dark"] .ai-insights-list li {
                    background: var(--card-bg) !important;
                    border-left-color: var(--secondary-color) !important;
                    color: var(--text-color) !important;
                }

                [data-theme="dark"] .recommendation-category h5 {
                    color: var(--text-color) !important;
                }
                
                @media (max-width: 768px) {
                    .executive-metrics,
                    .prediction-cards,
                    .nlp-metrics {
                        grid-template-columns: 1fr;
                    }
                    
                    .risk-overview {
                        grid-template-columns: 1fr;
                        text-align: center;
                    }
                    
                    .recommendations-grid,
                    .performance-grid {
                        grid-template-columns: 1fr;
                    }
                }
            `;
            
            document.head.appendChild(style);
        }

        function recreateResultsStructure() {
            console.log('üîß Recreating results container structure');
            
            const resultsContainer = document.getElementById('resultsContainer');
            if (!resultsContainer) {
                console.error('‚ùå Cannot recreate structure - resultsContainer not found');
                return;
            }
            
            // Restore the original structure
            resultsContainer.innerHTML = `
                <div class="summary-grid" id="summaryGrid">
                    <!-- Summary cards populated by JavaScript -->
                </div>

                <div class="chart-container" id="chartContainer">
                    <!-- Chart populated by JavaScript -->
                </div>

                <div class="risk-table" id="riskTable">
                    <!-- Risk table populated by JavaScript -->
                </div>
            `;
            
            console.log('‚úÖ Results container structure recreated');
        }

        function showError(message) {
            console.error('‚ùå Analysis error:', message);
            
            const loadingIndicator = document.getElementById('loadingIndicator');
            const resultsContainer = document.getElementById('resultsContainer');
            const errorContainer = document.getElementById('errorContainer');
            const instructionContainer = document.getElementById('instructionContainer');
            const errorMessage = document.getElementById('errorMessage');
            
            if (loadingIndicator) loadingIndicator.style.display = 'none';
            if (resultsContainer) resultsContainer.style.display = 'none';
            if (errorContainer) errorContainer.style.display = 'block';
            if (instructionContainer) instructionContainer.style.display = 'none'; // Hide instructions
            
            if (errorMessage) {
                // Check if this is the "no data found" scenario
                if (message.toLowerCase().includes('no data found')) {
                    showNoDataFoundMessage();
                } else {
                    showGenericErrorMessage(message);
                }
            }
        }

        function showNoDataFoundMessage() {
            const errorMessage = document.getElementById('errorMessage');
            const projectSelect = document.getElementById('projectSelect');
            const dateRange = document.getElementById('dateRange');
            const environment = document.getElementById('environment');
            const issueTypes = document.getElementById('issueTypes');
            const components = document.getElementById('components');
            
            // Get current filter values
            const selectedProject = projectSelect ? projectSelect.value : 'Unknown';
            const projectName = projectSelect ? projectSelect.options[projectSelect.selectedIndex]?.text : 'Unknown';
            const selectedDateRange = dateRange ? dateRange.options[dateRange.selectedIndex]?.text : 'Unknown';
            const selectedEnvironment = environment ? environment.value : 'Unknown';
            const selectedIssueTypes = issueTypes ? Array.from(issueTypes.selectedOptions).map(o => o.text).join(', ') : 'Unknown';
            const selectedComponents = components ? Array.from(components.selectedOptions).map(o => o.text) : [];
            
            if (errorMessage) {
                errorMessage.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                        <h3 style="color: #856404; margin-bottom: 1rem;">No Data Found</h3>
                        <p style="font-size: 1.1rem; color: #6c757d; margin-bottom: 2rem;">
                            No bugs or issues were found matching your current filter criteria for <strong>${projectName}</strong>.
                        </p>
                        
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem; text-align: left;">
                            <h5 style="color: #856404; margin-bottom: 1rem;">üìã Current Filter Settings:</h5>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="margin-bottom: 0.5rem;"><strong>Project:</strong> ${projectName}</li>
                                <li style="margin-bottom: 0.5rem;"><strong>Date Range:</strong> ${selectedDateRange}</li>
                                <li style="margin-bottom: 0.5rem;"><strong>Environment:</strong> ${selectedEnvironment}</li>
                                <li style="margin-bottom: 0.5rem;"><strong>Issue Types:</strong> ${selectedIssueTypes}</li>
                                ${selectedComponents.length > 0 ? 
                                    `<li style="margin-bottom: 0.5rem;"><strong>Components:</strong> ${selectedComponents.slice(0, 3).join(', ')}${selectedComponents.length > 3 ? ` (+${selectedComponents.length - 3} more)` : ''}</li>` 
                                    : '<li style="margin-bottom: 0.5rem;"><strong>Components:</strong> All components</li>'
                                }
                            </ul>
                        </div>
                        
                        <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem; text-align: left;">
                            <h5 style="color: #0c5460; margin-bottom: 1rem;">üí° Suggestions to Find Data:</h5>
                            <ol style="margin: 0; padding-left: 1.5rem;">
                                <li style="margin-bottom: 0.5rem;"><strong>Expand Date Range:</strong> Try "Last year" or "Last 6 months" instead of shorter periods</li>
                                <li style="margin-bottom: 0.5rem;"><strong>Check Environment:</strong> Switch between "Production" and "Staging" environments</li>
                                <li style="margin-bottom: 0.5rem;"><strong>Clear Component Filters:</strong> Remove specific component selections to see all data</li>
                                <li style="margin-bottom: 0.5rem;"><strong>Try Different Project:</strong> Some projects may have more recent activity</li>
                                <li style="margin-bottom: 0.5rem;"><strong>Check Data Source:</strong> Verify JIRA project has issues in the selected time period</li>
                            </ol>
                        </div>
                        
                        <div style="margin-top: 2rem;">
                            <button onclick="suggestOptimalFilters()" class="btn btn-primary" style="margin-right: 1rem;">
                                üîß Try Recommended Filters
                            </button>
                            <button onclick="clearAllFilters()" class="btn btn-secondary">
                                üóëÔ∏è Clear All Filters
                            </button>
                        </div>
                        
                        <p style="margin-top: 1.5rem; font-size: 0.9rem; color: #6c757d;">
                            üí¨ If you continue to see no data after adjusting filters, the project may genuinely have no issues in the selected time period.
                        </p>
                    </div>
                `;
            }
        }

        function showGenericErrorMessage(message) {
            const errorMessage = document.getElementById('errorMessage');
            
            if (errorMessage) {
                errorMessage.innerHTML = `
                    <strong>Error Details:</strong><br>
                    ${message}<br><br>
                    <strong>Troubleshooting Steps:</strong><br>
                    1. Check browser console (F12) for detailed errors<br>
                    2. Verify project selection<br>
                    3. Check if Flask server is running (http://localhost:5001/api/health)<br>
                    4. Try clearing cache and refreshing<br>
                    5. Check network connectivity<br><br>
                    <strong>Debug Info:</strong><br>
                    Current project: ${currentProject || 'None'}<br>
                    Timestamp: ${new Date().toLocaleString()}<br>
                    User Agent: ${navigator.userAgent.slice(0, 50)}...
                `;
            }
        }

        function suggestOptimalFilters() {
            console.log('üîß Applying recommended filters for better data discovery');
            
            // Set more permissive filters
            const dateRange = document.getElementById('dateRange');
            const environment = document.getElementById('environment');
            const issueTypes = document.getElementById('issueTypes');
            const components = document.getElementById('components');
            
            if (dateRange) {
                dateRange.value = '365'; // Set to 1 year
            }
            
            if (environment) {
                environment.value = 'Production'; // Most common environment
            }
            
            if (issueTypes) {
                // Select all issue types
                Array.from(issueTypes.options).forEach(option => {
                    option.selected = true;
                });
            }
            
            if (components) {
                // Clear component selections (select all)
                Array.from(components.options).forEach(option => {
                    option.selected = false;
                });
            }
            
            // Show success message and re-analyze
            showNotification('Applied recommended filters: 1 year timeframe, Production environment, all issue types, all components', 'success');
            
            // Re-trigger analysis with new filters
            setTimeout(() => {
                analyzeProject();
            }, 500);
        }

        function resetAdvancedFilters() {
            console.log('üîÑ Resetting advanced filters to recommended defaults');
            
            // Set recommended default filters
            const dateRange = document.getElementById('dateRange');
            const environment = document.getElementById('environment');
            const issueTypes = document.getElementById('issueTypes');
            const components = document.getElementById('components');
            
            if (dateRange) {
                dateRange.value = '365'; // Set to 1 year for better data coverage
            }
            
            if (environment) {
                environment.value = 'Production'; // Most common environment
            }
            
            if (issueTypes) {
                // Select all issue types for comprehensive analysis
                Array.from(issueTypes.options).forEach(option => {
                    option.selected = true;
                });
            }
            
            if (components) {
                // Clear component selections (select all components)
                Array.from(components.options).forEach(option => {
                    option.selected = false;
                });
            }
            
            // Show success notification
            showNotification('üîÑ Advanced filters reset to recommended defaults: 1 year timeframe, Production environment, all issue types, all components', 'success', 4000);
            
            console.log('‚úÖ Advanced filters reset successfully');
        }

        function clearAllFilters() {
            console.log('üóëÔ∏è Clearing all filters to show maximum data');
            
            // Reset all filters to defaults
            const dateRange = document.getElementById('dateRange');
            const environment = document.getElementById('environment');
            const issueTypes = document.getElementById('issueTypes');
            const components = document.getElementById('components');
            
            if (dateRange) {
                dateRange.value = '180'; // Reset to default 6 months
            }
            
            if (environment) {
                environment.value = 'Production';
            }
            
            if (issueTypes) {
                // Select default issue types
                Array.from(issueTypes.options).forEach(option => {
                    option.selected = option.value === 'Bug' || option.value === 'Support Ticket';
                });
            }
            
            if (components) {
                // Clear all component selections
                Array.from(components.options).forEach(option => {
                    option.selected = false;
                });
            }
            
            showNotification('‚úÖ Cleared all filters to default settings', 'success');
            
            // Re-trigger analysis with cleared filters
            setTimeout(() => {
                analyzeProject();
            }, 500);
        }

        // Debug test function - can be called from console
        window.testAnalyzeButton = function() {
            console.log('üß™ Testing analyze button functionality...');
            
            const analyzeBtn = document.getElementById('analyzeBtn');
            const projectSelect = document.getElementById('projectSelect');
            
            console.log('Button element:', analyzeBtn);
            console.log('Project select element:', projectSelect);
            console.log('Selected project:', projectSelect?.value);
            console.log('Current project variable:', currentProject);
            
            if (analyzeBtn) {
                console.log('Button onclick attribute:', analyzeBtn.getAttribute('onclick'));
                console.log('Button disabled?', analyzeBtn.disabled);
                console.log('Button innerHTML:', analyzeBtn.innerHTML);
            }
            
            // Test the function directly
            try {
                analyzeProject();
                console.log('‚úÖ analyzeProject() called successfully');
            } catch (error) {
                console.error('‚ùå Error calling analyzeProject():', error);
            }
        };

        function clearResultsAndShowInstruction(projectName) {
            console.log('üßπ Clearing results and showing instruction for:', projectName);
            
            // Hide all result containers but don't remove them from DOM
            const loadingIndicator = document.getElementById('loadingIndicator');
            const resultsContainer = document.getElementById('resultsContainer');
            const errorContainer = document.getElementById('errorContainer');
            
            if (loadingIndicator) loadingIndicator.style.display = 'none';
            if (resultsContainer) resultsContainer.style.display = 'none';
            if (errorContainer) errorContainer.style.display = 'none';
            
            // Create or update instruction container without destroying results structure
            let instructionContainer = document.getElementById('instructionContainer');
            if (!instructionContainer) {
                instructionContainer = document.createElement('div');
                instructionContainer.id = 'instructionContainer';
                instructionContainer.style.display = 'none';
                
                // Insert it after the results container
                const overview = document.getElementById('overview');
                if (overview && resultsContainer) {
                    overview.insertBefore(instructionContainer, resultsContainer.nextSibling);
                }
            }
            
            if (instructionContainer) {
                instructionContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #6c757d;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üìä</div>
                        <h3 style="color: #495057; margin-bottom: 1rem;">Ready to Analyze ${projectName}</h3>
                        <p style="font-size: 1.1rem; margin-bottom: 2rem;">
                            Project selected and filters loaded successfully.<br>
                            Click the <strong>"üöÄ Analyze Project"</strong> button to view the analysis results.
                        </p>
                        <div style="background: #e9ecef; border-radius: 8px; padding: 1.5rem; margin: 0 auto; max-width: 500px;">
                            <h5 style="color: #495057; margin-bottom: 1rem;">üìã Current Configuration:</h5>
                            <div style="text-align: left;">
                                <p><strong>Project:</strong> ${projectName}</p>
                                <p><strong>Date Range:</strong> ${document.getElementById('dateRange')?.options[document.getElementById('dateRange')?.selectedIndex]?.text || 'Last 6 months'}</p>
                                <p><strong>Environment:</strong> ${document.getElementById('environment')?.value || 'Production'}</p>
                                <p><strong>Issue Types:</strong> Bug, Support Ticket</p>
                            </div>
                        </div>
                    </div>
                `;
                instructionContainer.style.display = 'block';
            }
            
            // Clear Trends tab
            const trendsContainer = document.getElementById('trendsContainer');
            if (trendsContainer) {
                trendsContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üìà</div>
                        <h4>Trends Analysis for ${projectName}</h4>
                        <p>Click <strong>"üöÄ Analyze Project"</strong> to generate comprehensive analysis including historical trends</p>
                    </div>
                `;
            }
            
            // Clear Insights tab  
            const insightsContainer = document.getElementById('insightsContainer');
            if (insightsContainer) {
                insightsContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üí°</div>
                        <h4>AI Insights for ${projectName}</h4>
                        <p>Click <strong>"üöÄ Analyze Project"</strong> to generate insights</p>
                    </div>
                `;
            }
        }

        // Trends functionality
        async function loadTrends(projectId, silent = false) {
            const container = document.getElementById('trendsContainer');
            const loading = document.getElementById('trendsLoading');
            
            // Only show loading indicator if not silent
            if (!silent && loading) {
                loading.style.display = 'flex';
            }
            
            try {
                // Use 6 months for ALL projects to match the 180-day view
                const months = projectId === 'ALL' ? 6 : 6;
                const response = await fetch(`/api/trends/${projectId}?months=${months}`);
                const data = await response.json();
                
                if (data.success) {
                    displayTrends(data);
                    console.log(`‚úÖ Trends data loaded for ${data.project_name} (${data.months_analyzed} months)`);
                } else {
                    container.innerHTML = `<p>‚ùå ${data.message}</p>`;
                    console.warn(`‚ö†Ô∏è Trends loading failed for ${projectId}: ${data.message}`);
                }
            } catch (error) {
                container.innerHTML = `<p>‚ùå Error loading trends: ${error.message}</p>`;
                console.error(`‚ùå Trends API error for ${projectId}:`, error);
            } finally {
                if (!silent && loading) {
                    loading.style.display = 'none';
                }
            }
        }

        function displayTrends(data) {
            const container = document.getElementById('trendsContainer');
            
            let trendsHtml = `<h3>üìà Historical Trends for ${data.project_name}</h3>`;
            trendsHtml += '<div class="risk-table"><table>';
            trendsHtml += '<thead><tr><th>Month</th><th>Total Bugs</th><th>Top Components</th></tr></thead><tbody>';
            
            data.trend_data.forEach(trend => {
                const topComponents = Object.keys(trend.components)
                    .sort((a, b) => trend.components[b] - trend.components[a])
                    .slice(0, 3)
                    .map(comp => `${comp} (${trend.components[comp]})`)
                    .join(', ');
                
                trendsHtml += `
                    <tr>
                        <td>${trend.month}</td>
                        <td>${trend.total_bugs}</td>
                        <td>${topComponents || 'No components'}</td>
                    </tr>
                `;
            });
            
            trendsHtml += '</tbody></table></div>';
            container.innerHTML = trendsHtml;
        }

        // Cache management
        async function clearCache() {
            try {
                console.log('üóëÔ∏è Clearing cache and resetting filters...');
                
                const response = await fetch('/api/cache/clear');
                const result = await response.json();
                
                if (result.success) {
                    // Reset advanced filters to recommended defaults
                    resetAdvancedFiltersInternal();
                    
                    showNotification('üóëÔ∏è Cache cleared and filters reset successfully', 'success');
                    
                    if (currentProject) {
                        analyzeProject();
                    }
                } else {
                    showNotification('‚ùå Failed to clear cache', 'error');
                }
            } catch (error) {
                showNotification('‚ùå Error clearing cache', 'error');
            }
        }

        // Internal function to reset filters without notification (used by clearCache)
        function resetAdvancedFiltersInternal() {
            console.log('üîÑ Resetting advanced filters internally...');
            
            // Set recommended default filters
            const dateRange = document.getElementById('dateRange');
            const environment = document.getElementById('environment');
            const issueTypes = document.getElementById('issueTypes');
            const components = document.getElementById('components');
            
            if (dateRange) {
                dateRange.value = '365'; // Set to 1 year for better data coverage
            }
            
            if (environment) {
                environment.value = 'Production'; // Most common environment
            }
            
            if (issueTypes) {
                // Select all issue types for comprehensive analysis
                Array.from(issueTypes.options).forEach(option => {
                    option.selected = true;
                });
            }
            
            if (components) {
                // Clear component selections (select all components)
                Array.from(components.options).forEach(option => {
                    option.selected = false;
                });
            }
            
            console.log('‚úÖ Advanced filters reset internally');
        }

        // Project selection handler
        document.getElementById('projectSelect').addEventListener('change', function() {
            const selectedProject = this.value;
            console.log('üéØ Project selected:', selectedProject);
            
            if (selectedProject) {
                // Special handling for "ALL" projects (Aircall Projects)
                if (selectedProject === 'ALL') {
                    console.log('üåü Loading ALL Aircall Projects data (180 days)');
                    
                    // Set date range to 180 days for Aircall Projects view
                    const dateRangeSelect = document.getElementById('dateRange');
                    if (dateRangeSelect) {
                        dateRangeSelect.value = '180';
                    }
                    
                    // Load filters for all projects (combined)
                    loadAllProjectsFilters();
                    
                    // Auto-trigger analysis ONLY for Aircall Projects (ALL)
                    setTimeout(() => {
                        console.log('üîÑ Auto-triggering analysis for ALL projects');
                        analyzeProject();
                        checkAlerts(selectedProject); // Check alerts for ALL projects
                    }, 500);
                } else {
                    // Individual project selected - ONLY load filters, NO auto-analysis
                    console.log('üìã Individual project selected - loading filters only');
                    
                    // Load project filters first
                    loadProjectFilters(selectedProject);
                    
                    // Clear previous results and show instruction
                    clearResultsAndShowInstruction(selectedProject);
                    
                    // Check alerts for the project but don't show data
                    setTimeout(() => {
                        checkAlerts(selectedProject);
                    }, 500);
                }
            } else {
                // Clear results if somehow no project selected
                const loadingIndicator = document.getElementById('loadingIndicator');
                const resultsContainer = document.getElementById('resultsContainer');
                const errorContainer = document.getElementById('errorContainer');
                
                if (loadingIndicator) loadingIndicator.style.display = 'none';
                if (resultsContainer) resultsContainer.style.display = 'none';
                if (errorContainer) errorContainer.style.display = 'none';
            }
        });

        // Date Range change handler - no auto-trigger (except for Aircall Projects)
        document.getElementById('dateRange').addEventListener('change', function() {
            const dateRange = this.value;
            console.log('üìÖ Date range changed to:', dateRange);
            
            // Only auto-trigger for "Aircall Projects" (ALL)
            const projectSelect = document.getElementById('projectSelect');
            if (projectSelect.value === 'ALL') {
                console.log('üîÑ Auto-triggering analysis for Aircall Projects due to date range change');
                analyzeProject();
            } else {
                console.log('üìã Filter changed - click "Analyze Project" to update results');
            }
        });

        // Environment change handler - no auto-trigger (except for Aircall Projects)
        document.getElementById('environment').addEventListener('change', function() {
            const environment = this.value;
            console.log('üåç Environment changed to:', environment);
            
            // Only auto-trigger for "Aircall Projects" (ALL)
            const projectSelect = document.getElementById('projectSelect');
            if (projectSelect.value === 'ALL') {
                console.log('üîÑ Auto-triggering analysis for Aircall Projects due to environment change');
                analyzeProject();
            } else {
                console.log('üìã Filter changed - click "Analyze Project" to update results');
            }
        });

        // Issue Types change handler - no auto-trigger (except for Aircall Projects)
        document.getElementById('issueTypes').addEventListener('change', function() {
            const selectedTypes = Array.from(this.selectedOptions).map(option => option.value);
            console.log('üé´ Issue types changed to:', selectedTypes);
            
            // Only auto-trigger for "Aircall Projects" (ALL)
            const projectSelect = document.getElementById('projectSelect');
            if (projectSelect.value === 'ALL') {
                console.log('üîÑ Auto-triggering analysis for Aircall Projects due to issue types change');
                analyzeProject();
            } else {
                console.log('üìã Filter changed - click "Analyze Project" to update results');
            }
        });

        // Components change handler - no auto-trigger (except for Aircall Projects)
        document.getElementById('components').addEventListener('change', function() {
            const selectedComponents = Array.from(this.selectedOptions).map(option => option.value);
            console.log('üß© Components changed to:', selectedComponents);
            
            // Only auto-trigger for "Aircall Projects" (ALL)
            const projectSelect = document.getElementById('projectSelect');
            if (projectSelect.value === 'ALL') {
                console.log('üîÑ Auto-triggering analysis for Aircall Projects due to components change');
                analyzeProject();
            } else {
                console.log('üìã Filter changed - click "Analyze Project" to update results');
            }
        });

        // Load available filters for selected project
        async function loadProjectFilters(projectId) {
            console.log('üîÑ Loading filters for project:', projectId);
            
            try {
                const response = await fetch(`/api/filters/${projectId}`);
                const data = await response.json();
                
                console.log('üìã Filter API response:', data);
                
                if (data.success) {
                    updateComponentFilter(data.filters.components);
                    
                    // Update other filter options if needed
                    if (data.filters.environments) {
                        console.log('üåç Available environments:', data.filters.environments);
                    }
                    if (data.filters.issue_types) {
                        console.log('üé´ Available issue types:', data.filters.issue_types);
                    }
                } else {
                    console.error('‚ùå Failed to load filters:', data.message);
                    updateComponentFilter([]); // Clear components on error
                }
            } catch (error) {
                console.error('‚ùå Error loading filters:', error);
                updateComponentFilter([]); // Clear components on error
            }
        }

        // Load combined filters for all projects
        async function loadAllProjectsFilters() {
            console.log('üåü Loading combined filters for ALL projects');
            
            try {
                const response = await fetch('/api/filters/ALL');
                const data = await response.json();
                
                console.log('üìã Combined filters API response:', data);
                
                if (data.success) {
                    updateComponentFilter(data.filters.components);
                    console.log(`üß© Loaded ${data.filters.components.length} combined components from all projects`);
                } else {
                    console.error('‚ùå Failed to load combined filters:', data.message);
                    updateComponentFilter([]); // Clear components on error
                }
            } catch (error) {
                console.error('‚ùå Error loading combined filters:', error);
                updateComponentFilter([]); // Clear components on error
            }
        }

        function updateComponentFilter(components) {
            const select = document.getElementById('components');
            select.innerHTML = '';
            
            console.log('üß© Loading components:', components);
            
            if (components && components.length > 0) {
                // Sort components alphabetically (case-insensitive)
                const sortedComponents = [...components].sort((a, b) => 
                    a.toLowerCase().localeCompare(b.toLowerCase())
                );
                
                sortedComponents.forEach(component => {
                    const option = document.createElement('option');
                    option.value = component;
                    option.textContent = component;
                    select.appendChild(option);
                });
                
                console.log(`‚úÖ Loaded ${sortedComponents.length} components (sorted alphabetically)`);
            } else {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No components found';
                option.disabled = true;
                select.appendChild(option);
                
                console.log('‚ö†Ô∏è No components available');
            }
        }

        // Auto-refresh functionality
        function initializeAutoRefresh() {
            // Initialize the auto-refresh bar state
            const toggle = document.getElementById('autoRefreshToggle');
            const info = document.getElementById('autoRefreshInfo');
            const infoContent = document.getElementById('autoRefreshContent');
            
            if (autoRefreshEnabled) {
                startAutoRefresh();
                if (toggle) toggle.textContent = 'Disable';
                
                // Set enabled state styling
                if (info) {
                    info.style.background = '#e7f3ff';
                    info.style.border = '1px solid #bee5eb';
                    info.style.color = '#0c5460';
                }
                
                if (infoContent) {
                    infoContent.innerHTML = `
                        <span>üîÑ Auto-refresh enabled - Dashboard updates every ${autoRefreshInterval/1000} seconds</span>
                        <span style="margin-left: auto; font-size: 0.85em; opacity: 0.8;" id="lastUpdate">Last updated: ${new Date().toLocaleTimeString()}</span>
                    `;
                }
            } else {
                if (toggle) toggle.textContent = 'Enable';
                
                // Set disabled state styling
                if (info) {
                    info.style.background = '#fff3cd';
                    info.style.border = '1px solid #ffeaa7';
                    info.style.color = '#856404';
                }
                
                if (infoContent) {
                    infoContent.innerHTML = `
                        <span>‚è∏Ô∏è Auto-refresh disabled - Dashboard will only update manually</span>
                        <span style="margin-left: auto; font-size: 0.85em; opacity: 0.8;">Click "Enable" to resume automatic updates</span>
                    `;
                }
            }
        }

        function startAutoRefresh() {
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
            }
            
            autoRefreshTimer = setInterval(() => {
                if (currentProject) {
                    analyzeProject(true); // Silent refresh
                    checkAlerts(currentProject); // Check alerts for current project
                }
                checkSystemHealth();
            }, autoRefreshInterval);
            
            updateLastUpdateTime();
        }

        function stopAutoRefresh() {
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
                autoRefreshTimer = null;
            }
        }

        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const toggle = document.getElementById('autoRefreshToggle');
            const info = document.getElementById('autoRefreshInfo');
            const infoContent = document.getElementById('autoRefreshContent');
            
            console.log(`üîÑ Auto-refresh toggled to: ${autoRefreshEnabled ? 'ENABLED' : 'DISABLED'}`);
            
            if (autoRefreshEnabled) {
                startAutoRefresh();
                if (toggle) toggle.textContent = 'Disable';
                
                // Update info bar content for enabled state
                if (info) {
                    info.style.display = 'flex';
                    info.style.background = '#e7f3ff';
                    info.style.border = '1px solid #bee5eb';
                    info.style.color = '#0c5460';
                }
                
                if (infoContent) {
                    infoContent.innerHTML = `
                        <span>üîÑ Auto-refresh enabled - Dashboard updates every ${autoRefreshInterval/1000} seconds</span>
                        <span style="margin-left: auto; font-size: 0.85em; opacity: 0.8;" id="lastUpdate">Last updated: ${new Date().toLocaleTimeString()}</span>
                    `;
                }
                
                // Show success notification
                showNotification(`üîÑ Auto-refresh enabled - Dashboard will update every ${autoRefreshInterval/1000} seconds`, 'success', 3000);
                
                console.log('‚úÖ Auto-refresh started');
            } else {
                stopAutoRefresh();
                if (toggle) toggle.textContent = 'Enable';
                
                // Update info bar content for disabled state
                if (info) {
                    info.style.display = 'flex';
                    info.style.background = '#fff3cd';
                    info.style.border = '1px solid #ffeaa7';
                    info.style.color = '#856404';
                }
                
                if (infoContent) {
                    infoContent.innerHTML = `
                        <span>‚è∏Ô∏è Auto-refresh disabled - Dashboard will only update manually</span>
                        <span style="margin-left: auto; font-size: 0.85em; opacity: 0.8;">Click "Enable" to resume automatic updates</span>
                    `;
                }
                
                // Show info notification
                showNotification('‚è∏Ô∏è Auto-refresh disabled - Dashboard will only update manually', 'info', 3000);
                
                console.log('‚èπÔ∏è Auto-refresh stopped');
            }
        }

        function updateLastUpdateTime() {
            // Only update the timestamp if auto-refresh is enabled
            if (autoRefreshEnabled) {
                const lastUpdateElement = document.getElementById('lastUpdate');
                if (lastUpdateElement) {
                    const now = new Date();
                    lastUpdateElement.textContent = `Last updated: ${now.toLocaleTimeString()}`;
                }
            }
        }

        // System health check
        async function checkSystemHealth() {
            try {
                const response = await fetch('/api/health');
                const health = await response.json();
                
                const connectionStatus = document.getElementById('connectionStatus');
                const connectionText = document.getElementById('connectionText');
                
                if (health.status === 'healthy') {
                    connectionStatus.className = 'status-dot';
                    connectionText.textContent = 'Connected';
                } else {
                    connectionStatus.className = 'status-dot error';
                    connectionText.textContent = 'Error';
                }
            } catch (error) {
                const connectionStatus = document.getElementById('connectionStatus');
                const connectionText = document.getElementById('connectionText');
                connectionStatus.className = 'status-dot error';
                connectionText.textContent = 'Offline';
            }
        }

        // Alert checking - project-specific or global
        async function checkAlerts(projectId = null) {
            try {
                // Build URL with optional project filter
                let url = '/api/alerts/check';
                if (projectId) {
                    url += `?project=${projectId}`;
                }
                
                console.log('üö® Checking alerts:', url);
                
                const response = await fetch(url);
                const alertData = await response.json();
                
                console.log('üö® Alert response:', alertData);
                
                const alertStatus = document.getElementById('alertStatus');
                const alertText = document.getElementById('alertText');
                const alertBanner = document.getElementById('alertBanner');
                const alertMessage = document.getElementById('alertMessage');
                
                if (alertData.success && alertData.alert_count > 0) {
                    alertStatus.className = 'status-dot warning';
                    alertText.textContent = `${alertData.alert_count} Alerts`;
                    
                    // Update message based on project filter
                    const projectContext = alertData.project_name || 'selected project';
                    alertMessage.textContent = `${alertData.alert_count} component(s) in ${projectContext} exceed risk thresholds`;
                    alertBanner.classList.add('show');
                    
                    // Update alerts tab
                    updateAlertsTab(alertData.alerts, alertData.project_name);
                } else {
                    alertStatus.className = 'status-dot';
                    alertText.textContent = 'No Alerts';
                    alertBanner.classList.remove('show');
                    
                    // Update alerts tab with no alerts message
                    const projectContext = alertData.project_name || 'selected project';
                    updateAlertsTab([], projectContext);
                }
            } catch (error) {
                console.error('‚ùå Error checking alerts:', error);
            }
        }

        function updateAlertsTab(alerts, projectName = 'All Projects') {
            const container = document.getElementById('alertsContainer');
            
            if (alerts.length === 0) {
                container.innerHTML = `
                    <h3>üö® Active Risk Alerts - ${projectName}</h3>
                    <p>‚úÖ No active alerts - all components within normal risk levels for ${projectName}</p>
                `;
                return;
            }
            
            let alertsHtml = `<h3>üö® Active Risk Alerts - ${projectName}</h3>`;
            alertsHtml += `<p>Found ${alerts.length} component(s) exceeding risk thresholds:</p>`;
            alertsHtml += '<div class="risk-table"><table>';
            alertsHtml += '<thead><tr><th>Project</th><th>Component</th><th>Bug Count</th><th>Alert Level</th><th>Timestamp</th></tr></thead><tbody>';
            
            alerts.forEach(alert => {
                const timestamp = new Date(alert.timestamp).toLocaleString();
                alertsHtml += `
                    <tr>
                        <td>${alert.project_name}</td>
                        <td>${alert.component}</td>
                        <td style="text-align: center; font-weight: bold; color: #e74c3c;">${alert.bug_count}</td>
                        <td style="font-weight: bold;">${alert.alert_level}</td>
                        <td>${timestamp}</td>
                    </tr>
                `;
            });
            
            alertsHtml += '</tbody></table></div>';
            container.innerHTML = alertsHtml;
        }

        // Function to show alerts tab when "View Details" is clicked
        function showAlertsTab() {
            console.log('üö® Switching to Alerts tab');
            
            // Switch to alerts tab
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Remove active class from all tabs and contents
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(tc => tc.classList.remove('active'));
            
            // Add active class to alerts tab and content
            const alertsTab = document.querySelector('.tab[data-tab="alerts"]');
            const alertsContent = document.getElementById('alerts');
            
            if (alertsTab && alertsContent) {
                alertsTab.classList.add('active');
                alertsContent.classList.add('active');
                
                // Refresh alerts data for current project
                const projectSelect = document.getElementById('projectSelect');
                const selectedProject = projectSelect ? projectSelect.value : null;
                
                console.log('üîÑ Refreshing alerts for current project:', selectedProject);
                checkAlerts(selectedProject);
            } else {
                console.error('‚ùå Could not find alerts tab elements');
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üèÅ Dashboard initializing...');
            
            loadThemePreference(); // Load saved theme
            initializeTabs();
            initializeAutoRefresh();
            checkSystemHealth();
            checkAlerts();
            
            // Add direct event listener for analyze button as fallback
            const analyzeBtn = document.getElementById('analyzeBtn');
            if (analyzeBtn) {
                analyzeBtn.addEventListener('click', function(e) {
                    console.log('üöÄ Analyze button clicked via event listener (fallback)');
                    // Don't prevent default here to allow onclick to work too
                });
                console.log('‚úÖ Analyze button event listener attached');
            } else {
                console.error('‚ùå Analyze button not found during initialization');
            }
            
            // Check for alerts every 5 minutes - use current project
            setInterval(() => {
                const projectSelect = document.getElementById('projectSelect');
                const selectedProject = projectSelect ? projectSelect.value : null;
                checkAlerts(selectedProject);
            }, 300000);
            
            // Auto-select "Aircall Projects" (ALL) by default and load data
            setTimeout(() => {
                const projectSelect = document.getElementById('projectSelect');
                if (projectSelect) {
                    projectSelect.value = 'ALL'; // Select "Aircall Projects" by default
                    console.log('üåü Auto-selected Aircall Projects (ALL) by default - will show data automatically');
                    
                    // Trigger change event to load combined data (only for ALL projects)
                    projectSelect.dispatchEvent(new Event('change'));
                } else {
                    console.warn('‚ö†Ô∏è Project select element not found');
                }
            }, 1000);
        });

        // Tab functionality
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                    
                    // Check if we need to show instructions for individual projects
                    const projectSelect = document.getElementById('projectSelect');
                    const selectedProject = projectSelect ? projectSelect.value : null;
                    
                    // If it's not "ALL" (Aircall Projects) and no data is loaded, show instructions
                    if (selectedProject && selectedProject !== 'ALL') {
                        const resultsContainer = document.getElementById('resultsContainer');
                        if (resultsContainer && resultsContainer.style.display === 'none') {
                            // No analysis has been done yet, show instructions for this tab
                            showTabInstruction(targetTab, selectedProject);
                        }
                    }
                });
            });
        }

        function showTabInstruction(tabName, projectName) {
            const icons = {
                'overview': 'üìä',
                'trends': 'üìà', 
                'alerts': 'üö®',
                'insights': 'üí°'
            };
            
            const titles = {
                'overview': 'Overview Analysis',
                'trends': 'Historical Trends', 
                'alerts': 'Risk Alerts',
                'insights': 'AI Insights'
            };
            
            const container = document.getElementById(tabName);
            if (container && tabName !== 'alerts') { // Alerts tab is handled separately
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #6c757d;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">${icons[tabName]}</div>
                        <h3 style="color: #495057; margin-bottom: 1rem;">${titles[tabName]} for ${projectName}</h3>
                        <p style="font-size: 1.1rem; margin-bottom: 2rem;">
                            Click the <strong>"üöÄ Analyze Project"</strong> button to view ${tabName} data.
                        </p>
                    </div>
                `;
            }
        }

        // Advanced filters
        function toggleAdvancedFilters() {
            const filters = document.getElementById('advancedFilters');
            filters.classList.toggle('show');
        }

        // Notification System
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            if (!container) return;

            // Create notification element
            const notification = document.createElement('div');
            const notificationId = 'notification-' + Date.now();
            notification.id = notificationId;
            
            // Set styles based on type
            const styles = {
                'success': {
                    background: '#d4edda',
                    border: '1px solid #c3e6cb',
                    color: '#155724',
                    icon: '‚úÖ'
                },
                'error': {
                    background: '#f8d7da',
                    border: '1px solid #f5c6cb',
                    color: '#721c24',
                    icon: '‚ùå'
                },
                'warning': {
                    background: '#fff3cd',
                    border: '1px solid #ffeaa7',
                    color: '#856404',
                    icon: '‚ö†Ô∏è'
                },
                'info': {
                    background: '#d1ecf1',
                    border: '1px solid #bee5eb',
                    color: '#0c5460',
                    icon: '‚ÑπÔ∏è'
                }
            };

            const style = styles[type] || styles['info'];
            
            // Adjust notification styling for dark mode
            const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
            let notificationStyle = style;
            
            if (isDarkMode) {
                // Use darker notification styles that work better in dark mode
                const darkStyles = {
                    'success': {
                        background: '#1e4d3a',
                        border: '1px solid #28a745',
                        color: '#4ade80',
                        icon: '‚úÖ'
                    },
                    'error': {
                        background: '#4a1e1e',
                        border: '1px solid #dc3545',
                        color: '#f87171',
                        icon: '‚ùå'
                    },
                    'warning': {
                        background: '#4a3d1e',
                        border: '1px solid #ffc107',
                        color: '#fbbf24',
                        icon: '‚ö†Ô∏è'
                    },
                    'info': {
                        background: '#1e3a4a',
                        border: '1px solid #17a2b8',
                        color: '#38bdf8',
                        icon: '‚ÑπÔ∏è'
                    }
                };
                notificationStyle = darkStyles[type] || darkStyles['info'];
            }

            notification.style.cssText = `
                background: ${notificationStyle.background};
                border: ${notificationStyle.border};
                color: ${notificationStyle.color};
                padding: 12px 16px;
                margin-bottom: 10px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                min-width: 300px;
                max-width: 450px;
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.4;
                display: flex;
                align-items: flex-start;
                animation: slideInRight 0.3s ease-out;
                position: relative;
                cursor: pointer;
                transition: all 0.2s ease;
            `;

            notification.innerHTML = `
                <span style="margin-right: 8px; font-size: 16px;">${notificationStyle.icon}</span>
                <span style="flex: 1;">${message}</span>
                <button onclick="closeNotification('${notificationId}')" 
                        style="background: none; border: none; font-size: 18px; color: ${notificationStyle.color}; 
                               cursor: pointer; margin-left: 8px; padding: 0; opacity: 0.7;"
                        onmouseover="this.style.opacity='1'" 
                        onmouseout="this.style.opacity='0.7'"
                        title="Close">√ó</button>
            `;

            // Add hover effect
            notification.addEventListener('mouseenter', function() {
                this.style.transform = 'translateX(-5px)';
                this.style.boxShadow = '0 6px 20px rgba(0,0,0,0.2)';
            });

            notification.addEventListener('mouseleave', function() {
                this.style.transform = 'translateX(0)';
                this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            });

            // Add click to close
            notification.addEventListener('click', function() {
                closeNotification(notificationId);
            });

            // Add notification to container
            container.appendChild(notification);

            // Auto-remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    closeNotification(notificationId);
                }, duration);
            }

            console.log(`üì¢ Notification shown: ${type.toUpperCase()} - ${message}`);
        }

        function closeNotification(notificationId) {
            const notification = document.getElementById(notificationId);
            if (notification) {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    if (notification && notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }

        // Close all notifications
        function closeAllNotifications() {
            const container = document.getElementById('notificationContainer');
            if (container) {
                const notifications = container.children;
                Array.from(notifications).forEach(notification => {
                    closeNotification(notification.id);
                });
            }
        }

        // Test notification function (can be called from console)
        window.testNotifications = function() {
            console.log('üß™ Testing notification system...');
            
            showNotification('‚úÖ This is a success notification!', 'success');
            
            setTimeout(() => {
                showNotification('‚ÑπÔ∏è This is an info notification', 'info');
            }, 500);
            
            setTimeout(() => {
                showNotification('‚ö†Ô∏è This is a warning notification', 'warning');
            }, 1000);
            
            setTimeout(() => {
                showNotification('‚ùå This is an error notification', 'error');
            }, 1500);
            
            setTimeout(() => {
                showNotification('üìä This notification will stay longer (10 seconds)', 'info', 10000);
            }, 2000);
            
            console.log('‚úÖ Test notifications sent! They should appear in the top-right corner');
        };

        // Dark Mode Functionality
        function toggleDarkMode() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // Update theme
            document.documentElement.setAttribute('data-theme', newTheme);
            
            // Update button text and icon
            const darkModeIcon = document.getElementById('darkModeIcon');
            const darkModeText = document.getElementById('darkModeText');
            
            if (newTheme === 'dark') {
                darkModeIcon.className = 'fas fa-sun';
                darkModeText.textContent = 'Light';
                showNotification('üåô Dark mode enabled', 'info', 3000);
            } else {
                darkModeIcon.className = 'fas fa-moon';
                darkModeText.textContent = 'Dark';
                showNotification('‚òÄÔ∏è Light mode enabled', 'info', 3000);
            }
            
            // Save preference to localStorage
            localStorage.setItem('theme-preference', newTheme);
            
            console.log(`üé® Theme switched to: ${newTheme}`);
        }

        // Load saved theme preference
        function loadThemePreference() {
            const savedTheme = localStorage.getItem('theme-preference');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                const darkModeIcon = document.getElementById('darkModeIcon');
                const darkModeText = document.getElementById('darkModeText');
                
                if (savedTheme === 'dark') {
                    darkModeIcon.className = 'fas fa-sun';
                    darkModeText.textContent = 'Light';
                } else {
                    darkModeIcon.className = 'fas fa-moon';
                    darkModeText.textContent = 'Dark';
                }
            }
        }

        // Info Dropdown Functionality
        function toggleInfoDropdown() {
            const dropdown = document.getElementById('infoDropdownMenu');
            if (dropdown) {
                const isVisible = dropdown.style.display === 'block';
                dropdown.style.display = isVisible ? 'none' : 'block';
                
                if (!isVisible) {
                    // Close dropdown when clicking outside
                    setTimeout(() => {
                        document.addEventListener('click', function closeDropdown(e) {
                            if (!e.target.closest('.info-dropdown')) {
                                dropdown.style.display = 'none';
                                document.removeEventListener('click', closeDropdown);
                            }
                        });
                    }, 100);
                }
            }
        }

        // Advanced Smart Notification System
        class SmartNotificationSystem {
            constructor() {
                this.notifications = [];
                this.maxNotifications = 5;
                this.alertThresholds = {
                    critical: { bugs: 10, components: 3 },
                    high: { bugs: 5, components: 2 },
                    medium: { bugs: 3, components: 1 }
                };
                this.alertHistory = [];
                this.silencedAlerts = new Set();
            }

            // Smart alert detection based on analysis data
            checkSmartAlerts(analysisData) {
                if (!analysisData || !analysisData.success) return;

                const alerts = [];
                const projectName = analysisData.project_name;

                // Check critical component alerts
                if (analysisData.risk_analysis && analysisData.risk_analysis.risk_levels) {
                    const criticalComponents = analysisData.risk_analysis.risk_levels.filter(
                        comp => comp.risk_level === 'Critical'
                    );

                    if (criticalComponents.length >= this.alertThresholds.critical.components) {
                        alerts.push({
                            type: 'error',
                            title: 'Critical Risk Alert',
                            message: `üö® ${criticalComponents.length} critical components detected in ${projectName}`,
                            data: criticalComponents,
                            actionRequired: true,
                            timestamp: new Date(),
                            project: projectName
                        });
                    }
                }

                // Check high bug count alerts
                if (analysisData.summary_stats && analysisData.summary_stats.total_bugs) {
                    const totalBugs = analysisData.summary_stats.total_bugs;
                    
                    if (totalBugs >= this.alertThresholds.critical.bugs) {
                        alerts.push({
                            type: 'warning',
                            title: 'High Bug Volume',
                            message: `‚ö†Ô∏è ${totalBugs} bugs detected in ${projectName} - above normal threshold`,
                            data: { total_bugs: totalBugs },
                            actionRequired: false,
                            timestamp: new Date(),
                            project: projectName
                        });
                    }
                }

                // Check AI health score alerts
                if (analysisData.summary_stats && analysisData.summary_stats.ai_health_score) {
                    const healthScore = analysisData.summary_stats.ai_health_score;
                    
                    if (healthScore < 50) {
                        alerts.push({
                            type: 'error',
                            title: 'Low Health Score',
                            message: `üè• ${projectName} health score is ${healthScore}/100 - immediate attention required`,
                            data: { health_score: healthScore },
                            actionRequired: true,
                            timestamp: new Date(),
                            project: projectName
                        });
                    } else if (healthScore < 70) {
                        alerts.push({
                            type: 'warning',
                            title: 'Declining Health',
                            message: `üìâ ${projectName} health score is ${healthScore}/100 - monitor closely`,
                            data: { health_score: healthScore },
                            actionRequired: false,
                            timestamp: new Date(),
                            project: projectName
                        });
                    }
                }

                // Process and display alerts
                alerts.forEach(alert => this.processAlert(alert));
            }

            processAlert(alert) {
                const alertKey = `${alert.project}-${alert.type}-${alert.title}`;
                
                // Check if alert is silenced
                if (this.silencedAlerts.has(alertKey)) return;

                // Check if similar alert was recently shown (within 10 minutes)
                const recentAlert = this.alertHistory.find(h => 
                    h.key === alertKey && 
                    (Date.now() - h.timestamp) < 10 * 60 * 1000
                );

                if (recentAlert) return;

                // Add to history
                this.alertHistory.push({
                    key: alertKey,
                    timestamp: Date.now(),
                    alert: alert
                });

                // Show notification
                this.showSmartNotification(alert);

                // Update alerts tab if necessary
                this.updateAlertsTab(alert);
            }

            showSmartNotification(alert) {
                const duration = alert.actionRequired ? 10000 : 5000; // Longer for critical alerts
                
                let message = alert.message;
                if (alert.actionRequired) {
                    message += ' <button onclick="smartNotificationSystem.viewAlertDetails(\'' + 
                               alert.project + '\')" style="margin-left: 10px; padding: 2px 8px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; color: inherit; cursor: pointer;">View Details</button>';
                }

                showNotification(message, alert.type, duration);

                // Add to active notifications
                this.notifications.push(alert);
                
                // Maintain max notifications limit
                if (this.notifications.length > this.maxNotifications) {
                    this.notifications.shift();
                }
            }

            updateAlertsTab(alert) {
                const alertsContainer = document.getElementById('alertsContainer');
                if (!alertsContainer) return;

                // Create or update alerts display
                if (!alertsContainer.querySelector('.smart-alerts-container')) {
                    alertsContainer.innerHTML = `
                        <div class="smart-alerts-container">
                            <h4>ü§ñ Smart Risk Alerts</h4>
                            <div class="alerts-list" id="smartAlertsList"></div>
                            <div class="alert-controls" style="margin-top: 1rem;">
                                <button onclick="smartNotificationSystem.clearAllAlerts()" class="btn btn-secondary">
                                    Clear All Alerts
                                </button>
                                <button onclick="smartNotificationSystem.snoozeAlerts()" class="btn btn-warning">
                                    Snooze for 1 hour
                                </button>
                            </div>
                        </div>
                    `;
                }

                const alertsList = document.getElementById('smartAlertsList');
                if (alertsList) {
                    const alertElement = document.createElement('div');
                    alertElement.className = `alert-item alert-${alert.type}`;
                    alertElement.style.cssText = `
                        background: white;
                        border-left: 4px solid ${this.getAlertColor(alert.type)};
                        padding: 1rem;
                        margin-bottom: 0.5rem;
                        border-radius: 4px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    `;
                    
                    alertElement.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h6 style="margin: 0 0 0.5rem 0; color: ${this.getAlertColor(alert.type)};">
                                    ${alert.title}
                                </h6>
                                <p style="margin: 0; font-size: 0.9rem; color: #6c757d;">
                                    ${alert.message.replace(/<[^>]*>/g, '')}
                                </p>
                                <small style="color: #999;">
                                    ${alert.timestamp.toLocaleTimeString()} - ${alert.project}
                                </small>
                            </div>
                            <button onclick="this.parentElement.parentElement.remove()" 
                                    style="background: none; border: none; font-size: 16px; color: #999; cursor: pointer;">
                                √ó
                            </button>
                        </div>
                    `;
                    
                    alertsList.insertBefore(alertElement, alertsList.firstChild);
                }
            }

            getAlertColor(type) {
                const colors = {
                    'critical': '#dc3545',
                    'error': '#dc3545',
                    'warning': '#ffc107',
                    'info': '#17a2b8',
                    'success': '#28a745'
                };
                return colors[type] || '#6c757d';
            }

            viewAlertDetails(project) {
                // Switch to alerts tab and focus on project
                const alertsTab = document.querySelector('[data-tab="alerts"]');
                if (alertsTab) {
                    alertsTab.click();
                }
                
                showNotification(`üìä Viewing alerts for ${project}`, 'info', 3000);
            }

            clearAllAlerts() {
                this.notifications = [];
                this.alertHistory = [];
                
                const alertsList = document.getElementById('smartAlertsList');
                if (alertsList) {
                    alertsList.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 2rem;">No active alerts</p>';
                }
                
                showNotification('üßπ All alerts cleared', 'success', 3000);
            }

            snoozeAlerts() {
                // Add current alert keys to silenced set with timeout
                this.notifications.forEach(alert => {
                    const alertKey = `${alert.project}-${alert.type}-${alert.title}`;
                    this.silencedAlerts.add(alertKey);
                });

                // Remove from silenced after 1 hour
                setTimeout(() => {
                    this.silencedAlerts.clear();
                    showNotification('üîî Alert snooze expired - monitoring resumed', 'info', 3000);
                }, 60 * 60 * 1000);

                showNotification('üò¥ Alerts snoozed for 1 hour', 'warning', 3000);
            }
        }

        // Initialize smart notification system
        const smartNotificationSystem = new SmartNotificationSystem();

        // Enhanced analyze function to include smart alerts
        const originalAnalyzeProject = window.analyzeProject;
        window.analyzeProject = function(silent = false) {
            return originalAnalyzeProject(silent).then(() => {
                // Check for smart alerts after analysis
                if (currentProject && !silent) {
                    // Use current analysis data if available, or fetch fresh data
                    const projectSelect = document.getElementById('projectSelect');
                    const selectedProject = projectSelect ? projectSelect.value : null;
                    
                    if (selectedProject) {
                        fetch(`/api/analyze/${selectedProject}`)
                            .then(response => response.json())
                            .then(data => {
                                smartNotificationSystem.checkSmartAlerts(data);
                            })
                            .catch(error => {
                                console.error('‚ùå Error checking smart alerts:', error);
                            });
                    }
                }
            }).catch(error => {
                console.error('‚ùå Error in enhanced analyze project:', error);
            });
        };

        // Suggested enhancement
        function setupAdvancedAlerts() {
            // Email notifications for critical issues
            // Slack/Teams integration
            // Custom thresholds per project
            // Alert escalation rules
        }

        // Smart notification system and dark mode logging
        console.log('ü§ñ Smart notification system activated');
        console.log('üåô Dark mode system activated');

        // ========================================================================================
        // üì± PWA (Progressive Web App) Features
        // ========================================================================================

        // Service Worker Registration and PWA Installation
        let deferredPrompt;
        let isInstalled = false;

        // Check if running as PWA
        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone || 
                   document.referrer.includes('android-app://');
        }

        // Register Service Worker
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    console.log('üì± Registering service worker...');
                    const registration = await navigator.serviceWorker.register('/static/sw.js');
                    
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showNotification('üîÑ App updated! Refresh to get the latest version.', 'info', 8000);
                            }
                        });
                    });
                    
                    console.log('‚úÖ Service Worker registered successfully');
                    showNotification('üì± App ready for offline use', 'success', 3000);
                    
                } catch (error) {
                    console.error('‚ùå Service Worker registration failed:', error);
                    showNotification('‚ùå Offline features unavailable', 'warning', 5000);
                }
            }
        }

        // PWA Install Banner Management
        function showInstallBanner() {
            const banner = document.getElementById('installBanner');
            const dismissed = localStorage.getItem('install-banner-dismissed');
            const remindLater = localStorage.getItem('install-remind-later');
            
            // Don't show if already installed, dismissed, or reminded later (within 24 hours)
            if (isPWA() || dismissed === 'true') return;
            
            if (remindLater) {
                const remindTime = parseInt(remindLater);
                if (Date.now() - remindTime < 24 * 60 * 60 * 1000) return; // 24 hours
            }
            
            if (banner) {
                banner.classList.add('show');
                console.log('üì± Install banner shown');
            }
        }

        // Install PWA
        window.installPWA = async function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('‚úÖ PWA installation accepted');
                    showNotification('üì± Installing BugDash...', 'success', 3000);
                    dismissInstallBanner();
                } else {
                    console.log('‚ùå PWA installation declined');
                    showNotification('üì± Installation cancelled', 'info', 2000);
                }
                
                deferredPrompt = null;
            } else {
                // Fallback instructions
                showNotification('üì± Add to Home Screen from your browser menu', 'info', 5000);
            }
        };

        // Remind later
        window.remindLater = function() {
            localStorage.setItem('install-remind-later', Date.now().toString());
            dismissInstallBanner();
            showNotification('üì± We\'ll remind you later', 'info', 2000);
        };

        // Dismiss install banner
        window.dismissInstallBanner = function() {
            const banner = document.getElementById('installBanner');
            if (banner) {
                banner.classList.remove('show');
                localStorage.setItem('install-banner-dismissed', 'true');
            }
        };

        // Online/Offline Detection
        function updateOnlineStatus() {
            const offlineIndicator = document.getElementById('offlineIndicator');
            const connectionDot = document.getElementById('connectionStatus');
            const connectionText = document.getElementById('connectionText');
            
            if (navigator.onLine) {
                // Online
                if (offlineIndicator) {
                    offlineIndicator.classList.remove('show');
                }
                
                if (connectionDot && connectionText) {
                    connectionDot.className = 'status-dot';
                    connectionText.textContent = 'Connected';
                }
                
                console.log('üåê Online - Full functionality available');
                
                // Try to sync any pending data
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({
                        type: 'BACKGROUND_SYNC',
                        data: { timestamp: Date.now() }
                    });
                }
                
            } else {
                // Offline
                if (offlineIndicator) {
                    offlineIndicator.classList.add('show');
                }
                
                if (connectionDot && connectionText) {
                    connectionDot.className = 'status-dot error';
                    connectionText.textContent = 'Offline';
                }
                
                console.log('üì° Offline - Limited functionality');
                showNotification('üì° You\'re offline - Cached data available', 'warning', 5000);
            }
        }

        // Push Notifications Toggle
        window.toggleNotifications = async function() {
            const notificationStatus = document.getElementById('notificationStatus');
            
            try {
                // Check if notifications are supported
                if (!('Notification' in window)) {
                    console.log('üîî Notifications not supported');
                    updateNotificationStatus('unsupported', '‚ùå Not Supported', 'Notifications not supported on this device');
                    showNotification('üîî Push notifications not supported on this device', 'warning', 5000);
                    return;
                }
                
                // Get current permission status
                let permission = Notification.permission;
                console.log(`üîî Current notification permission: ${permission}`);
                
                // Check internal disabled state
                const internallyDisabled = localStorage.getItem('notifications-disabled') === 'true';
                console.log(`üîî Internally disabled: ${internallyDisabled}`);
                
                if (permission === 'granted' && !internallyDisabled) {
                    // Currently enabled - user wants to disable
                    console.log('üîî Disabling notifications...');
                    localStorage.setItem('notifications-disabled', 'true');
                    updateNotificationStatus('blocked', 'üîï Disabled', 'Click to enable push notifications');
                    showNotification('üîï Push notifications disabled. You can re-enable them anytime.', 'info', 5000);
                    
                    // Stop periodic alert checks if available
                    if (window.pushManager && window.pushManager.stopPeriodicAlertCheck) {
                        window.pushManager.stopPeriodicAlertCheck();
                    }
                    return;
                }
                
                if (permission === 'granted' && internallyDisabled) {
                    // Browser permission granted but internally disabled - user wants to re-enable
                    console.log('üîî Re-enabling notifications...');
                    localStorage.removeItem('notifications-disabled');
                    updateNotificationStatus('enabled', '‚úÖ Enabled', 'Click to disable push notifications');
                    showNotification('üîî Push notifications re-enabled!', 'success', 3000);
                    
                    // Restart periodic alert checks if available
                    if (window.pushManager && window.pushManager.isEnabled()) {
                        window.pushManager.startPeriodicAlertCheck();
                    }
                    return;
                }
                
                if (permission === 'default') {
                    // Request permission for the first time
                    console.log('üîî Requesting notification permission...');
                    permission = await Notification.requestPermission();
                    console.log(`üîî Permission result: ${permission}`);
                }
                
                // Update UI based on permission
                if (permission === 'granted') {
                    // Newly granted permission
                    localStorage.removeItem('notifications-disabled'); // Ensure not disabled
                    updateNotificationStatus('enabled', '‚úÖ Enabled', 'Click to disable push notifications');
                    showNotification('üîî Push notifications enabled! You\'ll receive alerts for critical issues.', 'success', 5000);
                    
                    // Start periodic alert checks if available
                    if (window.pushManager && window.pushManager.isEnabled()) {
                        window.pushManager.startPeriodicAlertCheck();
                    }
                    
                    // Test notification
                    setTimeout(() => {
                        new Notification('BugDash Alert System', {
                            body: 'Notifications are now enabled for critical bug alerts',
                            icon: '/static/icons/icon-192x192.png',
                            badge: '/static/icons/icon-192x192.png'
                        });
                    }, 1000);
                    
                } else if (permission === 'denied') {
                    updateNotificationStatus('blocked', 'üö´ Blocked', 'Notifications blocked by browser - Check your browser settings');
                    showNotification('üö´ Notifications are blocked by your browser. Please enable them in your browser settings if you want to receive alerts.', 'error', 8000);
                    
                } else {
                    // Permission === 'default' (shouldn't happen after request, but just in case)
                    updateNotificationStatus('default', '‚ùì Enable', 'Click to enable push notifications');
                    showNotification('üîî Notification permission not granted', 'warning', 3000);
                }
                
            } catch (error) {
                console.error('üîî Error toggling notifications:', error);
                updateNotificationStatus('default', '‚ùå Error', 'Error setting up notifications');
                showNotification('‚ùå Could not toggle notifications', 'error', 5000);
            }
        };

        // Helper function to update notification status UI
        function updateNotificationStatus(status, text, title) {
            const notificationStatus = document.getElementById('notificationStatus');
            if (notificationStatus) {
                // Remove all status classes
                notificationStatus.className = 'notification-status';
                // Add new status class
                notificationStatus.classList.add(status);
                // Update text and title
                notificationStatus.textContent = text;
                notificationStatus.title = title;
                
                console.log(`üîî Updated notification status to: ${status} - ${text}`);
            }
        }

        // Initialize notification status on page load
        function initializeNotificationStatus() {
            if ('Notification' in window) {
                const permission = Notification.permission;
                const internallyDisabled = localStorage.getItem('notifications-disabled') === 'true';
                console.log(`üîî Initial notification permission: ${permission}, internally disabled: ${internallyDisabled}`);
                
                switch (permission) {
                    case 'granted':
                        if (internallyDisabled) {
                            updateNotificationStatus('blocked', 'üîï Disabled', 'Click to enable push notifications');
                        } else {
                            updateNotificationStatus('enabled', '‚úÖ Enabled', 'Click to disable push notifications');
                        }
                        break;
                    case 'denied':
                        updateNotificationStatus('blocked', 'üö´ Blocked', 'Notifications blocked by browser - Please enable in browser settings');
                        break;
                    default:
                        updateNotificationStatus('default', '‚ùì Enable', 'Click to enable push notifications');
                        break;
                }
            } else {
                updateNotificationStatus('unsupported', '‚ùå Not Supported', 'Notifications not supported on this device');
            }
        }

        // Test PWA Features
        window.testPWAFeatures = function() {
            console.log('üß™ Testing PWA features...');
            
            // Test notifications
            if (window.pushManager) {
                window.pushManager.testNotification();
            }
            
            // Test offline detection
            updateOnlineStatus();
            
            // Test install banner
            if (!isPWA()) {
                showInstallBanner();
            }
            
            console.log('‚úÖ PWA feature test complete');
        };

        // Enhanced touch gestures for mobile
        function addTouchGestures() {
            let startX, startY;
            
            // Add swipe gesture for tab navigation
            const tabsContainer = document.querySelector('.tabs');
            if (tabsContainer) {
                tabsContainer.addEventListener('touchstart', function(e) {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                }, { passive: true });
                
                tabsContainer.addEventListener('touchend', function(e) {
                    if (!startX || !startY) return;
                    
                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;
                    
                    const diffX = startX - endX;
                    const diffY = startY - endY;
                    
                    // Horizontal swipe
                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                        const tabs = document.querySelectorAll('.tab');
                        const activeTab = document.querySelector('.tab.active');
                        const activeIndex = Array.from(tabs).indexOf(activeTab);
                        
                        if (diffX > 0 && activeIndex < tabs.length - 1) {
                            // Swipe left - next tab
                            tabs[activeIndex + 1].click();
                        } else if (diffX < 0 && activeIndex > 0) {
                            // Swipe right - previous tab
                            tabs[activeIndex - 1].click();
                        }
                    }
                    
                    startX = startY = null;
                }, { passive: true });
            }
        }

        // PWA Initialization
        function initializePWA() {
            console.log('üì± Initializing PWA features...');
            
            // Check if already installed
            isInstalled = isPWA();
            if (isInstalled) {
                console.log('üì± Running as installed PWA');
                showNotification('üì± Welcome to BugDash App!', 'success', 3000);
            }
            
            // Register service worker
            registerServiceWorker();
            
            // Setup offline detection
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();
            
            // Setup install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                console.log('üì± Install prompt available');
                
                // Show install banner after a delay if not already installed
                if (!isInstalled) {
                    setTimeout(showInstallBanner, 3000);
                }
            });
            
            // Handle app installation
            window.addEventListener('appinstalled', (e) => {
                console.log('‚úÖ PWA installed successfully');
                isInstalled = true;
                deferredPrompt = null;
                dismissInstallBanner();
                showNotification('üéâ BugDash installed successfully!', 'success', 5000);
            });
            
            // Add touch gestures for mobile
            addTouchGestures();
            
            // Initialize push notifications
            if (window.pushManager) {
                // Auto-enable periodic checks if notifications are already granted
                if (Notification.permission === 'granted') {
                    setTimeout(() => {
                        if (window.pushManager.isEnabled()) {
                            window.pushManager.startPeriodicAlertCheck(5); // Every 5 minutes
                            console.log('üîî Auto-started periodic alert checks');
                        }
                    }, 2000);
                }
            }
            
            console.log('‚úÖ PWA initialization complete');
        }

        // Load PWA dependencies
        function loadPWADependencies() {
            // Load push notifications module
            const script = document.createElement('script');
            script.src = '/static/push-notifications.js';
            script.onload = function() {
                console.log('üîî Push notifications module loaded');
                
                // Initialize PWA after dependencies loaded
                setTimeout(initializePWA, 100);
            };
            script.onerror = function() {
                console.warn('‚ö†Ô∏è Push notifications module failed to load');
                // Initialize PWA anyway, just without push notifications
                initializePWA();
            };
            document.head.appendChild(script);
        }

        // Enhanced alert banner interaction
        function enhanceAlertBanner() {
            const alertBanner = document.getElementById('alertBanner');
            if (!alertBanner) return;
            
            // Add click handler to alert banner for better interaction
            alertBanner.addEventListener('click', function(e) {
                if (e.target.tagName !== 'BUTTON') {
                    const viewDetailsBtn = alertBanner.querySelector('button');
                    if (viewDetailsBtn) {
                        viewDetailsBtn.click();
                    }
                }
            });
            
            console.log('üö® Alert banner enhanced with click interaction');
        }

        // üì± PWA Debug Console Commands
        window.pwaDebug = {
            testInstall: () => showInstallBanner(),
            testOffline: () => {
                // Simulate offline
                window.dispatchEvent(new Event('offline'));
                setTimeout(() => window.dispatchEvent(new Event('online')), 5000);
            },
            clearStorage: () => {
                localStorage.removeItem('install-banner-dismissed');
                localStorage.removeItem('install-remind-later');
                console.log('üóëÔ∏è PWA storage cleared');
            },
            info: () => {
                console.log('üì± PWA Status:', {
                    installed: isPWA(),
                    serviceWorker: 'serviceWorker' in navigator,
                    pushNotifications: 'PushManager' in window,
                    online: navigator.onLine,
                    notifications: Notification.permission
                });
            },
            testNotifications: () => {
                console.log('üîî Testing notification toggle...');
                toggleNotifications();
            },
            resetNotifications: () => {
                // Reset to default state for testing
                localStorage.removeItem('notifications-disabled');
                updateNotificationStatus('default', '‚ùì Enable', 'Click to enable push notifications');
                console.log('üîÑ Notification status reset to default');
            },
            disableNotifications: () => {
                // Force disable for testing
                localStorage.setItem('notifications-disabled', 'true');
                updateNotificationStatus('blocked', 'üîï Disabled', 'Click to enable push notifications');
                console.log('üîï Notifications force disabled for testing');
            },
            testAlert: (message = 'Test alert banner with üö® icon', dramatic = false) => {
                const alertBanner = document.getElementById('alertBanner');
                const alertMessage = document.getElementById('alertMessage');
                if (alertBanner && alertMessage) {
                    alertMessage.textContent = message;
                    alertBanner.classList.add('show');
                    if (dramatic) {
                        alertBanner.classList.add('dramatic');
                        console.log('üö® Dramatic test alert banner shown');
                    } else {
                        alertBanner.classList.remove('dramatic');
                        console.log('üö® Test alert banner shown');
                    }
                    setTimeout(() => {
                        alertBanner.classList.remove('show', 'dramatic');
                        console.log('‚úÖ Test alert banner hidden');
                    }, 5000);
                }
            },
            testDramaticAlert: (message = 'CRITICAL: Dramatic üö® alert!') => {
                window.pwaDebug.testAlert(message, true);
            },
            hideAlert: () => {
                const alertBanner = document.getElementById('alertBanner');
                if (alertBanner) {
                    alertBanner.classList.remove('show');
                    console.log('üö´ Alert banner hidden');
                }
            }
        };

        // ‚úÖ MISSING FUNCTIONS FOR AI INSIGHTS ONCLICK HANDLERS
        window.showAllComponentsSidebarFromInsights = function() {
            console.log('üîß showAllComponentsSidebarFromInsights called');
            
            if (window.currentInsightsRiskData && window.currentInsightsRiskData.length > 0) {
                console.log('‚úÖ Using insights risk data:', window.currentInsightsRiskData);
                showAllComponentsSidebar(window.currentInsightsRiskData);
            } else {
                console.error('‚ùå No insights risk data available');
                alert('No risk data available. Please analyze a project first.');
            }
        };
        
        window.showRiskAnalysisDetailsFromInsights = function() {
            console.log('üîß showRiskAnalysisDetailsFromInsights called');
            
            if (window.currentInsightsRiskData && window.currentInsightsRiskData.length > 0) {
                const risk = window.currentInsightsRiskData[0]; // Get first risk for overall data
                const riskLevel = risk.risk_level || 'MEDIUM';
                const overallScore = risk.ai_risk_score || 50;
                
                showRiskAnalysisDetails(riskLevel, overallScore, window.currentInsightsRiskData);
            } else {
                console.error('‚ùå No insights risk data available');
                alert('No risk data available. Please analyze a project first.');
            }
        };

        console.log('üì± PWA Features loaded! Type pwaDebug.info() for status');
        console.log('üéÆ Test commands: pwaDebug.testAlert(), pwaDebug.testNotifications(), pwaDebug.testOffline()');
        console.log('üîî Notification commands: pwaDebug.testNotifications(), pwaDebug.resetNotifications(), pwaDebug.disableNotifications()');

        // üéØ GOAL TRACKING SYSTEM FUNCTIONS
        
        async function initializeGoals() {
            console.log('üéØ Initializing goals for current project...');
            console.log('üîç Current project:', currentProject);
            console.log('üîç Project select value:', document.getElementById('projectSelect')?.value);
            
            if (!currentProject) {
                // Try to get current project from dropdown
                const projectSelect = document.getElementById('projectSelect');
                if (projectSelect && projectSelect.value) {
                    console.log('üîÑ Using selected project from dropdown:', projectSelect.value);
                    currentProject = projectSelect.value;  // This includes "ALL" for Aircall Projects
                } else {
                    showNotification('Please select a project from the dropdown first', 'warning');
                    return;
                }
            }
            
            // For goal tracking, "ALL" (Aircall Projects) is perfectly valid
            console.log('üéØ Goal tracking will use project:', currentProject);
            
            showGoalsLoading();
            
            try {
                const response = await fetch(`/api/goals/${currentProject}/initialize`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`üéØ ${data.message}`, 'success');
                    await loadGoalsDashboard();
                } else {
                    showNotification(`Error: ${data.message}`, 'error');
                    hideGoalsLoading();
                }
            } catch (error) {
                console.error('‚ùå Error initializing goals:', error);
                showNotification('Error initializing goals', 'error');
                hideGoalsLoading();
            }
        }
        
        async function loadGoalsDashboard() {
            console.log('üìä Loading goals dashboard for:', currentProject);
            
            if (!currentProject) {
                // Try to get current project from dropdown
                const projectSelect = document.getElementById('projectSelect');
                if (projectSelect && projectSelect.value) {
                    console.log('üîÑ Using selected project from dropdown for dashboard:', projectSelect.value);
                    currentProject = projectSelect.value;  // Includes "ALL" for Aircall Projects
                } else {
                    console.log('‚ö†Ô∏è No project selected, showing no goals state');
                    showNoGoalsState();
                    return;
                }
            }
            
            try {
                // Load goals, achievements, and insights in parallel
                const [goalsResponse, achievementsResponse, insightsResponse] = await Promise.all([
                    fetch(`/api/goals/${currentProject}`),
                    fetch(`/api/goals/${currentProject}/achievements`),
                    fetch(`/api/goals/${currentProject}/insights`)
                ]);
                
                const goalsData = await goalsResponse.json();
                const achievementsData = await achievementsResponse.json();
                const insightsData = await insightsResponse.json();
                
                if (goalsData.success) {
                    if (goalsData.data.goals.length === 0) {
                        showNoGoalsState();
                    } else {
                        displayGoalsDashboard(goalsData.data, achievementsData.data, insightsData.data);
                    }
                } else {
                    showNotification(`Error loading goals: ${goalsData.message}`, 'error');
                    showNoGoalsState();
                }
                
            } catch (error) {
                console.error('‚ùå Error loading goals dashboard:', error);
                showNotification('Error loading goals dashboard', 'error');
                showNoGoalsState();
            }
            
            hideGoalsLoading();
        }
        
        function displayGoalsDashboard(goalsData, achievementsData, insightsData) {
            console.log('üéØ Displaying goals dashboard with data:', goalsData);
            
            // Show dashboard, hide other states
            document.getElementById('goalsDashboard').style.display = 'block';
            document.getElementById('noGoalsState').style.display = 'none';
            
            // Display analytics
            displayGoalsAnalytics(goalsData.analytics);
            
            // Display achievements
            if (achievementsData) {
                displayAchievements(achievementsData);
            }
            
            // Display active goals
            displayActiveGoals(goalsData.goals);
            
            // Display insights
            if (insightsData) {
                displayGoalInsights(insightsData);
            }
        }
        
        function displayGoalsAnalytics(analytics) {
            const container = document.getElementById('goalsAnalytics');
            
            container.innerHTML = `
                <div class="analytics-card">
                    <div class="analytics-value">${analytics.total_goals}</div>
                    <div class="analytics-label">Total Goals</div>
                    <div class="analytics-description">All goals created</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value">${analytics.active_goals}</div>
                    <div class="analytics-label">Active Goals</div>
                    <div class="analytics-description">Currently in progress</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value">${Math.round(analytics.average_progress)}%</div>
                    <div class="analytics-label">Avg Progress</div>
                    <div class="analytics-description">Across all goals</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value">${analytics.goals_on_track}</div>
                    <div class="analytics-label">On Track</div>
                    <div class="analytics-description">Goals with 70%+ confidence</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value">${analytics.achievements_earned}</div>
                    <div class="analytics-label">Achievements</div>
                    <div class="analytics-description">Badges earned</div>
                </div>
            `;
        }
        
        function displayAchievements(achievementsData) {
            const container = document.getElementById('achievementsSection');
            
            if (!achievementsData || achievementsData.total_achievements === 0) {
                container.innerHTML = `
                    <div class="achievements-header">
                        <h4>üèÜ Achievements</h4>
                        <span>0 badges earned</span>
                    </div>
                    <p style="text-align: center; color: #666; padding: 2rem;">
                        Complete goal milestones to earn achievement badges! üéØ
                    </p>
                `;
                return;
            }
            
            let achievementsHtml = `
                <div class="achievements-header">
                    <h4>üèÜ Achievements</h4>
                    <span>${achievementsData.total_achievements} badges earned</span>
                </div>
                <div class="achievements-grid">
            `;
            
            achievementsData.achievement_list.forEach(achievement => {
                const date = new Date(achievement.achieved_date).toLocaleDateString();
                achievementsHtml += `
                    <div class="achievement-card">
                        <div class="achievement-badge">${achievement.badge.split(' ')[0]}</div>
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-date">${date}</div>
                    </div>
                `;
            });
            
            achievementsHtml += '</div>';
            container.innerHTML = achievementsHtml;
        }
        
        function displayActiveGoals(goals) {
            const container = document.getElementById('activeGoalsList');
            
            const activeGoals = goals.filter(goal => goal.status === 'active');
            
            if (activeGoals.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #666;">
                        <h4>No active goals</h4>
                        <p>All goals completed! üéâ</p>
                        <button class="btn btn-primary" onclick="createNewGoal()">Create New Goal</button>
                    </div>
                `;
                return;
            }
            
            let goalsHtml = '';
            
            activeGoals.forEach(goal => {
                const progress = goal.metrics.progress_percentage;
                const confidence = goal.metrics.confidence_score;
                const daysRemaining = goal.metrics.days_remaining;
                
                // Generate milestones HTML
                let milestonesHtml = '<div class="milestones">';
                goal.milestones.forEach(milestone => {
                    milestonesHtml += `
                        <div class="milestone ${milestone.achieved ? 'achieved' : ''}">
                            <div class="milestone-icon">${milestone.achieved ? '‚úì' : milestone.percentage + '%'}</div>
                            <div class="milestone-label">${milestone.percentage}%</div>
                        </div>
                    `;
                });
                milestonesHtml += '</div>';
                
                goalsHtml += `
                    <div class="goal-card">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">${goal.title}</div>
                                <div class="goal-description">${goal.description}</div>
                            </div>
                            <div class="goal-type">${goal.type.replace('_', ' ').toUpperCase()}</div>
                        </div>
                        
                        <div class="progress-section">
                            <div class="progress-header">
                                <span>Progress</span>
                                <span class="progress-percentage">${Math.round(progress)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            ${milestonesHtml}
                        </div>
                        
                        <div class="goal-metrics">
                            <div class="metric-item">
                                <div class="metric-value">${daysRemaining}</div>
                                <div class="metric-label">Days Left</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${goal.current_value}</div>
                                <div class="metric-label">Current</div>
                            </div>
                        </div>
                        
                        <div class="confidence-score">
                            <span>Confidence: ${confidence}%</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${confidence}%"></div>
                            </div>
                        </div>
                        
                        <div class="goal-actions">
                            <button class="btn btn-small btn-secondary" onclick="updateGoalProgress('${goal.id}')">Update Progress</button>
                            <button class="btn btn-small btn-primary" onclick="viewGoalPrediction('${goal.id}')">üìà Forecast</button>
                            <button class="btn btn-small btn-delete" onclick="confirmDeleteGoal('${goal.id}', '${goal.title}')">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = goalsHtml;
        }
        
        function displayGoalInsights(insightsData) {
            const container = document.getElementById('goalInsights');
            
            if (!insightsData) {
                container.style.display = 'none';
                return;
            }
            
            container.innerHTML = `
                <h4>üß† Goal Insights</h4>
                <div class="insights-grid">
                    <div class="insight-section">
                        <h4>üìä Summary</h4>
                        <p>${insightsData.summary}</p>
                        
                        <h4>üéØ Recommendations</h4>
                        <ul class="insight-list">
                            ${insightsData.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="insight-section">
                        ${insightsData.success_stories.length > 0 ? `
                            <h4>üèÜ Success Stories</h4>
                            <ul class="insight-list">
                                ${insightsData.success_stories.map(story => `<li>${story}</li>`).join('')}
                            </ul>
                        ` : ''}
                        
                        ${insightsData.risk_alerts.length > 0 ? `
                            <h4>‚ö†Ô∏è Risk Alerts</h4>
                            <ul class="insight-list">
                                ${insightsData.risk_alerts.map(alert => `<li>${alert}</li>`).join('')}
                            </ul>
                        ` : ''}
                        
                        ${insightsData.next_actions.length > 0 ? `
                            <h4>üöÄ Next Actions</h4>
                            <ul class="insight-list">
                                ${insightsData.next_actions.map(action => `<li>${action}</li>`).join('')}
                            </ul>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        async function updateGoalProgress(goalId) {
            // Find the goal to get current information
            const goals = document.querySelectorAll('.goal-card');
            let goalTitle = 'Goal';
            let currentValue = '';
            
            goals.forEach(card => {
                const updateBtn = card.querySelector(`button[onclick="updateGoalProgress('${goalId}')"]`);
                if (updateBtn) {
                    goalTitle = card.querySelector('.goal-title')?.textContent || 'Goal';
                    currentValue = card.querySelector('.metric-value')?.textContent || '';
                }
            });
            
            const content = `
                <div class="popup-header">
                    <h3>üìà Update Progress: ${goalTitle}</h3>
                </div>
                <div class="popup-content">
                    <div style="margin-bottom: 1.5rem;">
                        <p style="color: #cbd5e1; margin-bottom: 1rem;">Enter the new current value to update your progress:</p>
                        
                        <div class="progress-current-display">
                            <div class="progress-metric">
                                <span class="progress-metric-label">Current Value:</span>
                                <span class="progress-metric-value">${currentValue}</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label class="goal-form-label">New Value:</label>
                            <input type="number" id="goalProgressInput" class="goal-form-input"
                                   placeholder="Enter new value..." 
                                   step="0.1"
                                   onkeypress="if(event.key==='Enter') document.getElementById('updateProgressBtn').click()">
                        </div>
                        
                        <div class="goal-actions">
                            <button class="goal-button-secondary" onclick="closePopup()">
                                Cancel
                            </button>
                            <button id="updateProgressBtn"
                                    style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); 
                                           border: none; color: white; border-radius: 6px; cursor: pointer; font-weight: 600;
                                           transition: all 0.2s ease;"
                                    onmouseover="this.style.background='linear-gradient(135deg, #059669, #047857)'"
                                    onmouseout="this.style.background='linear-gradient(135deg, #10b981, #059669)'"
                                    onclick="submitGoalProgress('${goalId}')">
                                üìà Update Progress
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            showPopup(content);
            
            // Focus on input after modal shows
            setTimeout(() => {
                const input = document.getElementById('goalProgressInput');
                if (input) input.focus();
            }, 100);
        }
        
        async function submitGoalProgress(goalId) {
            const input = document.getElementById('goalProgressInput');
            const newValue = input?.value;
            
            if (!newValue) {
                showNotification('Please enter a value', 'warning');
                return;
            }
            
            const value = parseFloat(newValue);
            if (isNaN(value)) {
                showNotification('Please enter a valid number', 'warning');
                return;
            }
            
            closePopup();
            
            try {
                const response = await fetch(`/api/goals/${currentProject}/${goalId}/update`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ current_value: value })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`‚úÖ ${data.message}`, 'success');
                    
                    // Show any new achievements
                    if (data.data.new_achievements && data.data.new_achievements.length > 0) {
                        data.data.new_achievements.forEach(achievement => {
                            showNotification(`üèÜ Achievement Unlocked: ${achievement.title}!`, 'success', 5000);
                        });
                    }
                    
                    // Reload dashboard
                    await loadGoalsDashboard();
                } else {
                    showNotification(`‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Error updating goal:', error);
                showNotification('‚ùå Error updating goal progress', 'error');
            }
        }
        
        async function viewGoalPrediction(goalId) {
            // Find the goal to get current information
            const goals = document.querySelectorAll('.goal-card');
            let goalTitle = 'Goal';
            
            goals.forEach(card => {
                const forecastBtn = card.querySelector(`button[onclick="viewGoalPrediction('${goalId}')"]`);
                if (forecastBtn) {
                    goalTitle = card.querySelector('.goal-title')?.textContent || 'Goal';
                }
            });
            
            try {
                const response = await fetch(`/api/goals/${currentProject}/${goalId}/prediction`);
                const data = await response.json();
                
                if (data.success) {
                    const prediction = data.data;
                    
                    let statusIcon = '';
                    let statusColor = '';
                    let statusMessage = '';
                    let statusDescription = '';
                    
                    switch (prediction.status) {
                        case 'on_track':
                            statusIcon = 'üü¢';
                            statusColor = '#10b981';
                            statusMessage = 'On Track';
                            statusDescription = 'Goal will be completed on time with current progress rate';
                            break;
                        case 'slight_delay':
                            statusIcon = 'üü°';
                            statusColor = '#f59e0b';
                            statusMessage = 'Slight Delay';
                            statusDescription = 'Goal may be completed a few days late, minor adjustments needed';
                            break;
                        case 'at_risk':
                            statusIcon = 'üî¥';
                            statusColor = '#ef4444';
                            statusMessage = 'At Risk';
                            statusDescription = 'Goal unlikely to be completed on time, immediate action required';
                            break;
                        default:
                            statusIcon = '‚ö™';
                            statusColor = '#6b7280';
                            statusMessage = 'Status Unknown';
                            statusDescription = 'Need more data for accurate prediction';
                    }
                    
                    const completionDate = prediction.predicted_completion_date 
                        ? new Date(prediction.predicted_completion_date).toLocaleDateString('en-US', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        })
                        : 'Unable to predict';
                    
                    const confidenceColor = prediction.confidence >= 70 ? '#10b981' : 
                                          prediction.confidence >= 40 ? '#f59e0b' : '#ef4444';
                    
                    const content = `
                        <div class="popup-header">
                            <h3>üîÆ Goal Prediction: ${goalTitle}</h3>
                        </div>
                        <div class="popup-content">
                            <div style="margin-bottom: 2rem;">
                                
                                <!-- Status Overview -->
                                <div class="forecast-status-card">
                                    <div class="forecast-status-header">
                                        <div class="forecast-status-icon">${statusIcon}</div>
                                        <div>
                                            <div class="forecast-status-title" style="color: ${statusColor};">
                                                ${statusMessage}
                                            </div>
                                            <div class="forecast-status-description">
                                                ${statusDescription}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Prediction Details -->
                                <div class="forecast-details-grid">
                                    <div class="forecast-detail-card">
                                        <div class="forecast-detail-label">
                                            Predicted Completion
                                        </div>
                                        <div class="forecast-detail-value">
                                            ${completionDate}
                                        </div>
                                    </div>
                                    
                                    <div class="forecast-detail-card">
                                        <div class="forecast-detail-label">
                                            Confidence Level
                                        </div>
                                        <div class="forecast-confidence-bar">
                                            <div class="forecast-confidence-value" style="color: ${confidenceColor};">
                                                ${prediction.confidence}%
                                            </div>
                                            <div class="forecast-confidence-progress">
                                                <div class="forecast-confidence-fill" style="width: ${prediction.confidence}%; background: ${confidenceColor};"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- AI Insights -->
                                <div class="forecast-ai-insights">
                                    <div class="forecast-ai-header">
                                        <span class="forecast-ai-icon">ü§ñ</span>
                                        <span class="forecast-ai-title">AI Insights</span>
                                    </div>
                                    <p class="forecast-ai-text">
                                        ${prediction.confidence >= 70 ? 
                                            'Based on current trends, this goal is highly achievable. Keep up the great work!' :
                                        prediction.confidence >= 40 ?
                                            'The goal is achievable but may require some adjustments to stay on track.' :
                                            'Consider revising the timeline or target to make this goal more realistic.'
                                        }
                                    </p>
                                </div>
                                
                                <div style="display: flex; justify-content: center;">
                                    <button class="goal-button-primary" style="padding: 0.75rem 2rem;" onclick="closePopup()">
                                        ‚úÖ Got it
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    showPopup(content);
                } else {
                    showNotification(`‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Error getting prediction:', error);
                showNotification('‚ùå Error getting goal prediction', 'error');
            }
        }
        
        function createNewGoal() {
            const content = `
                <div class="popup-header">
                    <h3>üéØ Create New Goal</h3>
                </div>
                <div class="popup-content">
                    <div style="margin-bottom: 2rem;">
                        <p style="color: #cbd5e1; margin-bottom: 1.5rem;">Create a smart goal with automatic progress tracking and achievement rewards.</p>
                        
                                                 <!-- Goal Type Selection -->
                         <div style="margin-bottom: 1.5rem;">
                             <label class="goal-form-label">Goal Type:</label>
                             <select id="goalTypeSelect" class="goal-form-select" onchange="updateGoalDescription()">
                                 <option value="">Select goal type...</option>
                                 <option value="bug_reduction">üêõ Bug Reduction - Reduce number of bugs</option>
                                 <option value="health_improvement">üíö Health Improvement - Improve project health score</option>
                                 <option value="component_stability">üîß Component Stability - Improve component reliability</option>
                             </select>
                         </div>
                         
                         <!-- Goal Description -->
                         <div id="goalDescription" class="goal-info-box" style="display: none;">
                             <div class="goal-info-header">
                                 <span style="font-size: 1.2rem;">üí°</span>
                                 <span style="color: #93c5fd; font-weight: 600;">Goal Description</span>
                             </div>
                             <p id="goalDescriptionText" class="goal-info-text"></p>
                         </div>
                         
                         <!-- Goal Title -->
                         <div style="margin-bottom: 1.5rem;">
                             <label class="goal-form-label">Goal Title:</label>
                             <input type="text" id="goalTitleInput" class="goal-form-input" 
                                    placeholder="e.g., Reduce Android bugs by 50%">
                         </div>
                         
                         <!-- Current and Target Values -->
                         <div class="goal-grid-inputs">
                             <div>
                                 <label class="goal-form-label">Current Value:</label>
                                 <input type="number" id="currentValueInput" class="goal-form-input"
                                        placeholder="Current state" step="0.1">
                             </div>
                             <div>
                                 <label class="goal-form-label">Target Value:</label>
                                 <input type="number" id="targetValueInput" class="goal-form-input"
                                        placeholder="Target goal" step="0.1">
                             </div>
                         </div>
                         
                         <!-- Target Date -->
                         <div style="margin-bottom: 2rem;">
                             <label class="goal-form-label">Target Date:</label>
                             <input type="date" id="targetDateInput" class="goal-form-input"
                                    min="${new Date().toISOString().split('T')[0]}">
                         </div>
                         
                         <!-- Action Buttons -->
                         <div class="goal-actions">
                             <button class="goal-button-secondary" onclick="closePopup()">
                                 Cancel
                             </button>
                             <button id="createGoalBtn" class="goal-button-primary" onclick="submitNewGoal()">
                                 üéØ Create Goal
                             </button>
                         </div>
                    </div>
                </div>
            `;
            
            showPopup(content);
            
            // Set default date to 30 days from now
            setTimeout(() => {
                const dateInput = document.getElementById('targetDateInput');
                if (dateInput) {
                    const defaultDate = new Date();
                    defaultDate.setDate(defaultDate.getDate() + 30);
                    dateInput.value = defaultDate.toISOString().split('T')[0];
                }
            }, 100);
        }
        
        function updateGoalDescription() {
            const goalType = document.getElementById('goalTypeSelect')?.value;
            const descriptionDiv = document.getElementById('goalDescription');
            const descriptionText = document.getElementById('goalDescriptionText');
            
            if (!goalType || !descriptionDiv || !descriptionText) return;
            
            const descriptions = {
                'bug_reduction': 'Reduce the number of bugs in your project. Lower values indicate better quality.',
                'health_improvement': 'Improve your project\'s overall health score. Higher values indicate better project health.',
                'component_stability': 'Improve the stability and reliability of critical components. Focus on reducing component-related issues.'
            };
            
            if (descriptions[goalType]) {
                descriptionText.textContent = descriptions[goalType];
                descriptionDiv.style.display = 'block';
            } else {
                descriptionDiv.style.display = 'none';
            }
        }
        
        async function submitNewGoal() {
            const goalType = document.getElementById('goalTypeSelect')?.value;
            const title = document.getElementById('goalTitleInput')?.value;
            const currentValue = document.getElementById('currentValueInput')?.value;
            const targetValue = document.getElementById('targetValueInput')?.value;
            const targetDate = document.getElementById('targetDateInput')?.value;
            
            // Validation
            if (!goalType) {
                showNotification('Please select a goal type', 'warning');
                return;
            }
            
            if (!title?.trim()) {
                showNotification('Please enter a goal title', 'warning');
                return;
            }
            
            if (!currentValue || isNaN(parseFloat(currentValue))) {
                showNotification('Please enter a valid current value', 'warning');
                return;
            }
            
            if (!targetValue || isNaN(parseFloat(targetValue))) {
                showNotification('Please enter a valid target value', 'warning');
                return;
            }
            
            if (!targetDate) {
                showNotification('Please select a target date', 'warning');
                return;
            }
            
            // Validate that target date is in the future
            const selectedDate = new Date(targetDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (selectedDate < today) {
                showNotification('Target date must be in the future', 'warning');
                return;
            }
            
            closePopup();
            
            createGoal({
                type: goalType,
                title: title.trim(),
                target_value: parseFloat(targetValue),
                current_value: parseFloat(currentValue),
                target_date: targetDate + 'T23:59:59'
            });
        }
        
        async function createGoal(goalData) {
            try {
                const response = await fetch(`/api/goals/${currentProject}/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(goalData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(data.message, 'success');
                    await loadGoalsDashboard();
                } else {
                    showNotification(`Error: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Error creating goal:', error);
                showNotification('Error creating goal', 'error');
            }
        }
        
        function showGoalsLoading() {
            document.getElementById('goalsLoading').style.display = 'flex';
            document.getElementById('goalsDashboard').style.display = 'none';
            document.getElementById('noGoalsState').style.display = 'none';
        }
        
        function hideGoalsLoading() {
            document.getElementById('goalsLoading').style.display = 'none';
        }
        
        function showNoGoalsState() {
            document.getElementById('noGoalsState').style.display = 'block';
            document.getElementById('goalsDashboard').style.display = 'none';
            hideGoalsLoading();
        }

        async function confirmDeleteGoal(goalId, goalTitle) {
            const content = `
                <div class="popup-header">
                    <h3>üóëÔ∏è Delete Goal</h3>
                </div>
                <div class="popup-content">
                    <div style="margin-bottom: 2rem;">
                        <!-- Warning Icon and Message -->
                        <div class="delete-warning-card">
                            <div class="delete-warning-header">
                                <div class="delete-warning-icon">‚ö†Ô∏è</div>
                                <div>
                                    <div class="delete-warning-title">Permanent Deletion</div>
                                    <div class="delete-warning-subtitle">This action cannot be undone</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Goal Information -->
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                            <div style="color: #94a3b8; font-size: 0.8rem; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px;">
                                Goal to Delete
                            </div>
                            <div style="color: #fbbf24; font-weight: bold; font-size: 1.1rem;">
                                ${goalTitle}
                            </div>
                        </div>
                        
                        <!-- Consequences -->
                        <div style="margin-bottom: 1.5rem;">
                            <p style="color: #cbd5e1; margin-bottom: 1rem; line-height: 1.4;">
                                Are you sure you want to permanently delete this goal? This will also remove:
                            </p>
                            <ul style="color: #94a3b8; margin: 0; padding-left: 1.5rem;">
                                <li>All progress tracking history</li>
                                <li>Associated achievement badges</li>
                                <li>Milestone records</li>
                            </ul>
                        </div>
                        
                        <!-- Alternative Option -->
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); 
                                   padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span style="font-size: 1.2rem;">üí°</span>
                                <span style="color: #93c5fd; font-weight: 600;">Alternative Option</span>
                            </div>
                            <p style="color: #cbd5e1; margin: 0; font-size: 0.9rem;">
                                Consider canceling the goal instead to preserve its history while marking it as inactive.
                            </p>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="delete-actions-grid">
                            <button class="goal-button-secondary" onclick="closePopup()">
                                Keep Goal
                            </button>
                            <button class="btn-cancel" style="padding: 0.75rem 1rem; font-size: 0.9rem;" onclick="cancelGoalAction('${goalId}')">
                                üìã Cancel Goal
                            </button>
                            <button class="btn-delete" style="padding: 0.75rem 1rem; font-size: 0.9rem;" onclick="deleteGoalAction('${goalId}')">
                                üóëÔ∏è Delete Forever
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            showPopup(content);
        }

        async function deleteGoalAction(goalId) {
            closePopup();
            
            try {
                const response = await fetch(`/api/goals/${currentProject}/${goalId}/delete`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`üóëÔ∏è Goal deleted permanently`, 'success');
                    await loadGoalsDashboard();
                } else {
                    showNotification(`‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Error deleting goal:', error);
                showNotification('‚ùå Error deleting goal', 'error');
            }
        }

        async function cancelGoalAction(goalId) {
            closePopup();
            
            try {
                const response = await fetch(`/api/goals/${currentProject}/${goalId}/cancel`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`üìã Goal cancelled successfully`, 'success');
                    await loadGoalsDashboard();
                } else {
                    showNotification(`‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Error cancelling goal:', error);
                showNotification('‚ùå Error cancelling goal', 'error');
            }
        }
        
        // Load goals when switching to goals tab
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener for goals tab
            const goalsTab = document.querySelector('[data-tab="goals"]');
            if (goalsTab) {
                goalsTab.addEventListener('click', function() {
                    console.log('üéØ Goals tab clicked');
                    console.log('üîç Current project when goals tab clicked:', currentProject);
                    
                    // Try to load goals dashboard or show guidance
                    loadGoalsDashboard();
                });
            }
        });
        
        // Helper function to guide users to analyze first
        function switchToOverviewAndAnalyze() {
            console.log('üîÑ Switching to overview tab for analysis');
            
            // Switch to overview tab
            document.querySelector('[data-tab="overview"]').click();
            
            // Show notification about next steps
            showNotification('Select a project and click "üöÄ Analyze Project" to get started', 'info', 5000);
            
            // Highlight the analyze button briefly
            setTimeout(() => {
                const analyzeBtn = document.getElementById('analyzeBtn');
                if (analyzeBtn) {
                    analyzeBtn.style.border = '3px solid #3b82f6';
                    analyzeBtn.style.boxShadow = '0 0 20px rgba(59, 130, 246, 0.5)';
                    setTimeout(() => {
                        analyzeBtn.style.border = '';
                        analyzeBtn.style.boxShadow = '';
                    }, 3000);
                }
            }, 500);
        }
        
        console.log('üéØ Goal Tracking System loaded!');
    </script>

    <!-- Load PWA Dependencies -->
    <script>
        // Start PWA initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Load theme preference first
            loadThemePreference();
            
            // Initialize notification status
            initializeNotificationStatus();
            
            // Enhance alert banner interaction
            setTimeout(enhanceAlertBanner, 100);
            
            // Then load PWA features
            loadPWADependencies();
            
            console.log('üöÄ Bug Risk Analysis Dashboard loaded with PWA features!');
        });
    </script>
    <!-- Footer -->
    <div class="footer">
        <p>¬© 2025 Zap‚ö°Ô∏è - ML Risk Analysis Dashboard | Enabled by JIRA API Integration, AI & ML-Powered Insights</p>
    </div>
</body>
</html> 